<!DOCTYPE html>
<html style="font-size: 16px;">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <meta name="keywords" content="Conclusions, Summary:&nbsp;Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean lectus felis, dictum ultrices arcu et, rhoncus tempus lorem. Praesent id molestie orci, et varius mauris. Pellentesque eu arcu vulputate, condimentum urna eu, interdum nulla. Cras eget odio venenatis arcu mattis porta eu sed ligula., Summary:&nbsp;Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean lectus felis, dictum ultrices arcu et, rhoncus tempus lorem. Praesent id molestie orci, et varius mauris. Pellentesque eu arcu vulputate, condimentum urna eu, interdum nulla. Cras eget odio venenatis arcu mattis porta eu sed ligula., Summary:&nbsp;Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean lectus felis, dictum ultrices arcu et, rhoncus tempus lorem. Praesent id molestie orci, et varius mauris. Pellentesque eu arcu vulputate, condimentum urna eu, interdum nulla. Cras eget odio venenatis arcu mattis porta eu sed ligula.">
    <meta name="description" content="">
    <meta name="page_type" content="np-template-header-footer-from-plugin">
    <title>Appendix</title>
    <link rel="stylesheet" href="nicepage.css" media="screen">
<link rel="stylesheet" href="Appendix.css" media="screen">
    <script class="u-script" type="text/javascript" src="jquery.js" defer=""></script>
    <script class="u-script" type="text/javascript" src="nicepage.js" defer=""></script>
    <meta name="generator" content="Nicepage 3.24.1, nicepage.com">
    <link id="u-theme-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i|Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i">
    <link id="u-page-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web:200,200i,300,300i,400,400i,600,600i,700,700i,900">
    
    
    
    <script type="application/ld+json">{
		"@context": "http://schema.org",
		"@type": "Organization",
		"name": ""
}</script>
    <meta name="theme-color" content="#478ac9">
    <meta property="og:title" content="Appendix">
    <meta property="og:type" content="website">
  </head>
  <body class="u-body"><header class="u-clearfix u-header u-white u-header" id="sec-d3f3"><style class="u-sticky-style" data-style-id="4c27">.u-sticky-fixed.u-sticky-4c27, .u-body.u-sticky-fixed .u-sticky-4c27 {
box-shadow: 2px 2px 8px 0 rgba(128,128,128,1) !important
}.u-sticky-fixed.u-sticky-4c27:before, .u-body.u-sticky-fixed .u-sticky-4c27:before {
borders: top right bottom left !important
}</style><div class="u-clearfix u-sheet u-sheet-1">
        <nav class="u-menu u-menu-dropdown u-offcanvas u-menu-1">
          <div class="menu-collapse u-custom-font u-font-titillium-web" style="font-size: 1.125rem; letter-spacing: 0px;">
            <a class="u-button-style u-custom-active-border-color u-custom-active-color u-custom-border u-custom-border-color u-custom-borders u-custom-hover-border-color u-custom-hover-color u-custom-left-right-menu-spacing u-custom-padding-bottom u-custom-text-active-color u-custom-text-color u-custom-text-hover-color u-custom-top-bottom-menu-spacing u-nav-link u-text-active-palette-1-base u-text-hover-palette-2-base" href="#">
              <svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#menu-hamburger"></use></svg>
              <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><symbol id="menu-hamburger" viewBox="0 0 16 16" style="width: 16px; height: 16px;"><rect y="1" width="16" height="2"></rect><rect y="7" width="16" height="2"></rect><rect y="13" width="16" height="2"></rect>
</symbol>
</defs></svg>
            </a>
          </div>
          <div class="u-custom-menu u-nav-container">
            <ul class="u-custom-font u-font-titillium-web u-nav u-spacing-2 u-unstyled u-nav-1"><li class="u-nav-item"><a class="u-active-grey-5 u-button-style u-hover-grey-10 u-nav-link u-text-active-grey-90 u-text-grey-90 u-text-hover-grey-90" href="Home.html" style="padding: 10px 20px;">Home</a>
</li><li class="u-nav-item"><a class="u-active-grey-5 u-button-style u-hover-grey-10 u-nav-link u-text-active-grey-90 u-text-grey-90 u-text-hover-grey-90" href="High-Level-Design.html" style="padding: 10px 20px;">High Level Design</a>
</li><li class="u-nav-item"><a class="u-active-grey-5 u-button-style u-hover-grey-10 u-nav-link u-text-active-grey-90 u-text-grey-90 u-text-hover-grey-90" href="PH-Design.html" style="padding: 10px 20px;">Program &amp; Hardware Design</a>
</li><li class="u-nav-item"><a class="u-active-grey-5 u-button-style u-hover-grey-10 u-nav-link u-text-active-grey-90 u-text-grey-90 u-text-hover-grey-90" href="Results-and-Conclusion.html" style="padding: 10px 20px;">Results &amp; Conclusion</a>
</li><li class="u-nav-item"><a class="u-active-grey-5 u-button-style u-hover-grey-10 u-nav-link u-text-active-grey-90 u-text-grey-90 u-text-hover-grey-90" href="Appendix.html" style="padding: 10px 20px;">Appendix</a>
</li></ul>
          </div>
          <div class="u-custom-menu u-nav-container-collapse">
            <div class="u-black u-container-style u-inner-container-layout u-opacity u-opacity-95 u-sidenav">
              <div class="u-sidenav-overflow">
                <div class="u-menu-close"></div>
                <ul class="u-align-center u-nav u-popupmenu-items u-unstyled u-nav-2"><li class="u-nav-item"><a class="u-button-style u-nav-link" href="Home.html" style="padding: 10px 20px;">Home</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="High-Level-Design.html" style="padding: 10px 20px;">High Level Design</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="PH-Design.html" style="padding: 10px 20px;">Program &amp; Hardware Design</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="Results-and-Conclusion.html" style="padding: 10px 20px;">Results &amp; Conclusion</a>
</li><li class="u-nav-item"><a class="u-button-style u-nav-link" href="Appendix.html" style="padding: 10px 20px;">Appendix</a>
</li></ul>
              </div>
            </div>
            <div class="u-black u-menu-overlay u-opacity u-opacity-70"></div>
          </div>
        </nav>
        <img class="u-image u-image-default u-image-1" src="images/download1.png" alt="" data-image-width="396" data-image-height="127">
        <img class="u-image u-image-default u-image-2" src="images/ScreenShot2022-12-01at1.27.43PM.png" alt="" data-image-width="742" data-image-height="752">
      </div></header>
    <section class="u-clearfix u-image u-section-1" id="sec-4bdd" data-image-width="1280" data-image-height="402">
      <div class="u-clearfix u-sheet u-valign-middle u-sheet-1">
        <h1 class="u-align-center u-custom-font u-font-titillium-web u-text u-text-body-alt-color u-text-1">Appendix</h1>
      </div>
    </section>
    <section class="u-clearfix u-section-2" id="sec-9693">
      <div class="u-align-left u-clearfix u-sheet u-sheet-1">
        <h1 class="u-align-center u-custom-font u-font-titillium-web u-text u-text-1"><i><b>Appendix A</b></i>
        </h1>
        <h1 class="u-align-center u-custom-font u-font-titillium-web u-text u-text-2">"The group approves this report for inclusion on the course website."<br>"The group approves the video for inclusion on the course youtube channel."<br>
        </h1>
        <h1 class="u-align-center u-custom-font u-font-titillium-web u-text u-text-3"><i><b>Appendix B</b></i>
        </h1>
        <h1 class="u-align-left u-custom-font u-font-titillium-web u-text u-text-4">
          <br><b>xylophone.c&nbsp;</b>
          <br>
          <br>/**<br> * Self-Playing Xylophone<br> * Karina Melgar (kmm477), Zoe Chen (zmc6), and Harris Miller (hwm44)<br> * <br> * Based on code provided by V. Hunter Adams (vha3)<br> * <br> * HARDWARE CONNECTIONS<br> * &nbsp; - GPIO 16 ---&gt; VGA Hsync<br> * &nbsp; - GPIO 17 ---&gt; VGA Vsync<br> * &nbsp; - GPIO 18 ---&gt; 330 ohm resistor ---&gt; VGA Red<br> * &nbsp; - GPIO 19 ---&gt; 330 ohm resistor ---&gt; VGA Green<br> * &nbsp; - GPIO 20 ---&gt; 330 ohm resistor ---&gt; VGA Blue<br> * &nbsp; - GPIO&nbsp; 8 ---&gt; PWM output 1 (4A) [pin 11]<br> * &nbsp; - GPIO&nbsp; 9 ---&gt; PWM output 2 (4B) [pin 12]<br> * &nbsp; - GPIO 10 ---&gt; PWM output 3 (5A) [pin 14]<br> * &nbsp; - GPIO 11 ---&gt; PWM output 4 (5B) [pin 15]<br> * &nbsp; - GPIO 12 ---&gt; PWM output 5 (6A) [pin 16]<br> * &nbsp; - GPIO 13 ---&gt; PWM output 6 (6B) [pin 17]<br> * &nbsp; - GPIO 14 ---&gt; PWM output 7 (7A) [pin 19]<br> * &nbsp; - GPIO 15 ---&gt; PWM output 8 (7B) [pin 20]<br> *<br> *&nbsp; Notes: do not trigger more than 4 servos at once<br> *&nbsp; - causes major instability + timing loss<br> */<br>
          <br>// Standard libraries<br>#include &lt;stdio.h&gt;<br>#include &lt;stdlib.h&gt;<br>#include &lt;math.h&gt;<br>#include &lt;string.h&gt;<br>// Pico libraries<br>#include "pico/stdlib.h"<br>#include "pico/multicore.h"<br>#include "hardware/pwm.h"<br>#include "hardware/irq.h"<br>// Protothreads<br>#include "pt_cornell_rp2040_v1.h"<br>// Custom headers<br>#include "music.h"<br>
          <br>// PWM wrap value and clock divide value<br>// For a CPU rate of 125 MHz, this gives<br>// a PWM frequency of 50 Hz.<br>#define WRAPVAL 50000<br>#define CLKDIV 50.0f<br>#define FREQ (50000/20)<br>#define NUM_SERVOS 8<br>
          <br>// Xylophone servo state machine enum<br>typedef enum {<br>&nbsp; WAIT = 0,<br>&nbsp; STRIKE_DOWN,<br>&nbsp; STRIKE_UP,<br>} xylo_state_t;<br>
          <br>// PWM channel and state information<br>// ordered from lowest to highest pitch<br>uint slice_num[NUM_SERVOS];<br>volatile uint XYLO_STATE[NUM_SERVOS] = {WAIT,WAIT,WAIT,WAIT,WAIT,WAIT,WAIT,WAIT};<br>const uint PWM_CHAN[NUM_SERVOS]&nbsp; &nbsp; &nbsp; = {PWM_CHAN_A, PWM_CHAN_B, PWM_CHAN_A, PWM_CHAN_B, PWM_CHAN_A, PWM_CHAN_B, PWM_CHAN_A, PWM_CHAN_B};<br>const uint UP[NUM_SERVOS]&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = {4500, 3300, 3700, 4100, 3600, 2900, 3700, 3700};<br>const uint DOWN[NUM_SERVOS]&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = {4900, 3700, 4100, 4550, 3200, 2500, 3300, 3200};<br>
          <br>// PWM duty cycle storage<br>volatile int control[NUM_SERVOS] &nbsp; &nbsp; = ;<br>volatile int old_control[NUM_SERVOS] = ;<br>
          <br>// timer storage<br>volatile uint counter = 0;<br>volatile uint beat = 0;<br>
          <br>// Current song pointer<br>volatile song_t* curr_song = NULL;<br>
          <br>// PWM interrupt service routine<br>void on_pwm_wrap() {<br>&nbsp; &nbsp; for(size_t i = 0; i &lt; NUM_SERVOS; i++){<br>&nbsp; &nbsp; &nbsp; &nbsp; // Update duty cycle<br>&nbsp; &nbsp; &nbsp; &nbsp; if (control[i] != old_control[i]) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; old_control[i] = control[i] ;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // set specific PWM channel given slice, channel (A/B), and value<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pwm_set_chan_level(slice_num[i], PWM_CHAN[i], control[i]);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; for(size_t i = 0; i &lt; NUM_SERVOS; i++){<br>&nbsp; &nbsp; &nbsp; &nbsp; // clear all IRQs<br>&nbsp; &nbsp; &nbsp; &nbsp; pwm_clear_irq(slice_num[i]);<br>&nbsp; &nbsp; }<br>}<br>
          <br>// Timer ISR<br>bool repeating_timer_callback(struct repeating_timer *t) {<br>&nbsp; &nbsp; // increase counter on IRQ<br>&nbsp; &nbsp; counter++;<br>&nbsp; &nbsp; // if song loaded and beat period expired:<br>&nbsp; &nbsp; if (curr_song != NULL &amp;&amp; counter &gt;= curr_song-&gt;beat_period) {&nbsp; &nbsp; &nbsp; // 1000 --&gt; 60 bpm, strike every second<br>&nbsp; &nbsp; &nbsp; &nbsp; // reset counter<br>&nbsp; &nbsp; &nbsp; &nbsp; counter = 0;<br>&nbsp; &nbsp; &nbsp; &nbsp; // if beat period is valid (non-zero)<br>&nbsp; &nbsp; &nbsp; &nbsp; if(curr_song-&gt;beat_period != 0) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // initiate strike for any servos for this beat<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for(size_t i = 0; i &lt; NUM_SERVOS; i++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(curr_song-&gt;notes[i][beat]) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; XYLO_STATE[i] = STRIKE_DOWN;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // increase beat counter<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; beat++;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // if no beats remaining<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(beat &gt;= curr_song-&gt;end_beat) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // destroy pointers<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; curr_song = NULL;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // reset beat counter<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; beat = 0;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; return true;<br>}<br>
          <br>// User input thread <br>static PT_THREAD (protothread_serial(struct pt *pt)) {<br>&nbsp; &nbsp; PT_BEGIN(pt);<br>&nbsp; &nbsp; // stores user input<br>&nbsp; &nbsp; static uint user_input ;<br>&nbsp; &nbsp; // wait<br>&nbsp; &nbsp; PT_YIELD_usec(1000000) ;<br>&nbsp; &nbsp; // write song list:<br>&nbsp; &nbsp; sprintf(pt_serial_out_buffer, "\r\n");<br>&nbsp; &nbsp; serial_write ; <br>&nbsp; &nbsp; sprintf(pt_serial_out_buffer, "0)&nbsp; Scale\r\n");<br>&nbsp; &nbsp; serial_write ; <br>&nbsp; &nbsp; sprintf(pt_serial_out_buffer, "1)&nbsp; Happy Birthday\r\n");<br>&nbsp; &nbsp; serial_write ; <br>&nbsp; &nbsp; sprintf(pt_serial_out_buffer, "2)&nbsp; Wii Sports Theme\r\n");<br>&nbsp; &nbsp; serial_write ; <br>&nbsp; &nbsp; sprintf(pt_serial_out_buffer, "3)&nbsp; Cornell Alma Mater\r\n");<br>&nbsp; &nbsp; serial_write ; <br>&nbsp; &nbsp; sprintf(pt_serial_out_buffer, "4)&nbsp; Chopsticks\r\n");<br>&nbsp; &nbsp; serial_write ; <br>&nbsp; &nbsp; sprintf(pt_serial_out_buffer, "5)&nbsp; Jingle Bells\r\n");<br>&nbsp; &nbsp; serial_write ; <br>&nbsp; &nbsp; sprintf(pt_serial_out_buffer, "6)&nbsp; Old MacDonald\r\n");<br>&nbsp; &nbsp; serial_write ; <br>&nbsp; &nbsp; sprintf(pt_serial_out_buffer, "7)&nbsp; Chords\r\n");<br>&nbsp; &nbsp; serial_write ; <br>&nbsp; &nbsp; sprintf(pt_serial_out_buffer, "8)&nbsp; Baby Shark\r\n");<br>&nbsp; &nbsp; serial_write ; <br>&nbsp; &nbsp; sprintf(pt_serial_out_buffer, "9)&nbsp; Dreidel\r\n");<br>&nbsp; &nbsp; serial_write ; <br>&nbsp; &nbsp; sprintf(pt_serial_out_buffer, "10) Surprise :)\r\n");<br>&nbsp; &nbsp; serial_write ;<br>&nbsp; &nbsp; sprintf(pt_serial_out_buffer, "11) Twinkle Twinkle Little Star\r\n");<br>&nbsp; &nbsp; serial_write ;<br>&nbsp; &nbsp; sprintf(pt_serial_out_buffer, "12) The Office Theme\r\n");<br>&nbsp; &nbsp; serial_write ;<br>&nbsp; &nbsp; sprintf(pt_serial_out_buffer, "13) I Want You Back\r\n");<br>&nbsp; &nbsp; serial_write ;<br>&nbsp; &nbsp; sprintf(pt_serial_out_buffer, "14) A Thousand Miles\r\n");<br>&nbsp; &nbsp; serial_write ;<br>&nbsp; &nbsp; sprintf(pt_serial_out_buffer, "15) A Whole New World\r\n");<br>&nbsp; &nbsp; serial_write ;<br>&nbsp; &nbsp; sprintf(pt_serial_out_buffer, "16) Carol of the Bells\r\n");<br>&nbsp; &nbsp; serial_write ;<br>&nbsp; &nbsp; sprintf(pt_serial_out_buffer, "17) Leave the Door Open\r\n");<br>&nbsp; &nbsp; serial_write ;<br>&nbsp; &nbsp; sprintf(pt_serial_out_buffer, "18) Love Story\r\n");<br>&nbsp; &nbsp; serial_write ;<br>&nbsp; &nbsp; sprintf(pt_serial_out_buffer, "19) Mario\r\n");<br>&nbsp; &nbsp; serial_write ;<br>&nbsp; &nbsp; sprintf(pt_serial_out_buffer, "20) Ode to Joy\r\n");<br>&nbsp; &nbsp; serial_write ;<br>&nbsp; &nbsp; sprintf(pt_serial_out_buffer, "21) Spring\r\n");<br>&nbsp; &nbsp; serial_write ;<br>&nbsp; &nbsp; sprintf(pt_serial_out_buffer, "22) Star Wars\r\n");<br>&nbsp; &nbsp; serial_write ;<br>
          <br>&nbsp; &nbsp; while(1) {<br>&nbsp; &nbsp; &nbsp; &nbsp; // print prompt<br>&nbsp; &nbsp; &nbsp; &nbsp; sprintf(pt_serial_out_buffer, "Enter song number to play: ");<br>&nbsp; &nbsp; &nbsp; &nbsp; // non-blocking write<br>&nbsp; &nbsp; &nbsp; &nbsp; serial_write ;<br>&nbsp; &nbsp; &nbsp; &nbsp; // spawn a thread to do the non-blocking serial read<br>&nbsp; &nbsp; &nbsp; &nbsp; serial_read ;<br>&nbsp; &nbsp; &nbsp; &nbsp; // convert input string to int<br>&nbsp; &nbsp; &nbsp; &nbsp; sscanf(pt_serial_in_buffer, "%d", &amp;user_input) ;<br>&nbsp; &nbsp; &nbsp; &nbsp; // confirm value before indexing (prevents out-of-bounds)<br>&nbsp; &nbsp; &nbsp; &nbsp; if(user_input &lt; NUM_SONGS) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; curr_song = song_list[user_input];<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; } // END WHILE(1)<br>
          <br>&nbsp; &nbsp; PT_END(pt);<br>} // serial thread<br>
          <br>// Strike down/up thread<br>static PT_THREAD (protothread_play(struct pt *pt)) {<br>&nbsp; &nbsp; PT_BEGIN(pt) ;<br>&nbsp; &nbsp; // play control loop<br>&nbsp; &nbsp; while(1) {<br>&nbsp; &nbsp; &nbsp; &nbsp; // loop over all servos<br>&nbsp; &nbsp; &nbsp; &nbsp; for(size_t i = 0; i &lt; NUM_SERVOS; i++){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // initiate strike when commanded<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(XYLO_STATE[i] == STRIKE_DOWN){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; control[i] = DOWN[i];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; XYLO_STATE[i] = STRIKE_UP;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // initiate lift when timer expires<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else if(XYLO_STATE[i] == STRIKE_UP &amp;&amp; counter &gt;= 70){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; control[i] = UP[i];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; XYLO_STATE[i] = WAIT;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; // yield to allow serial input<br>&nbsp; &nbsp; &nbsp; &nbsp; PT_YIELD_usec(10000) ;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; PT_END(pt) ;<br>}<br>
          <br>int main() {<br>&nbsp; &nbsp; // Initialize stdio<br>&nbsp; &nbsp; stdio_init_all();<br>
          <br>&nbsp; &nbsp; // init servo PWM values to resting position<br>&nbsp; &nbsp; for(size_t i = 0; i &lt; NUM_SERVOS; i++){<br>&nbsp; &nbsp; &nbsp; &nbsp; control[i] = UP[i];<br>&nbsp; &nbsp; }<br>
          <br>&nbsp; &nbsp; ////////////////////////////////////////////////////////////////////////<br>&nbsp; &nbsp; ///////////////////////// PWM CONFIGURATION ////////////////////////////<br>&nbsp; &nbsp; ////////////////////////////////////////////////////////////////////////<br>&nbsp; &nbsp; uint32_t mask = 0;<br>&nbsp; &nbsp; for(size_t i = 0; i &lt; NUM_SERVOS; i++){<br>&nbsp; &nbsp; &nbsp; &nbsp; // Tell GPIO that it is allocated to the PWM<br>&nbsp; &nbsp; &nbsp; &nbsp; gpio_set_function(i+8,&nbsp; GPIO_FUNC_PWM);<br>
          <br>&nbsp; &nbsp; &nbsp; &nbsp; // Find out which PWM slice is connected to GPIO 8-15<br>&nbsp; &nbsp; &nbsp; &nbsp; slice_num[i] = pwm_gpio_to_slice_num(i+8);<br>
          <br>&nbsp; &nbsp; &nbsp; &nbsp; // Mask our slice's IRQ output into the PWM block's single interrupt line,<br>&nbsp; &nbsp; &nbsp; &nbsp; // and register our interrupt handler<br>&nbsp; &nbsp; &nbsp; &nbsp; pwm_clear_irq(slice_num[i]);<br>&nbsp; &nbsp; &nbsp; &nbsp; pwm_set_irq_enabled(slice_num[i], true);<br>
          <br>&nbsp; &nbsp; &nbsp; &nbsp; // This section configures the period of the PWM signals<br>&nbsp; &nbsp; &nbsp; &nbsp; pwm_set_wrap(slice_num[i], WRAPVAL) ;<br>&nbsp; &nbsp; &nbsp; &nbsp; pwm_set_clkdiv(slice_num[i], CLKDIV) ;<br>
          <br>&nbsp; &nbsp; &nbsp; &nbsp; // This sets duty cycle<br>&nbsp; &nbsp; &nbsp; &nbsp; pwm_set_chan_level(slice_num[i], PWM_CHAN[i], FREQ);<br>&nbsp; &nbsp; &nbsp; &nbsp; mask |= (1u &lt;&lt; slice_num[i]);<br>&nbsp; &nbsp; }<br>
          <br>&nbsp; &nbsp; irq_set_exclusive_handler(PWM_IRQ_WRAP, on_pwm_wrap);<br>&nbsp; &nbsp; irq_set_enabled(PWM_IRQ_WRAP, true);<br>
          <br>&nbsp; &nbsp; // Start the channel<br>&nbsp; &nbsp; pwm_set_mask_enabled(mask);<br>
          <br>&nbsp; &nbsp; // Create a repeating timer that calls repeating_timer_callback.<br>&nbsp; &nbsp; // If the delay is &gt; 0 then this is the delay between the previous callback ending and the next starting.<br>&nbsp; &nbsp; // If the delay is negative (see below) then the next call to the callback will be exactly x us after the<br>&nbsp; &nbsp; // start of the call to the last callback<br>&nbsp; &nbsp; struct repeating_timer timer;<br>
          <br>&nbsp; &nbsp; // Negative delay so means we will call repeating_timer_callback, and call it again<br>&nbsp; &nbsp; // 1000us (1kHz) later regardless of how long the callback took to execute<br>&nbsp; &nbsp; add_repeating_timer_us(-1000, repeating_timer_callback, NULL, &amp;timer);<br>
          <br>&nbsp; &nbsp; // start protothreads<br>&nbsp; &nbsp; pt_add_thread(protothread_serial) ;<br>&nbsp; &nbsp; pt_add_thread(protothread_play) ;<br>&nbsp; &nbsp; pt_schedule_start ;<br>}<br>
        </h1>
        <h1 class="u-align-left u-custom-font u-font-titillium-web u-text u-text-5"><b>music. h</b>
          <br>
          <br>#ifndef _MUSIC_H_<br>#define _MUSIC_H_<br>
          <br>#include "pico/stdlib.h"<br>
          <br>// Song definition macros<br>#define MAX_LEN 160<br>#define NUM_SERVOS 8<br>#define NUM_SONGS 23<br>
          <br>// Song struct definition<br>typedef struct {<br>&nbsp; &nbsp; uint beat_period;<br>&nbsp; &nbsp; uint notes[NUM_SERVOS][MAX_LEN];<br>&nbsp; &nbsp; uint end_beat;<br>} song_t;<br>
          <br>// store song pointers in array<br>extern song_t* song_list[NUM_SONGS];<br>
          <br>// songs as extern (defined by c file)<br>// allows inclusion into xylophone.c<br>extern song_t alma_mater;<br>extern song_t baby_shark;<br>extern song_t carol_of_the_bells;<br>extern song_t chopsticks;<br>extern song_t chords;<br>extern song_t dreidel;<br>extern song_t happy_birthday;<br>extern song_t jingle_bells;<br>extern song_t leave_the_door_open;<br>extern song_t love_story;<br>extern song_t mario;<br>extern song_t ode_to_joy;<br>extern song_t office;<br>extern song_t old_mcdonald;<br>extern song_t rick_roll;<br>extern song_t scale;<br>extern song_t spring;<br>extern song_t star_wars;<br>extern song_t thousand_miles;<br>extern song_t twinkle;<br>extern song_t whole_new_world;<br>extern song_t wii_sports;<br>extern song_t want_u_back;<br>
          <br>#endif<br>
        </h1>
        <h1 class="u-align-left u-custom-font u-font-titillium-web u-text u-text-6"><b>music. c</b>
          <br>
          <br>#include "music.h"<br>
          <br>// store song pointers in array<br>// indexable by program selector<br>song_t* song_list[NUM_SONGS] = {<br>&nbsp; &nbsp; &amp;scale,<br>&nbsp; &nbsp; &amp;happy_birthday,<br>&nbsp; &nbsp; &amp;wii_sports,<br>&nbsp; &nbsp; &amp;alma_mater,<br>&nbsp; &nbsp; &amp;chopsticks,<br>&nbsp; &nbsp; &amp;jingle_bells,<br>&nbsp; &nbsp; &amp;old_mcdonald,<br>&nbsp; &nbsp; &amp;chords,<br>&nbsp; &nbsp; &amp;baby_shark,<br>&nbsp; &nbsp; &amp;dreidel,<br>&nbsp; &nbsp; &amp;rick_roll,<br>&nbsp; &nbsp; &amp;twinkle,<br>&nbsp; &nbsp; &amp;office,<br>&nbsp; &nbsp; &amp;want_u_back,<br>&nbsp; &nbsp; &amp;thousand_miles,<br>&nbsp; &nbsp; &amp;whole_new_world,<br>&nbsp; &nbsp; &amp;carol_of_the_bells,<br>&nbsp; &nbsp; &amp;leave_the_door_open,<br>&nbsp; &nbsp; &amp;love_story,<br>&nbsp; &nbsp; &amp;mario,<br>&nbsp; &nbsp; &amp;ode_to_joy,<br>&nbsp; &nbsp; &amp;spring,<br>&nbsp; &nbsp; &amp;star_wars,<br>};<br>
        </h1>
        <img class="u-image u-image-default u-image-1" src="images/ScreenShot2022-12-09at6.35.12PM.png" alt="" data-image-width="938" data-image-height="842">
        <h1 class="u-align-center u-custom-font u-font-titillium-web u-text u-text-7"><i><b>Appendix C</b></i>
        </h1>
        <img class="u-image u-image-default u-image-2" src="images/ScreenShot2022-12-11at10.39.57PM.png" alt="" data-image-width="1428" data-image-height="1106">
        <h1 class="u-align-center u-custom-font u-font-titillium-web u-text u-text-8">Figure 11. Electrical schematic for our final project.&nbsp;</h1>
        <h1 class="u-align-center u-custom-font u-font-titillium-web u-text u-text-9"><i><b>Appendix D</b></i>
        </h1>
        <h1 class="u-align-center u-custom-font u-font-titillium-web u-text u-text-10"><i>Karina</i>
          <br>Music arrangement<br>Optoisolator circuit assembly<br>
          <br><i>Zoe</i>
          <br>Mechanical design<br>Servo electrical integration<br>Servo damping<br>
          <br><i>Harris</i>
          <br>Mechanical fabrication<br>Music data management<br>Timing management<br>
        </h1>
        <h1 class="u-align-center u-custom-font u-font-titillium-web u-text u-text-11"><i><b>Appendix E</b></i>
        </h1>
        <h1 class="u-align-center u-custom-font u-font-titillium-web u-text u-text-12">References used:&nbsp;<br>
          <span style="font-style: italic;">
            <span style="text-decoration: underline !important; font-style: italic;">
              <a href="https://protosupplies.com/product/servo-motor-micro-sg90/" class="u-active-none u-border-none u-btn u-button-link u-button-style u-hover-none u-none u-text-palette-1-base u-btn-1" target="_blank">Servo motors</a>
              <br>
            </span>
            <a href="https://www.raspberrypi.com/documentation/microcontrollers/raspberry-pi-pico.html" class="u-active-none u-border-none u-btn u-button-link u-button-style u-hover-none u-none u-text-palette-1-base u-btn-2" target="_blank">Raspberry Pi Pico</a>
          </span>
          <br>
          <a href="https://vanhunteradams.com/Pico/ReactionWheel/HBridgeCircuit.html" class="u-active-none u-border-none u-btn u-button-link u-button-style u-hover-none u-none u-text-palette-1-base u-btn-3" target="_blank">PWM signal code from Lab 3</a>
        </h1>
      </div>
    </section>
    
  </body>
</html>
