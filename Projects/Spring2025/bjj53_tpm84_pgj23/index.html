<!DOCTYPE HTML>
<!--
	Prologue by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>ECE 4750 Final Report</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
	</head>
	<body class="is-preload">

		<!-- Header -->
			<div id="header">

				<div class="top">

					<!-- Logo -->
						<div id="logo">
							<span class="image avatar48"><img src="images/game_screen_shot.png" alt="" /></span>
							<h1 id="title">Bruce Jagid, Paul Judge, Thomas McIntyre</h1>
							<!-- <p>Hyperspace Engineer</p> -->
						</div>

					<!-- Nav -->
						<nav id="nav">
							<ul>
								<li><a href="#top" id="top-link"><span class="icon solid fa-home">Home</span></a></li>
								<li><a href="#demo" id="demo-link"><span class="icon solid fa-th">Demo</span></a></li>
								<li><a href="#intro" id="intro-link"><span class="icon solid fa-th">Intro</span></a></li>
								<li><a href="#high-level-design" id="high-level-design-link"><span class="icon solid fa-th">High Level Design</span></a></li>
								<li><a href="#program-design" id="program-design-link"><span class="icon solid fa-th">Program Design</span></a></li>
								<li><a href="#hardware-design" id="hardware-design-link"><span class="icon solid fa-th">Hardware Design</span></a></li>
								<li><a href="#results" id="results-link"><span class="icon solid fa-th">Results</span></a></li>
								<li><a href="#conclusion" id="conclusion-link"><span class="icon solid fa-th">Conclusion</span></a></li>
								<li><a href="#appendices" id="appendices-link"><span class="icon solid fa-th">Appendices</span></a></li>

								<!-- <li><a href="#contact" id="contact-link"><span class="icon solid fa-envelope">Contact</span></a></li> -->
							</ul>
						</nav>

				</div>

				<div class="bottom">

					<!-- Social Icons
						<ul class="icons">
							<li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
							<li><a href="#" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
							<li><a href="#" class="icon brands fa-github"><span class="label">Github</span></a></li>
							<li><a href="#" class="icon brands fa-dribbble"><span class="label">Dribbble</span></a></li>
							<li><a href="#" class="icon solid fa-envelope"><span class="label">Email</span></a></li>
						</ul> -->

				</div>

			</div>

		<!-- Main -->
			<div id="main" >

				<!-- Intro -->
					<section id="top" class="one dark cover">
						<div class="container">

							<header>
								<h2 class="alt"><strong>Asteroid Defense!</strong></h2>
								<p>A 2D gravity-based asteroid defense game.</p>
							</header>

							<footer>
								<a href="#demo" class="button scrolly">Demo</a>
							</footer>

						</div>
					</section>

				<!-- Demo -->
					<section id="demo" class="two">
						<div class="container">

							<header>
								<h2>Demo</h2>
							</header>

							<iframe width="560" height="315" 
								src="https://www.youtube.com/embed/rI8U_539hhM">
					  		</iframe>

						</div>
					</section>

				<!-- Intro -->
				<section id="intro" class="three">
					<div class="container">

						<header>
							<h2>Intro</h2>
						</header>

						<!-- <a href="#" class="image featured"><img src="images/pic08.jpg" alt="" /></a> -->

						<p style="text-align: left;">
						For our final project, we implemented an 80s-inspired space-themed arcade game. We based our design off of the classic game asteroids, wherein the player controls a rocket ship as it navigates and destroys asteroids with a laser. However, we introduce a unique twist - the player must defend a planet (placed in the center of the screen), and navigate around it subject to orbital physics. The player controls the rocket ship using a joystick with 8 different combinations of directions and a miniature peddle for thrust, while continuously shooting lasers. Asteroids spawn randomly in clumps at different corners of the screen and spread out after orbiting the planet. The planet is home to 4 cities at the east, west, north, and south faces, each with three lives. Upon collision with an asteroid, a building from the nearest city will be destroyed. Once all cities are gone, or the player's ship has collided with an object three times, the game is over. Each laser makes a high frequency sound, and the thrust and explosion sounds utilize white noise. </p>
						<img src="./images/demo1.png" alt="demo of game">
						<p><strong>Figure 1.</strong> Asteroids!</p>

					</div>
				</section>

					</section>

					<!-- High Level Design -->
					<section id="high-level-design" class="four" >
						<div class="container">

							<header>
								<h2>High Level Design </h2>
							</header>

							<!-- <a href="#" class="image featured"><img src="images/pic08.jpg" alt="" /></a> -->

							<header>
								<h3>Gameplay</h3>
							</header>
							<p style="text-align: left;">
							Our main goal for this game was to create a gameplay loop that incorporated the somewhat unintuitive nature of 
							orbital mechanics. We wanted to force the player to develop a basic understanding of these mechanics to be able to 
							effectively navigate the play-space, and successfully shoot down asteroids. The main way we did this was by limiting the navigation and offensive options of the player.
							</p>

							<p style="text-align: left;">
								The player controls an orbiting rocket ship which can rotate freely in space, but can only accelerate in the direction it is pointing. 
								This forces the player to learn to understand how the direction of thrust in a rocket affects its orbit. In a game without gravity,
								the navigation would be as simple as pointing the rocket towards the location the player wished to go to, and hitting the accererator. 
								Howver, in orbit, this is not so simple. Acceleration always affects the shape of the player's orbit. For example, acceleration in the 
								direction of the rocket's current velocity will raise the height of the orbit on the oposite side of the planet. Conversely, accelerating 
								against the direction of the rocketship's current velocity will lower the height of the orbit on the oposite side of the planet, potentially enough
								that the orbital path intersects with the planet, causing the rocket to crash unless other action is taken. We chose to have the edges of the screen
								loop around to each other rather than making them hard barriers to make sure the rocket is always being affected by gravity. Raising the orbit enough that the rocket hits the edge of the screen
								will mean that the rocket loops around to the opposite edge of the screen. This was found to be a much smoother experience than just bouncing the ship off the edge of the screen, which felt jarring during gameplay testing
							</p>

							<p style="text-align: left;">
								The rocket can only shoot lasers in the direction it is facing. This causes an inherent tradeoff with the thrust of the rocket, as 
								it can also only be applied in the direction of the rocket. Say, for example, the player wants to shoot at a group of asteroids on the far side
								of the screen. These asteroids are out of range of the rocket's lasers, and so the player must make a navigation choice in order to place 
								the rocket in a position it can shoot the asteroids. Thrusting towards the asteroids could cause the rocket to raise it's orbit height on the far side 
								of the planet so much that the rocket would be even farther from the asteroids after the pass, giving them more time to spiral inwards if the player cannot
								manage to shoot all of them. If the dynamics of the situation are slightly different, accelerating towards the asteroids could cause the rocket to lose all of
								its velocity relative to the planet, risking the rocket falling into the planet and crashing unless the player can add enough speed back after shooting the asteroids to regain
								a stable orbit.
							</p>

							<p style="text-align: left;">
								Making these types of descisions and overcoming challenges is what makes the core of the game fun to play, and so it was important to us to tune the parameters of the game to 
								make sure the player encounters these choices regularly. This is why the asteroids come in waves from different corners of the screen, and why their 
								positions and velocities are slightly randomized. The asteroids slowly spread out as they spiral inwards towards the planet, forcing the player to navigate
								the space if they want to shoot all of them down.
							</p>

							<header>
								<h3>Gravity Simulation Background Math </h3>
							</header>
							<p style="text-align: left;">
							The whole game runs on top of a simple 2D gravity simulation that uses Newton's law of gravity to update the positions
							of the ship and asteroids every frame. The following psudeocode represents the simplest possible version of this algorithm
							which simulates just one pointlike ship orbiting a pointlike planet:
							</p>
<!-- HTML generated using hilite.me --><div style="text-align: left; background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #408080; font-style: italic">//loop repeats every frame</span>
<span style="color: #008000; font-weight: bold">while</span>(<span style="color: #666666">1</span>){
	<span style="color: #408080; font-style: italic">//calculate angle between center of ship and center of ship</span>
	angle <span style="color: #666666">=</span> atan2(the_ship.y<span style="color: #666666">-</span>the_planet.y, the_ship.x <span style="color: #666666">-</span> the_planet.x);
	<span style="color: #408080; font-style: italic">// calculate the squared distance between ship and planet </span>
	<span style="color: #408080; font-style: italic">//(because gravity follows inverse square, we do not need a square root)</span>
	distance_sq <span style="color: #666666">=</span> abs(the_planet.x<span style="color: #666666">-</span>the_ship.x)<span style="color: #666666">*</span>abs(the_planet.x<span style="color: #666666">-</span>the_ship.x) <span style="color: #666666">+</span> abs(the_planet.y<span style="color: #666666">-</span>the_ship.y)<span style="color: #666666">*</span>abs(the_planet.y<span style="color: #666666">-</span>the_ship.y);
	<span style="color: #408080; font-style: italic">//calculate the total force of gravity on the ship</span>
	force <span style="color: #666666">=</span> <span style="color: #666666">-1*</span>GRAV_CONST<span style="color: #666666">*</span>(the_planet.mass<span style="color: #666666">*</span>the_ship.mass)<span style="color: #666666">/</span>distance_sq;
	<span style="color: #408080; font-style: italic">// convert total force to total acceleration</span>
	accel <span style="color: #666666">=</span> force<span style="color: #666666">/</span>the_ship.mass;

	<span style="color: #408080; font-style: italic">//separate the total acceleration into it&#39;s x and y components</span>
	accel_x <span style="color: #666666">=</span> accel<span style="color: #666666">*</span>cos(angle)<span style="color: #666666">+</span>thrust_x;
	accel_y <span style="color: #666666">=</span> accel<span style="color: #666666">*</span>sin(angle)<span style="color: #666666">+</span>thrust_y;

	<span style="color: #408080; font-style: italic">//use euler integration to update ship&#39;s velocity and position</span>
	the_ship.vx <span style="color: #666666">=</span> the_ship.vx <span style="color: #666666">+</span> accel_x; 
	the_ship.vy <span style="color: #666666">=</span> the_ship.vy <span style="color: #666666">+</span> accel_y; 
	the_ship.x <span style="color: #666666">=</span> the_ship.x <span style="color: #666666">+</span> the_ship.vx;
	the_ship.y <span style="color: #666666">=</span> the_ship.y <span style="color: #666666">+</span> the_ship.vy;
}
</pre></div>
						<p style="text-align: left;">
							This algorithm is also run for every asteroid on screen.
							</p>

							

							<header>
								<h3>Logical Structure </h3>
							</header>
							<a href="#" class="image featured"><img src="images/flow_chart_1.png" alt="" /></a>
							<p><strong>Figure 2.</strong> Flow Chart of Logical Structure</p>


						</div>
					</section>

					<!-- Program Design -->
					<section id="program-design" class="five">
						<div class="container">

							<header>
								<h2>Program Design </h2>
							</header>

							<!-- <a href="#" class="image featured"><img src="images/pic08.jpg" alt="" /></a> -->

							<p style="text-align: left;">The game runs at 30 frames per second, and the physics and gameplay are all updated on a frame by frame basis. 
								Each frame the program does a multitude of condition checks and updates to a set of stucts that represent each of the game objects, then updates the VGA screen.</p>

								<a href="#" class="image featured"><img src="images/game_screen_shot.png" alt="Example Shot of Game in Progress" /></a>
								<p><strong>Figure 3.</strong> Example Shot of Game in progress</p>

							<header>
								<h3>Structures </h3>
							</header>

							<header>
								<h4>The Planet </h4>
							</header>
							<!-- HTML generated using hilite.me --><div style="text-align: left;background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #008000; font-weight: bold">typedef</span> <span style="color: #008000; font-weight: bold">struct</span> {
    <span style="color: #B00040">float</span> x;
    <span style="color: #B00040">float</span> y;
    <span style="color: #B00040">float</span> radius;
    <span style="color: #B00040">float</span> mass;
    <span style="color: #B00040">float</span> atmosphere;
} Planet;
</pre></div>


							<p style="text-align: left;">The planet is placed in the center of the screen, and
								is the object that all other objects orbit around. It has the largest mass of the system, and 
								it's position is not updated based off of the potential gravity of any other objects in order to 
								keep the game stable, and prevent the planet from drifting off screen. The planet is represented on screen 
								by a filled in dark green circle with a pixel radius equal to the radius variable. We found that the large
								radius of the planet meant that there could be noticable flickering if it was redrawn every frame, and so the planet is 
								only redrawn when an event occurs that could draw over it, such as the ship or an asteroid colliding with it.
							</p>

							<p style="text-align: left;">
								The <code>atmosphere</code> variable of the planet is the distance in pixels away from the radius of the planet that the edge of the atmosphere 
								is drawn, represented by a cyan circle. It is drawn every frame. The purpose of the atmosphere is to slow down
								the asteroids that pass through it so that they will spiral in towards the planet and collide. This is done by checking
								if the distance of the asteroids from the center of the planet is less than the radius plus the atmosphere variable. If it is,
								the asteroids experience "drag", which is approximated by multiplying the velocity of the asteroid by 0.994 plus a random number
								between 0 and 0.001 every frame. The random variable is there to help spread the asteroids out as they spiral in towards the planet,
								which adds another layer of challenge to the game.
							</p>

							<header>
								<h4>The Ship </h4>
							</header>
							<!-- HTML generated using hilite.me --><div style="text-align: left;background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #008000; font-weight: bold">typedef</span> <span style="color: #008000; font-weight: bold">struct</span> {
    <span style="color: #B00040">float</span> x;
    <span style="color: #B00040">float</span> y;
    <span style="color: #B00040">float</span> vx;
    <span style="color: #B00040">float</span> vy;
    <span style="color: #B00040">float</span> radius;
    <span style="color: #B00040">float</span> mass;
    <span style="color: #B00040">int</span> direction;
    <span style="color: #B00040">int</span> lives;
} Ship;
</pre></div>
							<p style="text-align: left;">
								The ship is the most complex object in the game. Every frame, the ship needs to be set to a new direction based off of the 
								user's inputs, have it's acceleration updated by the gravity of the planet, have its acceleration updated if the user is instructing the ship to thrust,
								update its position and velocity based off of the calculated accelration this frame, check if it has collided with an asteroid or the planet, and be erased
								and redrawn.
							</p>

							<p style="text-align: left;">
								The ship can face in eight possible directions; Up, Down, Left, Right, Up-Left, Up-Right, Down-Left, and Down-Right. 
								These correspond to the eight states the digital joystick can provide. Every frame, the joystick inputs are read by the program, 
								which sets the direction variable of the ship to the value that corresponds with the direction the user is pointing the joystick.
								This direction variable is then used for three things; how the ship is redrawn, the direction of the acceleration vector of the ship if
								the ship is under thrust, and what direction to shoot the lasers.
							</p>

							<p style="text-align: left;">
								Every frame, a new acceleration vector is created by calculating the acceleration due to the gravity of the planet.
								The acceleration vector due to the rocket engine is added to this vector if the user has the thrust button held down that frame. 
								The program then modifies the ship's velocity and position vectors through euler integration.
							</p>

							<p style="text-align: left;">
								The "radius" of this ship is approximately it's length, and is used to approximate collison detection without having to 
								create a more complicated collison detection algorithm for the pentagonal rocketship. If the rocketship collides with an
								asteroid or the planet, the game is paused while a 1 second long explosion animation is played. The explosion animation alternates
								between drawing red and yellow circles every 100 ms, whule playing the explosion sound. One life is then subtracted from the ship's 
								total lives, and the ship and asteroids are reset to their initial positions.The ship starts with three lives, and once all lives have
								been exhausted, the game ends.
							</p>

							<a href="#" class="image featured"><img src="images/ship_collide_planet.png" alt="Example of Ship Being Destroyed by Collison with planet" /></a>
							<p><strong>Figure 4.</strong>Example of Ship Being Destroyed by Collison with planet</p>

							<p style="text-align: left;">
								The ship is erased and redrawn every frame by the custom function <code>drawShip()</code>. This 
								function takes in the ship's position and direction, and draws an image of the ship facing the input direction. 
								The function contains 8 different hard-coded sequences of lines to draw based off of what direction the ship is facing.
							</p>

							<p style="text-align: left;">
								While the ship is under thrust, a rocket exhaust animation plays. 
								This consists of alternating yellow and cyan triangles that change size throught the 4 frames of the animation to produce a flickering flickering fire-like effect.
							</p>

							<header>
								<h4>The Asteroids </h4>
							</header>

							<!-- HTML generated using hilite.me --><div style="text-align: left;background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #008000; font-weight: bold">typedef</span> <span style="color: #008000; font-weight: bold">struct</span> {
    <span style="color: #B00040">float</span> x;
    <span style="color: #B00040">float</span> y;
    <span style="color: #B00040">float</span> vx;
    <span style="color: #B00040">float</span> vy;
    <span style="color: #B00040">float</span> radius;
    <span style="color: #B00040">float</span> mass;
    <span style="color: #B00040">bool</span> off_screen;
    <span style="color: #B00040">int</span> exploding;
    <span style="color: #B00040">int</span> ex_anim_count;
} Asteroid;
<span style="color: #008000; font-weight: bold">const</span> <span style="color: #B00040">int</span> asteroid_num <span style="color: #666666">=</span> <span style="color: #666666">8</span>;
Asteroid the_asteroids[<span style="color: #666666">8</span>];
</pre></div>

				

							<p style="text-align: left;">
								Players must shoot the astroids down before they hit the planet. Shotting an asteroid with a laser will destroy it and gain the player a point. The astroids enter the screen in waves, and slowly
								spiral inwards towards the planet before exploding on collision. The astroid waves are sent in every time all astroids on screen
								have been destroyed. A global variable <code>redraw</code> is set to true whenever all asteroids are gone. To prevent asteroids appearing immediately after they have all been destroyed, a varible <code>corner_counter</code> is used that at least 200 frames pass in between all asteroids being destroyed and them being redrawn.
								The asteroids enter the screen from the 4 corners, starting from the top-right,
								and cycling counter clockwise around the screen. They are sent in clusters of eight asteroids at a time. The astroids postions and 
								velocities are slightly randomized to allow them to follow different trajectories, but they must start out in a tight cluster 
								to ensure they all roughly follow the trajectoy found that skims the atmosphere, as if any asteroids didn't hit the atmosphere,
								then they would never stop orbiting.
							</p>

							<p style="text-align: left;">
								When an asteroid collides with the planet or a laser, the variables <code>off_screen</code> and <code>exploding</code>
								are set to true. The <code>off_screen</code> variable tells the program to stop updating this asteroid's postion, and to stop drawing it. This is reset only
								when the asteroids are redrawn for a new wave. The <code>exploding</code> is active for 15 frames, during which an explosion animation is played.
								The <code>ex_anim_count</code> variable is used to keep track of the frames the explosion animation is active.
								The explosion animation consists of alternating red and yellow circles that alternate between a larger size and a smaller size
								every two frames, which gives the illusion of an explanding explosion. During this time, the explosion sound is also played every frame. After 15 frames,
								the <code>exploding</code> and <code>ex_anim_count</code> variables for the destroyed asteroid are reset, and the astroid's position is moved out 
								of frame so that it does not cause flickering.
							</p>
							<a href="#" class="image featured"><img src="images/laser_destroying_asteroid.png" alt="Example of Laser destoying Asteroid" /></a>
							<p><strong>Figure 5.</strong>Example of Laser destoying Asteroid</p>




							<header>
								<h4>The Lasers</h4>
							</header>

							<!-- HTML generated using hilite.me --><div style="text-align: left;background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #008000; font-weight: bold">typedef</span> <span style="color: #008000; font-weight: bold">struct</span> {
    <span style="color: #B00040">float</span> x;
    <span style="color: #B00040">float</span> y;
    <span style="color: #B00040">float</span> vx;
    <span style="color: #B00040">float</span> vy;
    <span style="color: #B00040">int</span> direction;
    <span style="color: #B00040">bool</span> exist;
} Laser;
Laser the_lasers[<span style="color: #666666">8</span>];
</pre></div>
							<p style="text-align: left;">
								The lasers are a list of lines that are constantly being shot from the front of the rocket. They are 
								not affected by gravity, and will continue with the velocity they are given at creation until they
								collide with an object.
							</p>

							<p style="text-align: left;">
								Each Laser's velocity and direction are determined by the ship's velocity and direction at the time of
								the laser's creation. The laser will so will travel in the same 
								direction the ship is pointing. The velocity vector is the addition of the ship's velocity vector and a set laser
								velocity, whose direction is determined by the ship. Originally, the laser's did not take into account the motion of 
								the ship, all all lasers traveled at the same velocit. However, during testing it was found that this felt less natural then
								lasers that traveled at a velocity relative to the ship.
							</p>

							<p style="text-align: left;">
								There are never more than 8 lasers in existance during the game. The variable <code>laser_inc</code>
								keeps track of the index of the oldest laser in existance. Every 4th frame, this laser's position is reset to the 
								front of the ship, and the velocity is reset to be the standard laser velocity in the direction of the ship, plus the 
								ships velocity. Each time a laser is reset, the laser-fire sound is played.
							</p>

							<p style="text-align: left;">
								If a laser collides with either an asteroid or a ship, the <code>exist</code> variable is set to false, and the laser 
								stops being drawn on screen, and cannot interact with any other objects. When it is time for this laser to be reset,
								this variable is set back to true so that the laser can again be seen on screen and interact with objects.
							</p>

							<header>
								<h4>The Cities</h4>
							</header>
							<!-- HTML generated using hilite.me --><div style="text-align: left;background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #008000; font-weight: bold">typedef</span> <span style="color: #008000; font-weight: bold">struct</span>{
    <span style="color: #B00040">int</span> num;
    <span style="color: #B00040">int</span> health;
} City;

City the_cities[<span style="color: #666666">4</span>];
</pre></div>
							<p style="text-align: left;">
								At the start of the game, the planet has 4 cities on it's surface. They lie at the very top, bottom, left, and right
								points of the planet. The cities are numbered from zero to three to designate which one lies where, starting at the top and incrementing
								as the cities are placed clockwise around the planet. Each city has a <code>health</code> value, which can range from zero to three. The health 
								value is represented on screen by the number of buildings. Each city starts out with three buldings, a short one, a tall one, and a medium one.
								The <code>drawCity()</code> function takes in a city and draws the correct number of buildings based off of the health of the city. If the city
								is at full health, all cities will be drawn. If the city loses one health point, only the tall and short buildings will be drawn. If the city only has 
								one health point, only the short building will be drawn. And of course no buildings will be drawn if the city is at zero health.
							</p>

							<p style="text-align: left;">
								Every time an asteroid collides with the planet, the collision position is checked against 4 equally spaced regions on the planet's surface,
								each of which corresponds to one of the cities on the planet. If the city corresponding to the region that the asteroid hit still has health
								above zero, then one health point will be deducted from that city. Once all cities have reached zero health, the game ends.
							</p>

							<a href="#" class="image featured"><img src="images/asteroids_destroying_city.png" alt="Example of Asteroid Destroying Cities" /></a>
							<p><strong>Figure 6.</strong>Example of Asteroids Destroying Cities</p>
							<header>
								<h3>Start and End Screens </h3>
							</header>

							<a href="#" class="image featured"><img src="images/start_screen.jpg" alt="Start Screen" /></a>
							<p><strong>Figure 7.</strong>Start Screen</p>

							<!-- <img src="./images/start_screen.jpg" alt="Start Screen"> -->

							<p style="text-align: left;">
								On Startup, the game displays a simple start screen which instructs the player to press the button
								to play. This screen was added to let the player make a desicion to start the game, rather than just starting
								when someone turns the RP2040 on or the game ends. This screen is drawn once and then the program continually reads
								the gpio associated with the thrust button until it is pressed. Pressing the button starts the game and plays a laser sound.
							</p>

							<a href="#" class="image featured"><img src="images/end_screen.jpg" alt="End Screen" /></a>
							<p><strong>Figure 7.</strong>End Screen</p>


							<p style="text-align: left;">
								After the game ends, either by the player exhausting the ship's lives or by all cities being destroyed, the 
								game displays this ending screen. This displays the number of asteroids the player has shot down as the score, 
								displays the highest score achieved while the RP2040 has been running. Pressing the thurst button returns to the start screen.
							</p>

							<header>
								<h3> Laser and Explosion/Thrust Sound Effects</h3>
							</header>
                        	
							<p style="text-align: left;">
 In order to generate laser sound effects, we utilize direct digital synthesis, convert the synthesized frequencies into an analog signal by utilizing an off-board DAC, and then feed the output of that DAC to two speakers. The DAC has two channels, denoted A and B in the documentation and code. Channel A is used to generate the laser sound effects, while channel B generates explosion/thrust sound effects, since both events use the same sound.</p>
                            
<!-- HTML generated using hilite.me --><div style="text-align: left; background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"> <span style="color: #333399; font-weight: bold">int</span> i ;
  <span style="color: #333399; font-weight: bold">float</span> ramp;
  <span style="color: #008800; font-weight: bold">for</span> (i<span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">0</span>; i<span style="color: #333333">&lt;</span>(sine_table_size); i<span style="color: #333333">++</span>){
        <span style="color: #008800; font-weight: bold">if</span>(i<span style="color: #333333">&lt;</span><span style="color: #0000DD; font-weight: bold">100</span>){
            ramp <span style="color: #333333">=</span> i<span style="color: #333333">/</span><span style="color: #6600EE; font-weight: bold">100.0</span>;
        } <span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">if</span>(i<span style="color: #333333">&gt;</span>sine_table_size<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">100</span>){
            ramp <span style="color: #333333">=</span> (sine_table_size<span style="color: #333333">-</span>i)<span style="color: #333333">/</span><span style="color: #6600EE; font-weight: bold">100.0</span>;
        } <span style="color: #008800; font-weight: bold">else</span>{
            ramp <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">1</span>;
        }
    <span style="color: #008800; font-weight: bold">if</span>(i<span style="color: #333333">&lt;</span><span style="color: #0000DD; font-weight: bold">64</span>){
        raw_sin[i] <span style="color: #333333">=</span> (<span style="color: #333399; font-weight: bold">int</span>)(<span style="color: #0000DD; font-weight: bold">2047</span><span style="color: #333333">*</span>ramp<span style="color: #333333">*</span><span style="color: #6600EE; font-weight: bold">0.5</span> <span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">2047</span>);
    } <span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">if</span>(i<span style="color: #333333">&lt;</span><span style="color: #0000DD; font-weight: bold">128</span>){
        raw_sin[i] <span style="color: #333333">=</span> (<span style="color: #333399; font-weight: bold">int</span>)(<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">*</span><span style="color: #0000DD; font-weight: bold">2047</span><span style="color: #333333">*</span>ramp<span style="color: #333333">*</span><span style="color: #6600EE; font-weight: bold">0.5</span> <span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">2047</span>);
    } <span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">if</span>(i <span style="color: #333333">&lt;</span> <span style="color: #0000DD; font-weight: bold">192</span>){
        raw_sin[i] <span style="color: #333333">=</span> (<span style="color: #333399; font-weight: bold">int</span>)(<span style="color: #0000DD; font-weight: bold">2047</span><span style="color: #333333">*</span>ramp<span style="color: #333333">*</span><span style="color: #6600EE; font-weight: bold">0.5</span> <span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">2047</span>);
    }<span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">if</span>(i <span style="color: #333333">&lt;</span> <span style="color: #0000DD; font-weight: bold">256</span>){
        raw_sin[i] <span style="color: #333333">=</span> (<span style="color: #333399; font-weight: bold">int</span>)(<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">*</span><span style="color: #0000DD; font-weight: bold">2047</span><span style="color: #333333">*</span>ramp<span style="color: #333333">*</span><span style="color: #6600EE; font-weight: bold">0.5</span> <span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">2047</span>); 
    }<span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">if</span>(i <span style="color: #333333">&lt;</span> <span style="color: #0000DD; font-weight: bold">320</span>){
        raw_sin[i] <span style="color: #333333">=</span> (<span style="color: #333399; font-weight: bold">int</span>)(<span style="color: #0000DD; font-weight: bold">2047</span><span style="color: #333333">*</span>ramp<span style="color: #333333">*</span><span style="color: #6600EE; font-weight: bold">0.5</span> <span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">2047</span>); 
    }<span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">if</span>(i <span style="color: #333333">&lt;</span> <span style="color: #0000DD; font-weight: bold">384</span>){
        raw_sin[i] <span style="color: #333333">=</span> (<span style="color: #333399; font-weight: bold">int</span>)(<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">*</span><span style="color: #0000DD; font-weight: bold">2047</span><span style="color: #333333">*</span>ramp<span style="color: #333333">*</span><span style="color: #6600EE; font-weight: bold">0.5</span> <span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">2047</span>); 
    }<span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">if</span>(i <span style="color: #333333">&lt;</span> <span style="color: #0000DD; font-weight: bold">448</span>){
        raw_sin[i] <span style="color: #333333">=</span> (<span style="color: #333399; font-weight: bold">int</span>)(<span style="color: #0000DD; font-weight: bold">2047</span><span style="color: #333333">*</span>ramp<span style="color: #333333">*</span><span style="color: #6600EE; font-weight: bold">0.5</span> <span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">2047</span>); 
    }<span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">if</span>(i <span style="color: #333333">&lt;</span> <span style="color: #0000DD; font-weight: bold">512</span>){
        raw_sin[i] <span style="color: #333333">=</span> (<span style="color: #333399; font-weight: bold">int</span>)(<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">*</span><span style="color: #0000DD; font-weight: bold">2047</span><span style="color: #333333">*</span>ramp<span style="color: #333333">*</span><span style="color: #6600EE; font-weight: bold">0.5</span> <span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">2047</span>); 
    }<span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">if</span>(i <span style="color: #333333">&lt;</span> <span style="color: #0000DD; font-weight: bold">576</span>){
        raw_sin[i] <span style="color: #333333">=</span> (<span style="color: #333399; font-weight: bold">int</span>)(<span style="color: #0000DD; font-weight: bold">2047</span><span style="color: #333333">*</span>ramp<span style="color: #333333">*</span><span style="color: #6600EE; font-weight: bold">0.5</span> <span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">2047</span>); 
    }<span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">if</span>(i <span style="color: #333333">&lt;</span> <span style="color: #0000DD; font-weight: bold">640</span>){
        raw_sin[i] <span style="color: #333333">=</span> (<span style="color: #333399; font-weight: bold">int</span>)(<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">*</span><span style="color: #0000DD; font-weight: bold">2047</span><span style="color: #333333">*</span>ramp<span style="color: #333333">*</span><span style="color: #6600EE; font-weight: bold">0.5</span> <span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">2047</span>); 
    }<span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">if</span>(i <span style="color: #333333">&lt;</span> <span style="color: #0000DD; font-weight: bold">704</span>){
        raw_sin[i] <span style="color: #333333">=</span> (<span style="color: #333399; font-weight: bold">int</span>)(<span style="color: #0000DD; font-weight: bold">2047</span><span style="color: #333333">*</span>ramp<span style="color: #333333">*</span><span style="color: #6600EE; font-weight: bold">0.5</span> <span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">2047</span>);
    }<span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">if</span>(i <span style="color: #333333">&lt;</span> <span style="color: #0000DD; font-weight: bold">768</span>){
        raw_sin[i] <span style="color: #333333">=</span> (<span style="color: #333399; font-weight: bold">int</span>)(<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">*</span><span style="color: #0000DD; font-weight: bold">2047</span><span style="color: #333333">*</span>ramp<span style="color: #333333">*</span><span style="color: #6600EE; font-weight: bold">0.5</span> <span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">2047</span>);  
    }<span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">if</span>(i <span style="color: #333333">&lt;</span> <span style="color: #0000DD; font-weight: bold">832</span>){
        raw_sin[i] <span style="color: #333333">=</span> (<span style="color: #333399; font-weight: bold">int</span>)(<span style="color: #0000DD; font-weight: bold">2047</span><span style="color: #333333">*</span>ramp<span style="color: #333333">*</span><span style="color: #6600EE; font-weight: bold">0.5</span> <span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">2047</span>); 
    }<span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">if</span>(i <span style="color: #333333">&lt;</span> <span style="color: #0000DD; font-weight: bold">896</span>){
        raw_sin[i] <span style="color: #333333">=</span> (<span style="color: #333399; font-weight: bold">int</span>)(<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">*</span><span style="color: #0000DD; font-weight: bold">2047</span><span style="color: #333333">*</span>ramp<span style="color: #333333">*</span><span style="color: #6600EE; font-weight: bold">0.5</span> <span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">2047</span>);
    }<span style="color: #008800; font-weight: bold">else</span> <span style="color: #008800; font-weight: bold">if</span>(i <span style="color: #333333">&lt;</span> <span style="color: #0000DD; font-weight: bold">960</span>){
        raw_sin[i] <span style="color: #333333">=</span> (<span style="color: #333399; font-weight: bold">int</span>)(<span style="color: #0000DD; font-weight: bold">2047</span><span style="color: #333333">*</span>ramp<span style="color: #333333">*</span><span style="color: #6600EE; font-weight: bold">0.5</span> <span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">2047</span>);  
    } <span style="color: #008800; font-weight: bold">else</span>{
        raw_sin[i] <span style="color: #333333">=</span> (<span style="color: #333399; font-weight: bold">int</span>)(<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span><span style="color: #333333">*</span><span style="color: #0000DD; font-weight: bold">2047</span><span style="color: #333333">*</span>ramp<span style="color: #333333">*</span><span style="color: #6600EE; font-weight: bold">0.5</span> <span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">2047</span>);
    }
      DAC_data[i] <span style="color: #333333">=</span> DAC_config_chan_A <span style="color: #333333">|</span> (raw_sin[i] <span style="color: #333333">&amp;</span> <span style="color: #005588; font-weight: bold">0x0fff</span>) ;
  }
</pre></div>

							<p style="text-align: left;">
The above code generates the DDS sine table for the laser sound effect. We utilize a ramp up / down function in order to prevent the DAC from creating loud popping sounds at hard sound level transitions. The code synthesizes a frequency of approximately 390 Hz</p>


<!-- HTML generated using hilite.me --><div style="text-align: left; background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">for</span> (i<span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">0</span>; i<span style="color: #333333">&lt;</span>(sine_table_size); i<span style="color: #333333">++</span>){
    ramp<span style="color: #333333">=</span><span style="color: #0000DD; font-weight: bold">8</span>;
    raw_sin_1[i] <span style="color: #333333">=</span> (<span style="color: #333399; font-weight: bold">int</span>)(ramp<span style="color: #333333">*</span><span style="color: #0000DD; font-weight: bold">2047</span><span style="color: #333333">*</span>(<span style="color: #333399; font-weight: bold">float</span>)rand()<span style="color: #333333">/</span>RAND_MAX <span style="color: #333333">+</span> <span style="color: #0000DD; font-weight: bold">2047</span>); <span style="color: #888888">//12 bit</span>
    DAC_data_1[i] <span style="color: #333333">=</span> DAC_config_chan_B <span style="color: #333333">|</span> (raw_sin_1[i] <span style="color: #333333">&amp;</span> <span style="color: #005588; font-weight: bold">0x0fff</span>) ;
}
</pre></div>
							<p style="text-align: left;">
The above code generates the DDS sine table for the explosion sound effect. We utilize the ramp as a multiplier to increase the magnitude of the white noise, and a normalized rand function to produce the noise. </p>
							<p style="text-align: left;">
The DAC sound effects are handled by two seperate DMA channels. The laser sound effect plays unconditionally since lasers are constantly fired, while the explosion/thrust sound effect is triggered when those events occur.</p>

							<!-- <a href="#" class="image featured"><img src="images/pic08.jpg" alt="" /></a> -->

							<header>
								<h3> Player Inputs</h3>
							</header>
							<p style="text-align: left;">
								The player's inputs were an eight direction digital joystick, and a button. These inputs were polled every frame. The joystick had 4 GPIO inputs, each corresponding to a cardinal direction,
								i.e. up,down,left,right. Diagonals created by activating both a vertical input and a horizontal input. The ship
								would be set to the direction the joystick was being pushed in. If the joystick did not provide an input signal, ie, the joystick 
								wasn't being used, then the ship would retain its direction from the previous frame The  
								button was a simple on-off button that was used to exist the start and end screens, adn turn on the ship's rocket engine.
							</p>

							<header>
								<h3>VGA Outputs</h3>
							</header>
							<p style="text-align: left;">
								The current frame was drawn onto the screen using a 4-bit color <a href="https://vanhunteradams.com/Pico/Galton/Galton.html"> VGA driver that was used in lab 2</a>.
								To meet timing requirements, only the pixels that made up the asteroids and ship were drawn every frame, once in black to erase them, and once more to 
								update their new positions.
							</p>

						</div>
					</section>

					<!-- Hardware Design -->
					<section id="hardware-design" class="six">
						<div class="container">

							<header>
								<h2>Hardware Design </h2>
							</header>

							<!-- <a href="#" class="image featured"><img src="images/pic08.jpg" alt="" /></a> -->

							<header>
								<h3>Schematic </h3>
							</header>
                            <img src="./images/schematic.png" alt="schematic" width="500" height="500">
							<p><strong>Figure 8.</strong>Schematic</p>
							<p> A high-level schematic of our project is presented above. The hardware elements we utilized for the project were the RP2040 board and computer for program generation, a peddle for thrust, a vga adapter and monitor for graphics, a DAC and speakers for sound effects, and a joystick for directional input, as well as resistors for pulldown. </p>

							<header>
								<h3>Debouncing </h3>
							</header>

							<p style="text-align: left;">
								All of our inputs to the game were physical switches or buttons, which required debouncing code to prevent the game 
								detecting multiple inputs if the button were pressed once. We used this debouncing state machine for each of the four inputs of the 
								joystick, and for the thrust button.
							</p>
							<!-- HTML generated using hilite.me --><div style="text-align: left;background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #408080; font-style: italic">//debouncing code</span>
<span style="color: #008000; font-weight: bold">if</span>(pressed_state <span style="color: #666666">==</span> NOT_PRESSED){
    <span style="color: #008000; font-weight: bold">if</span>(button_val <span style="color: #666666">!=</span> <span style="color: #666666">0</span>){
        pressed_state <span style="color: #666666">=</span> MAYBE_PRESSED;
        possible <span style="color: #666666">=</span> <span style="color: #666666">1</span>;
    }
}
<span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(pressed_state <span style="color: #666666">==</span> MAYBE_PRESSED){
    <span style="color: #408080; font-style: italic">// On Transition from state MAYBE_PRESSED to state PRESSED, change the button state</span>
    <span style="color: #008000; font-weight: bold">if</span>(button_val <span style="color: #666666">==</span> up_possible){
        pressed_state <span style="color: #666666">=</span> PRESSED;
        
        waiting <span style="color: #666666">=</span> <span style="color: #008000">false</span>;
    }
    <span style="color: #008000; font-weight: bold">else</span>{
        pressed_state <span style="color: #666666">=</span> NOT_PRESSED;
    }
}
<span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(pressed_state <span style="color: #666666">==</span> PRESSED){
    <span style="color: #008000; font-weight: bold">if</span>(button_val <span style="color: #666666">==</span> up_possible){
        pressed_state <span style="color: #666666">=</span> PRESSED;
    }
    <span style="color: #008000; font-weight: bold">else</span>{
        pressed_state <span style="color: #666666">=</span> MAYBE_NOT_PRESSED;
    }
}
<span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span> (pressed_state <span style="color: #666666">==</span> MAYBE_NOT_PRESSED){
    <span style="color: #008000; font-weight: bold">if</span>(button_val <span style="color: #666666">==</span> up_possible){
        pressed_state <span style="color: #666666">=</span> PRESSED;
    }
    <span style="color: #008000; font-weight: bold">else</span>{
        pressed_state <span style="color: #666666">=</span> NOT_PRESSED;
    }
}
</pre></div>


						</div>
					</section>

					<!-- Results -->
					<section id="results" class="seven">
						<div class="container">

							<header>
								<h2>Results</h2>
							</header>

							<!-- <a href="#" class="image featured"><img src="images/pic08.jpg" alt="" /></a> -->

							<p style="text-align: left;">
								Our game had to consistently run at a stable 30 frames per second, without any major physics or visual glitches.
								In order to capture the feel of the old school arcade games that inspired us, it also had to be able to be picked up and 
								played by just about anyone while still remaining challenging. 
							</p>

							<header>
								<h3>Stability and Framerate</h3>
							</header>

							<p style="text-align: left;">
								We were initially worried that making the timing requirements to meet 30 frames per second would be an issue, as for each of the asteroids and the ship we had to 
								perform a tangent function, a sine function, and a cosine function using floating-point numbers. We also had numerous objects moving around
								on screen that had to be redrawn every frame. We knew from 
								<a href="https://vanhunteradams.com/Pico/Galton/Galton.html">lab 2</a> that floating-point operations and drawing to the vga screen are both 
								time-expensive, and so we took some initial percautions to avoid failing to meet timing requirements, such as only redrawing objects when there was 
								reason to, and limiting the amount of objects that could be on screen at a time. We programed the RP2040's LED to turn off whenever the game failed to make the necessary
								calculations for a frame within the timing requirement. During all of our testing, we never found the game to fall below 30 frames per second.
							</p>

							<p style="text-align: left;">
								The results of our visual stability were not perfect, but were overall successfull. Occasionally, there would be some flickering in 
								the visuals. This was almost always caused by the redrawing of the planet, which was a large circle and had a lot of pixels that needed to be redrawn. 
								We were able to limit this by only redrawing the planet only when an asteroid was near it, and the effect was subtle in the first place.
							</p>
							
							<header>
								<h3>Usability</h3>
							</header>

							<p style="text-align: left;">
								Throughout the course of development, we playtested the game extensively, and invited many TA's and classmates to 
								have a go playing the game and to make suggestions. Notable suggestions include adding an atmosphere around the planet 
								to have the asteroids spiral inwards rather than just fall, and to have the ship travel accross screen edges rather than bounce off of 
								them. Both of these suggestions improved the feel of the game and made it more fun. It is hard to have an objective measure of how well we 
								accomplished our goal of making the game easy to pick up and play, but in the final stages of development, everyone we showed the game to was 
								able to intuit how the game was played just by watching someone else play it, and when given controls, was able to shoot down at least a few asteroids.
							</p>

							<p style="text-align: left;">
								As for how fun the game was, we recived sigifigant positve feedback from players, and anecdotally, we 
								it was not uncommon for us to accidentally waste time during lab by just playing the game and trying to 
								beat each other's high scores. 
							</p>
							

						</div>
					</section>

					<!-- Conclusion -->
					<section id="conclusion" class="eight">
						<div class="container">

							<header>
								<h2>Conclusion</h2>
							</header>

							<!-- <a href="#" class="image featured"><img src="images/pic08.jpg" alt="" /></a> -->

							<p style="text-align: left;">
								
	All in all, this lab provided lots of great opportunities for us to combine and synthesize the skills we had learned over the course of the semester. Ultimately, we felt pretty satisfied with the end result. We had achieved our goal of creating a retro-style game featuring asteroids and orbital physics, and whats more, we received feedback that our game was actually fun to play. This is likely in great part due to the fact that we struck a good balance between difficulty and playability. However, given more time, it would have been cool to implement a hard mode for players who wanted an even greater challenge. Our hard mode could have included things like friendly fire, which would make the cities take damage when hit by the ships lasers. Another feature that we would have liked to implement was saving the high score of the game through power cycles. We could have done this using plug-in flash memory.
 
							</p>
							
							<p style="text-align: left;">
								As far as considerations of intellectual property go, our game is inspired by the classic arcade game Asteroids. We believe that our game itself is significantly different enough from the arcade game in order to be its own published game. The gameplay is significantly different and includes features like the planet, the cities, and orbital gravity mechanics that are not in the Asteroids game. However, we would have to come up with our own title for our game rather than just calling it Asteroids.						 
														</p>

						</div>
					</section>

					<!-- Appendix -->
					<section id="appendices" class="nine">
						<div class="container">

							<header>
								<h2>Appendices</h2>
							</header>

							<!-- <a href="#" class="image featured"><img src="images/pic08.jpg" alt="" /></a> -->

							<header>
								<h3>Appendix A: Permissions</h3>
							</header>

							<p style="text-align: left;">
								The group approves this report for inclusion on the course website.
							</p>

							<p style="text-align: left;">
								The group approves the video for inclusion on the course youtube channel.
							</p>

							<header>
								<h3>Appendix B: Code</h3>
							</header>

							<!-- HTML generated using hilite.me --><div style="text-align: left;background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic"> *</span>
<span style="color: #408080; font-style: italic"> * HARDWARE CONNECTIONS</span>
<span style="color: #408080; font-style: italic"> *  - GPIO 16 ---&gt; VGA Hsync</span>
<span style="color: #408080; font-style: italic"> *  - GPIO 17 ---&gt; VGA Vsync</span>
<span style="color: #408080; font-style: italic"> *  - GPIO 18 ---&gt; 470 ohm resistor ---&gt; VGA Green </span>
<span style="color: #408080; font-style: italic"> *  - GPIO 19 ---&gt; 330 ohm resistor ---&gt; VGA Green</span>
<span style="color: #408080; font-style: italic"> *  - GPIO 20 ---&gt; 330 ohm resistor ---&gt; VGA Blue</span>
<span style="color: #408080; font-style: italic"> *  - GPIO 21 ---&gt; 330 ohm resistor ---&gt; VGA Red</span>
<span style="color: #408080; font-style: italic"> *  - RP2040 GND ---&gt; VGA GND</span>
<span style="color: #408080; font-style: italic"> *  - GPIO 9 ---&gt; Thrust Button</span>
<span style="color: #408080; font-style: italic"> *  - GPIO 15 ---&gt; Up on Joystick</span>
<span style="color: #408080; font-style: italic"> *  - GPIO 14 ---&gt; Down on Joystick</span>
<span style="color: #408080; font-style: italic"> *  - GPIO 13 ---&gt; Left on Joystick</span>
<span style="color: #408080; font-style: italic"> *  - GPIO 15 ---&gt; Right on Joystick</span>
<span style="color: #408080; font-style: italic"> *  - GPIO 4 ---&gt; MISO</span>
<span style="color: #408080; font-style: italic"> *  - GPIO 5 ---&gt; CS</span>
<span style="color: #408080; font-style: italic"> *  - GPIO 6 ---&gt; SCK</span>
<span style="color: #408080; font-style: italic"> *  - GPIO 15 ---&gt; MOSI</span>
<span style="color: #408080; font-style: italic"> */</span>

<span style="color: #408080; font-style: italic">// Include the VGA grahics library</span>
<span style="color: #BC7A00">#include &quot;vga16_graphics.h&quot;</span>
<span style="color: #408080; font-style: italic">// Include standard libraries</span>
<span style="color: #BC7A00">#include &lt;stdio.h&gt;</span>
<span style="color: #BC7A00">#include &lt;stdlib.h&gt;</span>
<span style="color: #BC7A00">#include &lt;math.h&gt;</span>
<span style="color: #BC7A00">#include &lt;string.h&gt;</span>
<span style="color: #408080; font-style: italic">// Include Pico libraries</span>
<span style="color: #BC7A00">#include &quot;pico/stdlib.h&quot;</span>
<span style="color: #BC7A00">#include &quot;pico/divider.h&quot;</span>
<span style="color: #BC7A00">#include &quot;pico/multicore.h&quot;</span>
<span style="color: #408080; font-style: italic">// Include hardware libraries</span>
<span style="color: #BC7A00">#include &quot;hardware/spi.h&quot;</span>
<span style="color: #BC7A00">#include &quot;hardware/pio.h&quot;</span>
<span style="color: #BC7A00">#include &quot;hardware/dma.h&quot;</span>
<span style="color: #BC7A00">#include &quot;hardware/clocks.h&quot;</span>
<span style="color: #BC7A00">#include &quot;hardware/pll.h&quot;</span>
<span style="color: #408080; font-style: italic">// Include protothreads</span>
<span style="color: #BC7A00">#include &quot;pt_cornell_rp2040_v1_3.h&quot;</span>


<span style="color: #408080; font-style: italic">// uS per frame</span>
<span style="color: #BC7A00">#define FRAME_RATE 33000</span>
<span style="color: #BC7A00">#define WINDOW_WIDTH 640 </span>
<span style="color: #408080; font-style: italic">// #define THRUST 1</span>
<span style="color: #BC7A00">#define WINDOW_HEIGHT 480</span>

<span style="color: #408080; font-style: italic">// the color of the boid</span>
<span style="color: #B00040">char</span> color <span style="color: #666666">=</span> WHITE ;

<span style="color: #408080; font-style: italic">// gravitational constant for newton law of gravity. (set absurdly high so we don&#39;t need to make the mass for the planet a big number)</span>
<span style="color: #BC7A00">#define GRAV_CONST 16</span>
<span style="color: #408080; font-style: italic">// acceleration due to thrust</span>
<span style="color: #BC7A00">#define THRUST 0.2</span>

<span style="color: #408080; font-style: italic">//planet struct</span>
<span style="color: #008000; font-weight: bold">typedef</span> <span style="color: #008000; font-weight: bold">struct</span> {
    <span style="color: #B00040">float</span> x;
    <span style="color: #B00040">float</span> y;
    <span style="color: #B00040">float</span> radius;
    <span style="color: #B00040">float</span> mass;
    <span style="color: #B00040">float</span> atmosphere;
} Planet;

<span style="color: #408080; font-style: italic">//rocket ship struct</span>
<span style="color: #008000; font-weight: bold">typedef</span> <span style="color: #008000; font-weight: bold">struct</span> {
    <span style="color: #B00040">float</span> x;
    <span style="color: #B00040">float</span> y;
    <span style="color: #B00040">float</span> vx;
    <span style="color: #B00040">float</span> vy;
    <span style="color: #B00040">float</span> radius;
    <span style="color: #B00040">float</span> mass;
    <span style="color: #B00040">int</span> direction;
    <span style="color: #B00040">int</span> lives;
} Ship;

<span style="color: #408080; font-style: italic">//laser struct</span>
<span style="color: #008000; font-weight: bold">typedef</span> <span style="color: #008000; font-weight: bold">struct</span> {
    <span style="color: #B00040">float</span> x;
    <span style="color: #B00040">float</span> y;
    <span style="color: #B00040">float</span> vx;
    <span style="color: #B00040">float</span> vy;
    <span style="color: #B00040">int</span> direction;
    <span style="color: #B00040">bool</span> exist;
} Laser;

<span style="color: #408080; font-style: italic">//counts how many frames since last laser has been shot</span>
<span style="color: #B00040">int</span> laser_counter <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="color: #408080; font-style: italic">//keeps track of which laser in array was shot longest ago</span>
<span style="color: #B00040">int</span> laser_inc <span style="color: #666666">=</span> <span style="color: #666666">0</span>;

<span style="color: #408080; font-style: italic">//asteroud struct</span>
<span style="color: #008000; font-weight: bold">typedef</span> <span style="color: #008000; font-weight: bold">struct</span> {
    <span style="color: #B00040">float</span> x;
    <span style="color: #B00040">float</span> y;
    <span style="color: #B00040">float</span> vx;
    <span style="color: #B00040">float</span> vy;
    <span style="color: #B00040">float</span> radius;
    <span style="color: #B00040">float</span> mass;
    <span style="color: #B00040">bool</span> off_screen;
    <span style="color: #B00040">int</span> exploding;
    <span style="color: #B00040">int</span> ex_anim_count;
} Asteroid;

<span style="color: #408080; font-style: italic">//definitions so we don&#39;t have to remember this</span>
<span style="color: #BC7A00">#define NORTH 0</span>
<span style="color: #BC7A00">#define EAST 1</span>
<span style="color: #BC7A00">#define SOUTH 2</span>
<span style="color: #BC7A00">#define WEST 3</span>

<span style="color: #408080; font-style: italic">//city struct</span>
<span style="color: #008000; font-weight: bold">typedef</span> <span style="color: #008000; font-weight: bold">struct</span>{
    <span style="color: #B00040">int</span> num;
    <span style="color: #B00040">int</span> health;
} City;

<span style="color: #408080; font-style: italic">//intialize all objects as global variables</span>
City the_cities[<span style="color: #666666">4</span>];
Planet the_planet;
Ship the_ship;
Laser the_lasers[<span style="color: #666666">8</span>];
<span style="color: #008000; font-weight: bold">const</span> <span style="color: #B00040">int</span> laser_num <span style="color: #666666">=</span> <span style="color: #666666">8</span>;
<span style="color: #008000; font-weight: bold">const</span> <span style="color: #B00040">int</span> asteroid_num <span style="color: #666666">=</span> <span style="color: #666666">8</span>;
Asteroid the_asteroids[<span style="color: #666666">8</span>];

<span style="color: #408080; font-style: italic">// debouncing code</span>
<span style="color: #BC7A00">#define NOT_PRESSED 0</span>
<span style="color: #BC7A00">#define MAYBE_PRESSED 1</span>
<span style="color: #BC7A00">#define PRESSED 2</span>
<span style="color: #BC7A00">#define MAYBE_NOT_PRESSED 3</span>
<span style="color: #BC7A00">#define LED      25</span>

<span style="color: #408080; font-style: italic">//directions are defined so we don&#39;t have to remember them</span>
<span style="color: #BC7A00">#define UP 5</span>
<span style="color: #BC7A00">#define DOWN 4</span>
<span style="color: #BC7A00">#define LEFT 7</span>
<span style="color: #BC7A00">#define RIGHT 6</span>
<span style="color: #BC7A00">#define UPLEFT 1</span>
<span style="color: #BC7A00">#define DOWNLEFT 3</span>
<span style="color: #BC7A00">#define UPRIGHT 0</span>
<span style="color: #BC7A00">#define DOWNRIGHT 2</span>

<span style="color: #408080; font-style: italic">//ship height and width</span>
<span style="color: #BC7A00">#define SHIP_H 16</span>
<span style="color: #BC7A00">#define SHIP_W 8</span>

<span style="color: #408080; font-style: italic">//variable for input debouncing code</span>
<span style="color: #B00040">int</span> thrust_button_val <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="color: #008000; font-weight: bold">volatile</span> <span style="color: #B00040">unsigned</span> <span style="color: #B00040">int</span> thrust_pressed_state <span style="color: #666666">=</span> <span style="color: #666666">0</span> ;
<span style="color: #008000; font-weight: bold">volatile</span> <span style="color: #B00040">int</span> thrust_possible <span style="color: #666666">=</span> <span style="color: #666666">0</span> ;

<span style="color: #B00040">int</span> up_button_val <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="color: #008000; font-weight: bold">volatile</span> <span style="color: #B00040">unsigned</span> <span style="color: #B00040">int</span> up_pressed_state <span style="color: #666666">=</span> <span style="color: #666666">0</span> ;
<span style="color: #008000; font-weight: bold">volatile</span> <span style="color: #B00040">int</span> up_possible <span style="color: #666666">=</span> <span style="color: #666666">0</span> ;

<span style="color: #B00040">int</span> down_button_val <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="color: #008000; font-weight: bold">volatile</span> <span style="color: #B00040">unsigned</span> <span style="color: #B00040">int</span> down_pressed_state <span style="color: #666666">=</span> <span style="color: #666666">0</span> ;
<span style="color: #008000; font-weight: bold">volatile</span> <span style="color: #B00040">int</span> down_possible <span style="color: #666666">=</span> <span style="color: #666666">0</span> ;

<span style="color: #B00040">int</span> left_button_val <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="color: #008000; font-weight: bold">volatile</span> <span style="color: #B00040">unsigned</span> <span style="color: #B00040">int</span> left_pressed_state <span style="color: #666666">=</span> <span style="color: #666666">0</span> ;
<span style="color: #008000; font-weight: bold">volatile</span> <span style="color: #B00040">int</span> left_possible <span style="color: #666666">=</span> <span style="color: #666666">0</span> ;

<span style="color: #B00040">int</span> right_button_val <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="color: #008000; font-weight: bold">volatile</span> <span style="color: #B00040">unsigned</span> <span style="color: #B00040">int</span> right_pressed_state <span style="color: #666666">=</span> <span style="color: #666666">0</span> ;
<span style="color: #008000; font-weight: bold">volatile</span> <span style="color: #B00040">int</span> right_possible <span style="color: #666666">=</span> <span style="color: #666666">0</span> ;

<span style="color: #408080; font-style: italic">// keeps track of what flame the rocket exhaust animation is in</span>
<span style="color: #B00040">int</span> thruster_val <span style="color: #666666">=</span> <span style="color: #666666">0</span>;


<span style="color: #408080; font-style: italic">// queue for asteroids</span>
<span style="color: #BC7A00">#define A_QUEUE 8</span>
<span style="color: #B00040">int</span> queue <span style="color: #666666">=</span> <span style="color: #666666">0</span>;

<span style="color: #408080; font-style: italic">// define so don&#39;t get confused</span>
<span style="color: #BC7A00">#define TOPRIGHT 0</span>
<span style="color: #BC7A00">#define TOPLEFT 1</span>
<span style="color: #BC7A00">#define BOTTOMLEFT 2</span>
<span style="color: #BC7A00">#define BOTTOMRIGHT 3</span>
<span style="color: #B00040">int</span> corner <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="color: #B00040">int</span> corner_counter <span style="color: #666666">=</span> <span style="color: #666666">1</span>;

<span style="color: #408080; font-style: italic">// Number of samples per period in sine table</span>
<span style="color: #BC7A00">#define sine_table_size 1024</span>

<span style="color: #408080; font-style: italic">// Sine table</span>
<span style="color: #B00040">int</span> raw_sin[sine_table_size] ;

<span style="color: #408080; font-style: italic">// Table of values to be sent to DAC</span>
<span style="color: #B00040">unsigned</span> <span style="color: #B00040">short</span> DAC_data[sine_table_size] ;

<span style="color: #408080; font-style: italic">// Pointer to the address of the DAC data table</span>
<span style="color: #B00040">unsigned</span> <span style="color: #B00040">short</span> <span style="color: #666666">*</span> DAC_address_pointer <span style="color: #666666">=</span> <span style="color: #666666">&amp;</span>DAC_data[<span style="color: #666666">0</span>] ;

<span style="color: #B00040">int</span> raw_sin_1[sine_table_size] ;

<span style="color: #408080; font-style: italic">// Table of values to be sent to DAC</span>
<span style="color: #B00040">unsigned</span> <span style="color: #B00040">short</span> DAC_data_1[sine_table_size] ;

<span style="color: #408080; font-style: italic">// Pointer to the address of the DAC data table</span>
<span style="color: #B00040">unsigned</span> <span style="color: #B00040">short</span> <span style="color: #666666">*</span> DAC_address_pointer_1 <span style="color: #666666">=</span> <span style="color: #666666">&amp;</span>DAC_data_1[<span style="color: #666666">0</span>] ;


<span style="color: #B00040">int</span> raw_sin_2[sine_table_size] ;

<span style="color: #408080; font-style: italic">// Table of values to be sent to DAC</span>
<span style="color: #B00040">unsigned</span> <span style="color: #B00040">short</span> DAC_data_2[sine_table_size] ;

<span style="color: #408080; font-style: italic">// Pointer to the address of the DAC data table</span>
<span style="color: #B00040">unsigned</span> <span style="color: #B00040">short</span> <span style="color: #666666">*</span> DAC_address_pointer_2 <span style="color: #666666">=</span> <span style="color: #666666">&amp;</span>DAC_data_2[<span style="color: #666666">0</span>] ;
<span style="color: #408080; font-style: italic">// A-channel, 1x, active</span>
<span style="color: #BC7A00">#define DAC_config_chan_A 0b0011000000000000</span>
<span style="color: #BC7A00">#define DAC_config_chan_B 0b1011000000000000</span>

<span style="color: #408080; font-style: italic">//SPI configurations</span>
<span style="color: #BC7A00">#define PIN_MISO 4</span>
<span style="color: #BC7A00">#define PIN_CS   5</span>
<span style="color: #BC7A00">#define PIN_SCK  6</span>
<span style="color: #BC7A00">#define PIN_MOSI 7</span>
<span style="color: #BC7A00">#define SPI_PORT spi0</span>

<span style="color: #408080; font-style: italic">// Number of DMA transfers per event</span>
<span style="color: #008000; font-weight: bold">const</span> <span style="color: #B00040">uint32_t</span> transfer_count <span style="color: #666666">=</span> sine_table_size ;

<span style="color: #408080; font-style: italic">// Select DMA channels</span>
<span style="color: #B00040">int</span> data_chan;
<span style="color: #B00040">int</span> ctrl_chan;

<span style="color: #408080; font-style: italic">// Select DMA channels</span>
<span style="color: #B00040">int</span> data_chan_1;
<span style="color: #B00040">int</span> ctrl_chan_1;

<span style="color: #408080; font-style: italic">// Select DMA channels</span>
<span style="color: #B00040">int</span> data_chan_2;
<span style="color: #B00040">int</span> ctrl_chan_2;

<span style="color: #B00040">char</span> screen_text_buffer[<span style="color: #666666">64</span>];

<span style="color: #408080; font-style: italic">//number of asteroids shot this game</span>
<span style="color: #B00040">int</span> asteroids_shot <span style="color: #666666">=</span> <span style="color: #666666">0</span>;

<span style="color: #408080; font-style: italic">//function: draws ship sprite based off of ship&#39;s position and direction. Color is input so ship can be erased with black</span>
<span style="color: #008000; font-weight: bold">static</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">drawShip</span>(<span style="color: #B00040">float</span> posx, <span style="color: #B00040">float</span> posy, <span style="color: #B00040">int</span> direction, <span style="color: #B00040">char</span> color){
    <span style="color: #008000; font-weight: bold">if</span>(direction <span style="color: #666666">==</span> UPLEFT){
        <span style="color: #B00040">float</span> top_x <span style="color: #666666">=</span> posx <span style="color: #666666">+</span> <span style="color: #666666">3</span>;
        <span style="color: #B00040">float</span> top_y <span style="color: #666666">=</span> posy <span style="color: #666666">+</span> <span style="color: #666666">9</span>;

        <span style="color: #B00040">float</span> right_x <span style="color: #666666">=</span> posx <span style="color: #666666">+</span> <span style="color: #666666">9</span>;
        <span style="color: #B00040">float</span> right_y <span style="color: #666666">=</span> posy <span style="color: #666666">+</span> <span style="color: #666666">3</span>;

        <span style="color: #B00040">float</span> bottom_x <span style="color: #666666">=</span> posx <span style="color: #666666">-</span> <span style="color: #666666">3</span>;
        <span style="color: #B00040">float</span> bottom_y <span style="color: #666666">=</span> posy <span style="color: #666666">-</span> <span style="color: #666666">9</span>;

        <span style="color: #B00040">float</span> left_x <span style="color: #666666">=</span> posx <span style="color: #666666">-</span> <span style="color: #666666">9</span>;
        <span style="color: #B00040">float</span> left_y <span style="color: #666666">=</span> posy <span style="color: #666666">-</span> <span style="color: #666666">3</span>;

        drawLine(top_x, top_y, right_x, right_y, color) ;
        drawLine(right_x, right_y, bottom_x, bottom_y, color) ;
        drawLine(left_x, left_y, bottom_x, bottom_y, color) ;
        drawLine(top_x, top_y, left_x, left_y, color) ;

        drawLine(bottom_x, bottom_y, posx<span style="color: #666666">-12</span>, posy<span style="color: #666666">-12</span>, color) ;
        drawLine(left_x, left_y, posx<span style="color: #666666">-12</span>, posy<span style="color: #666666">-12</span>, color) ;

        <span style="color: #408080; font-style: italic">//rocket exhaust animation</span>
        <span style="color: #008000; font-weight: bold">if</span>(thruster_val <span style="color: #666666">==</span> <span style="color: #666666">1</span>){
            <span style="color: #008000; font-weight: bold">if</span>(color <span style="color: #666666">==</span> BLACK){
                drawLine(top_x<span style="color: #666666">+2</span>, top_y<span style="color: #666666">-2</span>, posx<span style="color: #666666">+9</span>, posy<span style="color: #666666">+9</span>, BLACK) ;
                drawLine(right_x<span style="color: #666666">-2</span>, right_y<span style="color: #666666">+2</span>, posx<span style="color: #666666">+9</span>, posy<span style="color: #666666">+9</span>, BLACK) ;
            } <span style="color: #008000; font-weight: bold">else</span>{
                drawLine(top_x<span style="color: #666666">+2</span>, top_y<span style="color: #666666">-2</span>, posx<span style="color: #666666">+9</span>, posy<span style="color: #666666">+9</span>, YELLOW) ;
                drawLine(right_x<span style="color: #666666">-2</span>, right_y<span style="color: #666666">+2</span>, posx<span style="color: #666666">+9</span>, posy<span style="color: #666666">+9</span>, YELLOW) ;
            }
        }
        <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(thruster_val <span style="color: #666666">==</span> <span style="color: #666666">2</span>){
            <span style="color: #008000; font-weight: bold">if</span>(color <span style="color: #666666">==</span> BLACK){
                drawLine(top_x<span style="color: #666666">+1</span>, top_y<span style="color: #666666">-1</span>, posx<span style="color: #666666">+10</span>, posy<span style="color: #666666">+10</span>, BLACK) ;
                drawLine(right_x<span style="color: #666666">-1</span>, right_y<span style="color: #666666">+1</span>, posx<span style="color: #666666">+10</span>, posy<span style="color: #666666">+10</span>, BLACK) ;
            } <span style="color: #008000; font-weight: bold">else</span>{
                drawLine(top_x<span style="color: #666666">+1</span>, top_y<span style="color: #666666">-1</span>, posx<span style="color: #666666">+10</span>, posy<span style="color: #666666">+10</span>, CYAN) ;
                drawLine(right_x<span style="color: #666666">-1</span>, right_y<span style="color: #666666">+1</span>, posx<span style="color: #666666">+10</span>, posy<span style="color: #666666">+10</span>, CYAN) ;
            }
            
        }
        <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(thruster_val <span style="color: #666666">==</span> <span style="color: #666666">3</span>){
            <span style="color: #008000; font-weight: bold">if</span>(color <span style="color: #666666">==</span> BLACK){
                drawLine(top_x, top_y, posx<span style="color: #666666">+11</span>, posy<span style="color: #666666">+11</span>, BLACK) ;
                drawLine(right_x, right_y, posx<span style="color: #666666">+11</span>, posy<span style="color: #666666">+11</span>, BLACK) ;
            } <span style="color: #008000; font-weight: bold">else</span>{
                drawLine(top_x, top_y, posx<span style="color: #666666">+11</span>, posy<span style="color: #666666">+11</span>, YELLOW) ;
                drawLine(right_x, right_y, posx<span style="color: #666666">+11</span>, posy<span style="color: #666666">+11</span>, YELLOW) ;
            }
            
        }
        <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(thruster_val <span style="color: #666666">==</span> <span style="color: #666666">4</span>){
            <span style="color: #008000; font-weight: bold">if</span>(color <span style="color: #666666">==</span> BLACK){
                drawLine(top_x<span style="color: #666666">+1</span>, top_y<span style="color: #666666">-1</span>, posx<span style="color: #666666">+10</span>, posy<span style="color: #666666">+10</span>, BLACK) ;
                drawLine(right_x<span style="color: #666666">-1</span>, right_y<span style="color: #666666">+1</span>, posx<span style="color: #666666">+10</span>, posy<span style="color: #666666">+10</span>, BLACK) ;
            } <span style="color: #008000; font-weight: bold">else</span>{
                drawLine(top_x<span style="color: #666666">+1</span>, top_y<span style="color: #666666">-1</span>, posx<span style="color: #666666">+10</span>, posy<span style="color: #666666">+10</span>, CYAN) ;
                drawLine(right_x<span style="color: #666666">-1</span>, right_y<span style="color: #666666">+1</span>, posx<span style="color: #666666">+10</span>, posy<span style="color: #666666">+10</span>, CYAN) ;
            }
            
        }
    } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(direction <span style="color: #666666">==</span> UPRIGHT){
        <span style="color: #B00040">float</span> top_x <span style="color: #666666">=</span> posx <span style="color: #666666">+</span> <span style="color: #666666">3</span>;
        <span style="color: #B00040">float</span> top_y <span style="color: #666666">=</span> posy <span style="color: #666666">-</span> <span style="color: #666666">9</span>;

        <span style="color: #B00040">float</span> right_x <span style="color: #666666">=</span> posx <span style="color: #666666">+</span> <span style="color: #666666">9</span>;
        <span style="color: #B00040">float</span> right_y <span style="color: #666666">=</span> posy <span style="color: #666666">-</span> <span style="color: #666666">3</span>;

        <span style="color: #B00040">float</span> bottom_x <span style="color: #666666">=</span> posx <span style="color: #666666">-</span> <span style="color: #666666">3</span>;
        <span style="color: #B00040">float</span> bottom_y <span style="color: #666666">=</span> posy <span style="color: #666666">+</span> <span style="color: #666666">9</span>;

        <span style="color: #B00040">float</span> left_x <span style="color: #666666">=</span> posx <span style="color: #666666">-</span> <span style="color: #666666">9</span>;
        <span style="color: #B00040">float</span> left_y <span style="color: #666666">=</span> posy <span style="color: #666666">+</span> <span style="color: #666666">3</span>;

        drawLine(top_x, top_y, right_x, right_y, color) ;
        drawLine(right_x, right_y, bottom_x, bottom_y, color) ;
        drawLine(left_x, left_y, bottom_x, bottom_y, color) ;
        drawLine(top_x, top_y, left_x, left_y, color) ;

        drawLine(top_x, top_y, posx<span style="color: #666666">+12</span>, posy<span style="color: #666666">-12</span>, color) ;
        drawLine(right_x, right_y, posx<span style="color: #666666">+12</span>, posy<span style="color: #666666">-12</span>, color) ;
        <span style="color: #408080; font-style: italic">//rocket exhaust animation</span>
        <span style="color: #008000; font-weight: bold">if</span>(thruster_val <span style="color: #666666">==</span> <span style="color: #666666">1</span>){
            <span style="color: #008000; font-weight: bold">if</span>(color <span style="color: #666666">==</span> BLACK){
                drawLine(bottom_x<span style="color: #666666">-2</span>, bottom_y<span style="color: #666666">-2</span>, posx<span style="color: #666666">-9</span>, posy<span style="color: #666666">+9</span>, BLACK) ;
                drawLine(left_x<span style="color: #666666">+2</span>, left_y<span style="color: #666666">+2</span>, posx<span style="color: #666666">-9</span>, posy<span style="color: #666666">+9</span>, BLACK) ;
            } <span style="color: #008000; font-weight: bold">else</span>{
                drawLine(bottom_x<span style="color: #666666">-2</span>, bottom_y<span style="color: #666666">-2</span>, posx<span style="color: #666666">-9</span>, posy<span style="color: #666666">+9</span>, YELLOW) ;
                drawLine(left_x<span style="color: #666666">+2</span>, left_y<span style="color: #666666">+2</span>, posx<span style="color: #666666">-9</span>, posy<span style="color: #666666">+9</span>, YELLOW) ;
            }
        }
        <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(thruster_val <span style="color: #666666">==</span> <span style="color: #666666">2</span>){
            <span style="color: #008000; font-weight: bold">if</span>(color <span style="color: #666666">==</span> BLACK){
                drawLine(bottom_x<span style="color: #666666">-1</span>, bottom_y<span style="color: #666666">-1</span>, posx<span style="color: #666666">-10</span>, posy<span style="color: #666666">+10</span>, BLACK) ;
                drawLine(left_x<span style="color: #666666">+1</span>, left_y<span style="color: #666666">+1</span>, posx<span style="color: #666666">-10</span>, posy<span style="color: #666666">+10</span>, BLACK) ;
            } <span style="color: #008000; font-weight: bold">else</span>{
                drawLine(bottom_x<span style="color: #666666">-1</span>, bottom_y<span style="color: #666666">-1</span>, posx<span style="color: #666666">-10</span>, posy<span style="color: #666666">+10</span>, CYAN) ;
                drawLine(left_x<span style="color: #666666">+1</span>, left_y<span style="color: #666666">+1</span>, posx<span style="color: #666666">-10</span>, posy<span style="color: #666666">+10</span>, CYAN) ;
            }
            
        }
        <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(thruster_val <span style="color: #666666">==</span> <span style="color: #666666">3</span>){
            <span style="color: #008000; font-weight: bold">if</span>(color <span style="color: #666666">==</span> BLACK){
                drawLine(bottom_x, bottom_y, posx<span style="color: #666666">-11</span>, posy<span style="color: #666666">+11</span>, BLACK) ;
                drawLine(left_x, left_y, posx<span style="color: #666666">-11</span>, posy<span style="color: #666666">+11</span>, BLACK) ;
            } <span style="color: #008000; font-weight: bold">else</span>{
                drawLine(bottom_x, bottom_y, posx<span style="color: #666666">-11</span>, posy<span style="color: #666666">+11</span>, YELLOW) ;
                drawLine(left_x, left_y, posx<span style="color: #666666">-11</span>, posy<span style="color: #666666">+11</span>, YELLOW) ;
            }
            
        }
        <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(thruster_val <span style="color: #666666">==</span> <span style="color: #666666">4</span>){
            <span style="color: #008000; font-weight: bold">if</span>(color <span style="color: #666666">==</span> BLACK){
                drawLine(bottom_x<span style="color: #666666">-1</span>, bottom_y<span style="color: #666666">-1</span>, posx<span style="color: #666666">-10</span>, posy<span style="color: #666666">+10</span>, BLACK) ;
                drawLine(left_x<span style="color: #666666">+1</span>, left_y<span style="color: #666666">+1</span>, posx<span style="color: #666666">-10</span>, posy<span style="color: #666666">+10</span>, BLACK) ;
            } <span style="color: #008000; font-weight: bold">else</span>{
                drawLine(bottom_x<span style="color: #666666">-1</span>, bottom_y<span style="color: #666666">-1</span>, posx<span style="color: #666666">-10</span>, posy<span style="color: #666666">+10</span>, CYAN) ;
                drawLine(left_x<span style="color: #666666">+1</span>, left_y<span style="color: #666666">+1</span>, posx<span style="color: #666666">-10</span>, posy<span style="color: #666666">+10</span>, CYAN) ;
            }
            
        }
        

    } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(direction <span style="color: #666666">==</span> DOWNLEFT){
        <span style="color: #B00040">float</span> top_x <span style="color: #666666">=</span> posx <span style="color: #666666">+</span> <span style="color: #666666">3</span>;
        <span style="color: #B00040">float</span> top_y <span style="color: #666666">=</span> posy <span style="color: #666666">-</span> <span style="color: #666666">9</span>;

        <span style="color: #B00040">float</span> right_x <span style="color: #666666">=</span> posx <span style="color: #666666">+</span> <span style="color: #666666">9</span>;
        <span style="color: #B00040">float</span> right_y <span style="color: #666666">=</span> posy <span style="color: #666666">-</span> <span style="color: #666666">3</span>;

        <span style="color: #B00040">float</span> bottom_x <span style="color: #666666">=</span> posx <span style="color: #666666">-</span> <span style="color: #666666">3</span>;
        <span style="color: #B00040">float</span> bottom_y <span style="color: #666666">=</span> posy <span style="color: #666666">+</span> <span style="color: #666666">9</span>;

        <span style="color: #B00040">float</span> left_x <span style="color: #666666">=</span> posx <span style="color: #666666">-</span> <span style="color: #666666">9</span>;
        <span style="color: #B00040">float</span> left_y <span style="color: #666666">=</span> posy <span style="color: #666666">+</span> <span style="color: #666666">3</span>;

        drawLine(top_x, top_y, right_x, right_y, color) ;
        drawLine(right_x, right_y, bottom_x, bottom_y, color) ;
        drawLine(left_x, left_y, bottom_x, bottom_y, color) ;
        drawLine(top_x, top_y, left_x, left_y, color) ;

        drawLine(bottom_x, bottom_y, posx<span style="color: #666666">-12</span>, posy<span style="color: #666666">+12</span>, color) ;
        drawLine(left_x, left_y, posx<span style="color: #666666">-12</span>, posy<span style="color: #666666">+12</span>, color) ;
        <span style="color: #408080; font-style: italic">//rocket exhaust animation</span>
        <span style="color: #008000; font-weight: bold">if</span>(thruster_val <span style="color: #666666">==</span> <span style="color: #666666">1</span>){
            <span style="color: #008000; font-weight: bold">if</span>(color <span style="color: #666666">==</span> BLACK){
                drawLine(top_x<span style="color: #666666">+2</span>, top_y<span style="color: #666666">+2</span>, posx<span style="color: #666666">+9</span>, posy<span style="color: #666666">-9</span>, BLACK) ;
                drawLine(right_x<span style="color: #666666">-2</span>, right_y<span style="color: #666666">-2</span>, posx<span style="color: #666666">+9</span>, posy<span style="color: #666666">-9</span>, BLACK) ;
            } <span style="color: #008000; font-weight: bold">else</span>{
                drawLine(top_x<span style="color: #666666">+2</span>, top_y<span style="color: #666666">+2</span>, posx<span style="color: #666666">+9</span>, posy<span style="color: #666666">-9</span>, YELLOW) ;
                drawLine(right_x<span style="color: #666666">-2</span>, right_y<span style="color: #666666">-2</span>, posx<span style="color: #666666">+9</span>, posy<span style="color: #666666">-9</span>, YELLOW) ;
            }
        }
        <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(thruster_val <span style="color: #666666">==</span> <span style="color: #666666">2</span>){
            <span style="color: #008000; font-weight: bold">if</span>(color <span style="color: #666666">==</span> BLACK){
                drawLine(top_x<span style="color: #666666">+1</span>, top_y<span style="color: #666666">+1</span>, posx<span style="color: #666666">+10</span>, posy<span style="color: #666666">-10</span>, BLACK) ;
                drawLine(right_x<span style="color: #666666">-1</span>, right_y<span style="color: #666666">-1</span>, posx<span style="color: #666666">+10</span>, posy<span style="color: #666666">-10</span>, BLACK) ;
            } <span style="color: #008000; font-weight: bold">else</span>{
                drawLine(top_x<span style="color: #666666">+1</span>, top_y<span style="color: #666666">+1</span>, posx<span style="color: #666666">+10</span>, posy<span style="color: #666666">-10</span>, CYAN) ;
                drawLine(right_x<span style="color: #666666">-1</span>, right_y<span style="color: #666666">-1</span>, posx<span style="color: #666666">+10</span>, posy<span style="color: #666666">-10</span>, CYAN) ;
            }
            
        }
        <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(thruster_val <span style="color: #666666">==</span> <span style="color: #666666">3</span>){
            <span style="color: #008000; font-weight: bold">if</span>(color <span style="color: #666666">==</span> BLACK){
                drawLine(top_x, top_y, posx<span style="color: #666666">+11</span>, posy<span style="color: #666666">-11</span>, BLACK) ;
                drawLine(right_x, right_y, posx<span style="color: #666666">+11</span>, posy<span style="color: #666666">-11</span>, BLACK) ;
            } <span style="color: #008000; font-weight: bold">else</span>{
                drawLine(top_x, top_y, posx<span style="color: #666666">+11</span>, posy<span style="color: #666666">-11</span>, YELLOW) ;
                drawLine(right_x, right_y, posx<span style="color: #666666">+11</span>, posy<span style="color: #666666">-11</span>, YELLOW) ;
            }
            
        }
        <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(thruster_val <span style="color: #666666">==</span> <span style="color: #666666">4</span>){
            <span style="color: #008000; font-weight: bold">if</span>(color <span style="color: #666666">==</span> BLACK){
                drawLine(top_x<span style="color: #666666">+1</span>, top_y<span style="color: #666666">+1</span>, posx<span style="color: #666666">+10</span>, posy<span style="color: #666666">-10</span>, BLACK) ;
                drawLine(right_x<span style="color: #666666">-1</span>, right_y<span style="color: #666666">-1</span>, posx<span style="color: #666666">+10</span>, posy<span style="color: #666666">-10</span>, BLACK) ;
            } <span style="color: #008000; font-weight: bold">else</span>{
                drawLine(top_x<span style="color: #666666">+1</span>, top_y<span style="color: #666666">+1</span>, posx<span style="color: #666666">+10</span>, posy<span style="color: #666666">-10</span>, CYAN) ;
                drawLine(right_x<span style="color: #666666">-1</span>, right_y<span style="color: #666666">-1</span>, posx<span style="color: #666666">+10</span>, posy<span style="color: #666666">-10</span>, CYAN) ;
            }
            
        }

    } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(direction <span style="color: #666666">==</span> DOWNRIGHT){
        <span style="color: #B00040">float</span> top_x <span style="color: #666666">=</span> posx <span style="color: #666666">+</span> <span style="color: #666666">3</span>;
        <span style="color: #B00040">float</span> top_y <span style="color: #666666">=</span> posy <span style="color: #666666">+</span> <span style="color: #666666">9</span>;

        <span style="color: #B00040">float</span> right_x <span style="color: #666666">=</span> posx <span style="color: #666666">+</span> <span style="color: #666666">9</span>;
        <span style="color: #B00040">float</span> right_y <span style="color: #666666">=</span> posy <span style="color: #666666">+</span> <span style="color: #666666">3</span>;

        <span style="color: #B00040">float</span> bottom_x <span style="color: #666666">=</span> posx <span style="color: #666666">-</span> <span style="color: #666666">3</span>;
        <span style="color: #B00040">float</span> bottom_y <span style="color: #666666">=</span> posy <span style="color: #666666">-</span> <span style="color: #666666">9</span>;

        <span style="color: #B00040">float</span> left_x <span style="color: #666666">=</span> posx <span style="color: #666666">-</span> <span style="color: #666666">9</span>;
        <span style="color: #B00040">float</span> left_y <span style="color: #666666">=</span> posy <span style="color: #666666">-</span> <span style="color: #666666">3</span>;

        drawLine(top_x, top_y, right_x, right_y, color) ;
        drawLine(right_x, right_y, bottom_x, bottom_y, color) ;
        drawLine(left_x, left_y, bottom_x, bottom_y, color) ;
        drawLine(top_x, top_y, left_x, left_y, color) ;

        drawLine(top_x, top_y, posx<span style="color: #666666">+12</span>, posy<span style="color: #666666">+12</span>, color) ;
        drawLine(right_x, right_y, posx<span style="color: #666666">+12</span>, posy<span style="color: #666666">+12</span>, color) ;
        <span style="color: #408080; font-style: italic">//rocket exhaust animation</span>
        <span style="color: #008000; font-weight: bold">if</span>(thruster_val <span style="color: #666666">==</span> <span style="color: #666666">1</span>){
            <span style="color: #008000; font-weight: bold">if</span>(color <span style="color: #666666">==</span> BLACK){
                drawLine(bottom_x<span style="color: #666666">-2</span>, bottom_y<span style="color: #666666">+2</span>, posx<span style="color: #666666">-9</span>, posy<span style="color: #666666">-9</span>, BLACK) ;
                drawLine(left_x<span style="color: #666666">+2</span>, left_y<span style="color: #666666">-2</span>, posx<span style="color: #666666">-9</span>, posy<span style="color: #666666">-9</span>, BLACK) ;
            } <span style="color: #008000; font-weight: bold">else</span>{
                drawLine(bottom_x<span style="color: #666666">-2</span>, bottom_y<span style="color: #666666">+2</span>, posx<span style="color: #666666">-9</span>, posy<span style="color: #666666">-9</span>, YELLOW) ;
                drawLine(left_x<span style="color: #666666">+2</span>, left_y<span style="color: #666666">-2</span>, posx<span style="color: #666666">-9</span>, posy<span style="color: #666666">-9</span>, YELLOW) ;
            }
        }
        <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(thruster_val <span style="color: #666666">==</span> <span style="color: #666666">2</span>){
            <span style="color: #008000; font-weight: bold">if</span>(color <span style="color: #666666">==</span> BLACK){
                drawLine(bottom_x<span style="color: #666666">-1</span>, bottom_y<span style="color: #666666">+1</span>, posx<span style="color: #666666">-10</span>, posy<span style="color: #666666">-10</span>, BLACK) ;
                drawLine(left_x<span style="color: #666666">+1</span>, left_y<span style="color: #666666">-1</span>, posx<span style="color: #666666">-10</span>, posy<span style="color: #666666">-10</span>, BLACK) ;
            } <span style="color: #008000; font-weight: bold">else</span>{
                drawLine(bottom_x<span style="color: #666666">-1</span>, bottom_y<span style="color: #666666">+1</span>, posx<span style="color: #666666">-10</span>, posy<span style="color: #666666">-10</span>, CYAN) ;
                drawLine(left_x<span style="color: #666666">+1</span>, left_y<span style="color: #666666">-1</span>, posx<span style="color: #666666">-10</span>, posy<span style="color: #666666">-10</span>, CYAN) ;
            }
            
        }
        <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(thruster_val <span style="color: #666666">==</span> <span style="color: #666666">3</span>){
            <span style="color: #008000; font-weight: bold">if</span>(color <span style="color: #666666">==</span> BLACK){
                drawLine(bottom_x, bottom_y, posx<span style="color: #666666">-11</span>, posy<span style="color: #666666">-11</span>, BLACK) ;
                drawLine(left_x, left_y, posx<span style="color: #666666">-11</span>, posy<span style="color: #666666">-11</span>, BLACK) ;
            } <span style="color: #008000; font-weight: bold">else</span>{
                drawLine(bottom_x, bottom_y, posx<span style="color: #666666">-11</span>, posy<span style="color: #666666">-11</span>, YELLOW) ;
                drawLine(left_x, left_y, posx<span style="color: #666666">-11</span>, posy<span style="color: #666666">-11</span>, YELLOW) ;
            }
            
        }
        <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(thruster_val <span style="color: #666666">==</span> <span style="color: #666666">4</span>){
            <span style="color: #008000; font-weight: bold">if</span>(color <span style="color: #666666">==</span> BLACK){
                drawLine(bottom_x<span style="color: #666666">-1</span>, bottom_y<span style="color: #666666">+1</span>, posx<span style="color: #666666">-10</span>, posy<span style="color: #666666">-10</span>, BLACK) ;
                drawLine(left_x<span style="color: #666666">+1</span>, left_y<span style="color: #666666">-1</span>, posx<span style="color: #666666">-10</span>, posy<span style="color: #666666">-10</span>, BLACK) ;
            } <span style="color: #008000; font-weight: bold">else</span>{
                drawLine(bottom_x<span style="color: #666666">-1</span>, bottom_y<span style="color: #666666">+1</span>, posx<span style="color: #666666">-10</span>, posy<span style="color: #666666">-10</span>, CYAN) ;
                drawLine(left_x<span style="color: #666666">+1</span>, left_y<span style="color: #666666">-1</span>, posx<span style="color: #666666">-10</span>, posy<span style="color: #666666">-10</span>, CYAN) ;
            }
            
        }

    } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(direction <span style="color: #666666">==</span> DOWN){
        drawRect(posx<span style="color: #666666">-4</span>, posy<span style="color: #666666">-8</span>, SHIP_W, SHIP_H, color);
        drawLine(posx<span style="color: #666666">+3</span>, posy<span style="color: #666666">+8</span>, posx, posy<span style="color: #666666">+16</span>, color) ;
        drawLine(posx<span style="color: #666666">-4</span>, posy<span style="color: #666666">+8</span>, posx<span style="color: #666666">-1</span>, posy<span style="color: #666666">+16</span>, color) ;
        <span style="color: #408080; font-style: italic">//rocket exhaust animation</span>
        <span style="color: #008000; font-weight: bold">if</span>(thruster_val <span style="color: #666666">==</span> <span style="color: #666666">1</span>){
            <span style="color: #008000; font-weight: bold">if</span>(color <span style="color: #666666">==</span> BLACK){
                drawLine(posx<span style="color: #666666">-2</span>, posy<span style="color: #666666">-8</span>, posx<span style="color: #666666">-1</span>, posy<span style="color: #666666">-13</span>, BLACK) ;
                drawLine(posx<span style="color: #666666">+1</span>, posy<span style="color: #666666">-8</span>, posx, posy<span style="color: #666666">-13</span>, BLACK) ;
            }<span style="color: #008000; font-weight: bold">else</span>{
                drawLine(posx<span style="color: #666666">-2</span>, posy<span style="color: #666666">-8</span>, posx<span style="color: #666666">-1</span>, posy<span style="color: #666666">-13</span>, YELLOW) ;
                drawLine(posx<span style="color: #666666">+1</span>, posy<span style="color: #666666">-8</span>, posx, posy<span style="color: #666666">-13</span>, YELLOW) ;
            }
        }
        <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(thruster_val <span style="color: #666666">==</span> <span style="color: #666666">2</span>){
            <span style="color: #008000; font-weight: bold">if</span>(color <span style="color: #666666">==</span> BLACK){
                drawLine(posx<span style="color: #666666">-3</span>, posy<span style="color: #666666">-8</span>, posx<span style="color: #666666">-1</span>, posy<span style="color: #666666">-14</span>, BLACK) ;
                drawLine(posx<span style="color: #666666">+2</span>, posy<span style="color: #666666">-8</span>, posx, posy<span style="color: #666666">-14</span>, BLACK) ;
            } <span style="color: #008000; font-weight: bold">else</span>{
                drawLine(posx<span style="color: #666666">-3</span>, posy<span style="color: #666666">-8</span>, posx<span style="color: #666666">-1</span>, posy<span style="color: #666666">-14</span>, CYAN) ;
                drawLine(posx<span style="color: #666666">+2</span>, posy<span style="color: #666666">-8</span>, posx, posy<span style="color: #666666">-14</span>, CYAN) ;
            }
        }
        <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(thruster_val <span style="color: #666666">==</span> <span style="color: #666666">3</span>){
            <span style="color: #008000; font-weight: bold">if</span>(color <span style="color: #666666">==</span> BLACK){
                drawLine(posx<span style="color: #666666">-3</span>, posy<span style="color: #666666">-8</span>, posx<span style="color: #666666">-1</span>, posy<span style="color: #666666">-15</span>, BLACK) ;
                drawLine(posx<span style="color: #666666">+2</span>, posy<span style="color: #666666">-8</span>, posx, posy<span style="color: #666666">-15</span>, BLACK) ;
            } <span style="color: #008000; font-weight: bold">else</span>{
                drawLine(posx<span style="color: #666666">-3</span>, posy<span style="color: #666666">-8</span>, posx<span style="color: #666666">-1</span>, posy<span style="color: #666666">-15</span>, YELLOW) ;
                drawLine(posx<span style="color: #666666">+2</span>, posy<span style="color: #666666">-8</span>, posx, posy<span style="color: #666666">-15</span>, YELLOW) ;
            }
            
        }
        <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(thruster_val <span style="color: #666666">==</span> <span style="color: #666666">4</span>){
            <span style="color: #008000; font-weight: bold">if</span>(color <span style="color: #666666">==</span> BLACK){
                drawLine(posx<span style="color: #666666">-3</span>, posy<span style="color: #666666">-8</span>, posx<span style="color: #666666">-1</span>, posy<span style="color: #666666">-14</span>, BLACK) ;
                drawLine(posx<span style="color: #666666">+2</span>, posy<span style="color: #666666">-8</span>, posx, posy<span style="color: #666666">-14</span>, BLACK) ;
            } <span style="color: #008000; font-weight: bold">else</span>{
                drawLine(posx<span style="color: #666666">-3</span>, posy<span style="color: #666666">-8</span>, posx<span style="color: #666666">-1</span>, posy<span style="color: #666666">-14</span>, CYAN) ;
                drawLine(posx<span style="color: #666666">+2</span>, posy<span style="color: #666666">-8</span>, posx, posy<span style="color: #666666">-14</span>, CYAN) ;
            }
            
        }
    } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(direction <span style="color: #666666">==</span> UP){
        drawRect(posx<span style="color: #666666">-4</span>, posy<span style="color: #666666">-8</span>, SHIP_W, SHIP_H, color);
        drawLine(posx<span style="color: #666666">-4</span>, posy<span style="color: #666666">-8</span>, posx<span style="color: #666666">-1</span>, posy<span style="color: #666666">-16</span>, color) ;
        drawLine(posx<span style="color: #666666">+3</span>, posy<span style="color: #666666">-8</span>, posx, posy<span style="color: #666666">-16</span>, color) ;
        <span style="color: #408080; font-style: italic">//rocket exhaust animation</span>
        <span style="color: #008000; font-weight: bold">if</span>(thruster_val <span style="color: #666666">==</span> <span style="color: #666666">1</span>){
            <span style="color: #008000; font-weight: bold">if</span>(color <span style="color: #666666">==</span> BLACK){
                drawLine(posx<span style="color: #666666">-2</span>, posy<span style="color: #666666">+8</span>, posx, posy<span style="color: #666666">+13</span>, BLACK) ;
                drawLine(posx<span style="color: #666666">+1</span>, posy<span style="color: #666666">+8</span>, posx<span style="color: #666666">-1</span>, posy<span style="color: #666666">+13</span>, BLACK) ;
            }<span style="color: #008000; font-weight: bold">else</span>{
                drawLine(posx<span style="color: #666666">-2</span>, posy<span style="color: #666666">+8</span>, posx, posy<span style="color: #666666">+13</span>, YELLOW) ;
                drawLine(posx<span style="color: #666666">+1</span>, posy<span style="color: #666666">+8</span>, posx<span style="color: #666666">-1</span>, posy<span style="color: #666666">+13</span>, YELLOW) ;
            }
        }
        <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(thruster_val <span style="color: #666666">==</span> <span style="color: #666666">2</span>){
            <span style="color: #008000; font-weight: bold">if</span>(color <span style="color: #666666">==</span> BLACK){
                drawLine(posx<span style="color: #666666">-3</span>, posy<span style="color: #666666">+8</span>, posx, posy<span style="color: #666666">+14</span>, BLACK) ;
                drawLine(posx<span style="color: #666666">+2</span>, posy<span style="color: #666666">+8</span>, posx<span style="color: #666666">-1</span>, posy<span style="color: #666666">+14</span>, BLACK) ;
            } <span style="color: #008000; font-weight: bold">else</span>{
                drawLine(posx<span style="color: #666666">-3</span>, posy<span style="color: #666666">+8</span>, posx, posy<span style="color: #666666">+14</span>, CYAN) ;
                drawLine(posx<span style="color: #666666">+2</span>, posy<span style="color: #666666">+8</span>, posx<span style="color: #666666">-1</span>, posy<span style="color: #666666">+14</span>, CYAN) ;
            }
        }
        <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(thruster_val <span style="color: #666666">==</span> <span style="color: #666666">3</span>){
            <span style="color: #008000; font-weight: bold">if</span>(color <span style="color: #666666">==</span> BLACK){
                drawLine(posx<span style="color: #666666">-3</span>, posy<span style="color: #666666">+8</span>, posx, posy<span style="color: #666666">+15</span>, BLACK) ;
                drawLine(posx<span style="color: #666666">+2</span>, posy<span style="color: #666666">+8</span>, posx<span style="color: #666666">-1</span>, posy<span style="color: #666666">+15</span>, BLACK) ;
            } <span style="color: #008000; font-weight: bold">else</span>{
                drawLine(posx<span style="color: #666666">-3</span>, posy<span style="color: #666666">+8</span>, posx, posy<span style="color: #666666">+15</span>, YELLOW) ;
                drawLine(posx<span style="color: #666666">+2</span>, posy<span style="color: #666666">+8</span>, posx<span style="color: #666666">-1</span>, posy<span style="color: #666666">+15</span>, YELLOW) ;
            }
            
        }
        <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(thruster_val <span style="color: #666666">==</span> <span style="color: #666666">4</span>){
            <span style="color: #008000; font-weight: bold">if</span>(color <span style="color: #666666">==</span> BLACK){
                drawLine(posx<span style="color: #666666">-3</span>, posy<span style="color: #666666">+8</span>, posx, posy<span style="color: #666666">+14</span>, BLACK) ;
                drawLine(posx<span style="color: #666666">+2</span>, posy<span style="color: #666666">+8</span>, posx<span style="color: #666666">-1</span>, posy<span style="color: #666666">+14</span>, BLACK) ;
            } <span style="color: #008000; font-weight: bold">else</span>{
                drawLine(posx<span style="color: #666666">-3</span>, posy<span style="color: #666666">+8</span>, posx, posy<span style="color: #666666">+14</span>, CYAN) ;
                drawLine(posx<span style="color: #666666">+2</span>, posy<span style="color: #666666">+8</span>, posx<span style="color: #666666">-1</span>, posy<span style="color: #666666">+14</span>, CYAN) ;
            }
            
        }
    } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(direction <span style="color: #666666">==</span> RIGHT){
        drawRect(posx<span style="color: #666666">-8</span>, posy<span style="color: #666666">-4</span>, SHIP_H, SHIP_W, color);
        drawLine(posx<span style="color: #666666">+8</span>, posy<span style="color: #666666">+3</span>, posx<span style="color: #666666">+16</span>, posy, color) ;
        drawLine(posx<span style="color: #666666">+8</span>, posy<span style="color: #666666">-4</span>, posx<span style="color: #666666">+16</span>, posy<span style="color: #666666">-1</span>, color) ;
        <span style="color: #408080; font-style: italic">//rocket exhaust animation</span>
        <span style="color: #008000; font-weight: bold">if</span>(thruster_val <span style="color: #666666">==</span> <span style="color: #666666">1</span>){
            <span style="color: #008000; font-weight: bold">if</span>(color <span style="color: #666666">==</span> BLACK){
                drawLine(posx<span style="color: #666666">-8</span>, posy<span style="color: #666666">-2</span>, posx<span style="color: #666666">-13</span>, posy<span style="color: #666666">-1</span>, BLACK) ;
                drawLine(posx<span style="color: #666666">-8</span>, posy<span style="color: #666666">+1</span>, posx<span style="color: #666666">-13</span>, posy, BLACK) ;
            }<span style="color: #008000; font-weight: bold">else</span>{
                drawLine(posx<span style="color: #666666">-8</span>, posy<span style="color: #666666">-2</span>, posx<span style="color: #666666">-13</span>, posy<span style="color: #666666">-1</span>, YELLOW) ;
                drawLine(posx<span style="color: #666666">-8</span>, posy<span style="color: #666666">+1</span>, posx<span style="color: #666666">-13</span>, posy, YELLOW) ;
            }
        }
        <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(thruster_val <span style="color: #666666">==</span> <span style="color: #666666">2</span>){
            <span style="color: #008000; font-weight: bold">if</span>(color <span style="color: #666666">==</span> BLACK){
                drawLine(posx<span style="color: #666666">-8</span>, posy<span style="color: #666666">-3</span>, posx<span style="color: #666666">-14</span>, posy<span style="color: #666666">-1</span>, BLACK) ;
                drawLine(posx<span style="color: #666666">-8</span>, posy<span style="color: #666666">+2</span>, posx<span style="color: #666666">-14</span>, posy, BLACK) ;
            } <span style="color: #008000; font-weight: bold">else</span>{
                drawLine(posx<span style="color: #666666">-8</span>, posy<span style="color: #666666">-3</span>, posx<span style="color: #666666">-14</span>, posy<span style="color: #666666">-1</span>, CYAN) ;
                drawLine(posx<span style="color: #666666">-8</span>, posy<span style="color: #666666">+2</span>, posx<span style="color: #666666">-14</span>, posy, CYAN) ;
            }
        }
        <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(thruster_val <span style="color: #666666">==</span> <span style="color: #666666">3</span>){
            <span style="color: #008000; font-weight: bold">if</span>(color <span style="color: #666666">==</span> BLACK){
                drawLine(posx<span style="color: #666666">-8</span>, posy<span style="color: #666666">-3</span>, posx<span style="color: #666666">-15</span>, posy<span style="color: #666666">-1</span>, BLACK) ;
                drawLine(posx<span style="color: #666666">-8</span>, posy<span style="color: #666666">+2</span>, posx<span style="color: #666666">-15</span>, posy, BLACK) ;
            } <span style="color: #008000; font-weight: bold">else</span>{
                drawLine(posx<span style="color: #666666">-8</span>, posy<span style="color: #666666">-3</span>, posx<span style="color: #666666">-15</span>, posy<span style="color: #666666">-1</span>, YELLOW) ;
                drawLine(posx<span style="color: #666666">-8</span>, posy<span style="color: #666666">+2</span>, posx<span style="color: #666666">-15</span>, posy, YELLOW) ;
            }
            
        }
        <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(thruster_val <span style="color: #666666">==</span> <span style="color: #666666">4</span>){
            <span style="color: #008000; font-weight: bold">if</span>(color <span style="color: #666666">==</span> BLACK){
                drawLine(posx<span style="color: #666666">-8</span>, posy<span style="color: #666666">-3</span>, posx<span style="color: #666666">-14</span>, posy<span style="color: #666666">-1</span>, BLACK) ;
                drawLine(posx<span style="color: #666666">-8</span>, posy<span style="color: #666666">+2</span>, posx<span style="color: #666666">-14</span>, posy, BLACK) ;
            } <span style="color: #008000; font-weight: bold">else</span>{
                drawLine(posx<span style="color: #666666">-8</span>, posy<span style="color: #666666">-3</span>, posx<span style="color: #666666">-14</span>, posy<span style="color: #666666">-1</span>, CYAN) ;
                drawLine(posx<span style="color: #666666">-8</span>, posy<span style="color: #666666">+2</span>, posx<span style="color: #666666">-14</span>, posy, CYAN) ;
            }
            
        }
    } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(direction <span style="color: #666666">==</span> LEFT){
        drawRect(posx<span style="color: #666666">-8</span>, posy<span style="color: #666666">-4</span>, SHIP_H, SHIP_W, color);
        drawLine(posx<span style="color: #666666">-8</span>, posy<span style="color: #666666">-4</span>, posx<span style="color: #666666">-16</span>, posy<span style="color: #666666">-1</span>, color) ;
        drawLine(posx<span style="color: #666666">-8</span>, posy<span style="color: #666666">+3</span>, posx<span style="color: #666666">-16</span>, posy, color) ;
        <span style="color: #408080; font-style: italic">//rocket exhaust animation</span>
        <span style="color: #008000; font-weight: bold">if</span>(thruster_val <span style="color: #666666">==</span> <span style="color: #666666">1</span>){
            <span style="color: #008000; font-weight: bold">if</span>(color <span style="color: #666666">==</span> BLACK){
                drawLine(posx<span style="color: #666666">+8</span>, posy<span style="color: #666666">-2</span>, posx<span style="color: #666666">+13</span>, posy, BLACK) ;
                drawLine(posx<span style="color: #666666">+8</span>, posy<span style="color: #666666">+1</span>, posx<span style="color: #666666">+13</span>, posy<span style="color: #666666">-1</span>, BLACK) ;
            }<span style="color: #008000; font-weight: bold">else</span>{
                drawLine(posx<span style="color: #666666">+8</span>, posy<span style="color: #666666">-2</span>, posx<span style="color: #666666">+13</span>, posy, YELLOW) ;
                drawLine(posx<span style="color: #666666">+8</span>, posy<span style="color: #666666">+1</span>, posx<span style="color: #666666">+13</span>, posy<span style="color: #666666">-1</span>, YELLOW) ;
            }
        }
        <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(thruster_val <span style="color: #666666">==</span> <span style="color: #666666">2</span>){
            <span style="color: #008000; font-weight: bold">if</span>(color <span style="color: #666666">==</span> BLACK){
                drawLine(posx<span style="color: #666666">+8</span>, posy<span style="color: #666666">-3</span>, posx<span style="color: #666666">+14</span>, posy, BLACK) ;
                drawLine(posx<span style="color: #666666">+8</span>, posy<span style="color: #666666">+2</span>, posx<span style="color: #666666">+14</span>, posy<span style="color: #666666">-1</span>, BLACK) ;
            } <span style="color: #008000; font-weight: bold">else</span>{
                drawLine(posx<span style="color: #666666">+8</span>, posy<span style="color: #666666">-3</span>, posx<span style="color: #666666">+14</span>, posy, CYAN) ;
                drawLine(posx<span style="color: #666666">+8</span>, posy<span style="color: #666666">+2</span>, posx<span style="color: #666666">+14</span>, posy<span style="color: #666666">-1</span>, CYAN) ;
            }
        }
        <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(thruster_val <span style="color: #666666">==</span> <span style="color: #666666">3</span>){
            <span style="color: #008000; font-weight: bold">if</span>(color <span style="color: #666666">==</span> BLACK){
                drawLine(posx<span style="color: #666666">+8</span>, posy<span style="color: #666666">-3</span>, posx<span style="color: #666666">+15</span>, posy, BLACK) ;
                drawLine(posx<span style="color: #666666">+8</span>, posy<span style="color: #666666">+2</span>, posx<span style="color: #666666">+15</span>, posy<span style="color: #666666">-1</span>, BLACK) ;
            } <span style="color: #008000; font-weight: bold">else</span>{
                drawLine(posx<span style="color: #666666">+8</span>, posy<span style="color: #666666">-3</span>, posx<span style="color: #666666">+15</span>, posy, YELLOW) ;
                drawLine(posx<span style="color: #666666">+8</span>, posy<span style="color: #666666">+2</span>, posx<span style="color: #666666">+15</span>, posy<span style="color: #666666">-1</span>, YELLOW) ;
            }
            
        }
        <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(thruster_val <span style="color: #666666">==</span> <span style="color: #666666">4</span>){
            <span style="color: #008000; font-weight: bold">if</span>(color <span style="color: #666666">==</span> BLACK){
                drawLine(posx<span style="color: #666666">+8</span>, posy<span style="color: #666666">-3</span>, posx<span style="color: #666666">+14</span>, posy, BLACK) ;
                drawLine(posx<span style="color: #666666">+8</span>, posy<span style="color: #666666">+2</span>, posx<span style="color: #666666">+14</span>, posy<span style="color: #666666">-1</span>, BLACK) ;
            } <span style="color: #008000; font-weight: bold">else</span>{
                drawLine(posx<span style="color: #666666">+8</span>, posy<span style="color: #666666">-3</span>, posx<span style="color: #666666">+14</span>, posy, CYAN) ;
                drawLine(posx<span style="color: #666666">+8</span>, posy<span style="color: #666666">+2</span>, posx<span style="color: #666666">+14</span>, posy<span style="color: #666666">-1</span>, CYAN) ;
            }
            
        }
    }
}


<span style="color: #408080; font-style: italic">//draws laser based off of laser&#39;s positon and direction. Color is either black to erase or red</span>
<span style="color: #008000; font-weight: bold">static</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">drawLaser</span>(Laser the_laser, <span style="color: #B00040">char</span> color){
    <span style="color: #008000; font-weight: bold">if</span>(the_laser.direction <span style="color: #666666">==</span> UPRIGHT){
        drawLine(the_laser.x, the_laser.y, the_laser.x<span style="color: #666666">+3</span>, the_laser.y<span style="color: #666666">-3</span>, color);
    } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_laser.direction <span style="color: #666666">==</span> UPLEFT){
        drawLine(the_laser.x, the_laser.y, the_laser.x<span style="color: #666666">-3</span>, the_laser.y<span style="color: #666666">-3</span>, color);
    } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_laser.direction <span style="color: #666666">==</span> DOWNRIGHT){
        drawLine(the_laser.x, the_laser.y, the_laser.x<span style="color: #666666">+3</span>, the_laser.y<span style="color: #666666">+3</span>, color);
    } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_laser.direction <span style="color: #666666">==</span> DOWNLEFT){
        drawLine(the_laser.x, the_laser.y, the_laser.x<span style="color: #666666">-3</span>, the_laser.y<span style="color: #666666">+3</span>, color);
    }
    <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_laser.direction <span style="color: #666666">==</span> UP){
        drawLine(the_laser.x, the_laser.y, the_laser.x, the_laser.y<span style="color: #666666">-4</span>, color);
    } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_laser.direction <span style="color: #666666">==</span> DOWN){
        drawLine(the_laser.x, the_laser.y, the_laser.x, the_laser.y<span style="color: #666666">+4</span>, color);
    } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_laser.direction <span style="color: #666666">==</span> LEFT){
        drawLine(the_laser.x, the_laser.y, the_laser.x<span style="color: #666666">-4</span>, the_laser.y, color);
    } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_laser.direction <span style="color: #666666">==</span> RIGHT){
        drawLine(the_laser.x, the_laser.y, the_laser.x<span style="color: #666666">+4</span>, the_laser.y, color);
    }
}


<span style="color: #408080; font-style: italic">//draws cities based off of their heath values. We draw lower health buildings first so we don&#39;t have to erase uneccessarily</span>
<span style="color: #008000; font-weight: bold">static</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">drawCity</span>(City the_city, <span style="color: #B00040">char</span> color){
    <span style="color: #008000; font-weight: bold">if</span>(the_city.num <span style="color: #666666">==</span> NORTH){
        <span style="color: #008000; font-weight: bold">if</span>(the_city.health <span style="color: #666666">&gt;=</span> <span style="color: #666666">1</span>){
            fillRect(the_planet.x <span style="color: #666666">-</span> <span style="color: #666666">9</span>, the_planet.y <span style="color: #666666">-</span> the_planet.radius <span style="color: #666666">-1</span>, <span style="color: #666666">5</span>, <span style="color: #666666">5</span>, color);
            drawPixel(the_planet.x <span style="color: #666666">-</span> <span style="color: #666666">8</span>, the_planet.y <span style="color: #666666">-</span> the_planet.radius , BLACK);
            drawPixel(the_planet.x <span style="color: #666666">-</span> <span style="color: #666666">6</span>, the_planet.y <span style="color: #666666">-</span> the_planet.radius , BLACK);
            drawPixel(the_planet.x <span style="color: #666666">-</span> <span style="color: #666666">8</span>, the_planet.y <span style="color: #666666">-</span> the_planet.radius <span style="color: #666666">+2</span>, BLACK);
            drawPixel(the_planet.x <span style="color: #666666">-</span> <span style="color: #666666">6</span>, the_planet.y <span style="color: #666666">-</span> the_planet.radius <span style="color: #666666">+2</span>, BLACK);
        }
        <span style="color: #008000; font-weight: bold">if</span>(the_city.health <span style="color: #666666">&gt;=</span> <span style="color: #666666">2</span>){
            fillRect(the_planet.x <span style="color: #666666">-</span> <span style="color: #666666">3</span>, the_planet.y <span style="color: #666666">-</span> the_planet.radius <span style="color: #666666">-5</span>, <span style="color: #666666">5</span>, <span style="color: #666666">9</span>, color);
            drawPixel(the_planet.x <span style="color: #666666">-</span> <span style="color: #666666">2</span>, the_planet.y <span style="color: #666666">-</span> the_planet.radius , BLACK);
            drawPixel(the_planet.x , the_planet.y <span style="color: #666666">-</span> the_planet.radius , BLACK);
            drawPixel(the_planet.x <span style="color: #666666">-</span> <span style="color: #666666">2</span>, the_planet.y <span style="color: #666666">-</span> the_planet.radius <span style="color: #666666">+2</span>, BLACK);
            drawPixel(the_planet.x  , the_planet.y <span style="color: #666666">-</span> the_planet.radius <span style="color: #666666">+2</span>, BLACK);
            drawPixel(the_planet.x <span style="color: #666666">-</span> <span style="color: #666666">2</span>, the_planet.y <span style="color: #666666">-</span> the_planet.radius <span style="color: #666666">-2</span>, BLACK);
            drawPixel(the_planet.x  , the_planet.y <span style="color: #666666">-</span> the_planet.radius <span style="color: #666666">-2</span>, BLACK);
            drawPixel(the_planet.x <span style="color: #666666">-</span> <span style="color: #666666">2</span>, the_planet.y <span style="color: #666666">-</span> the_planet.radius <span style="color: #666666">-4</span>, BLACK);
            drawPixel(the_planet.x  , the_planet.y <span style="color: #666666">-</span> the_planet.radius <span style="color: #666666">-4</span>, BLACK);
        }
        <span style="color: #008000; font-weight: bold">if</span>(the_city.health <span style="color: #666666">&gt;=</span> <span style="color: #666666">3</span>){
            fillRect(the_planet.x <span style="color: #666666">+</span> <span style="color: #666666">3</span>, the_planet.y <span style="color: #666666">-</span> the_planet.radius <span style="color: #666666">-3</span>, <span style="color: #666666">5</span>, <span style="color: #666666">7</span>, color);
            drawPixel(the_planet.x <span style="color: #666666">+</span> <span style="color: #666666">4</span>, the_planet.y <span style="color: #666666">-</span> the_planet.radius , BLACK);
            drawPixel(the_planet.x <span style="color: #666666">+6</span>, the_planet.y <span style="color: #666666">-</span> the_planet.radius , BLACK);
            drawPixel(the_planet.x <span style="color: #666666">+</span> <span style="color: #666666">4</span>, the_planet.y <span style="color: #666666">-</span> the_planet.radius <span style="color: #666666">+2</span>, BLACK);
            drawPixel(the_planet.x  <span style="color: #666666">+6</span>, the_planet.y <span style="color: #666666">-</span> the_planet.radius <span style="color: #666666">+2</span>, BLACK);
            drawPixel(the_planet.x <span style="color: #666666">+</span> <span style="color: #666666">4</span>, the_planet.y <span style="color: #666666">-</span> the_planet.radius <span style="color: #666666">-2</span>, BLACK);
            drawPixel(the_planet.x <span style="color: #666666">+6</span> , the_planet.y <span style="color: #666666">-</span> the_planet.radius <span style="color: #666666">-2</span>, BLACK);
        }
    }
    <span style="color: #008000; font-weight: bold">if</span>(the_city.num <span style="color: #666666">==</span> WEST){
        <span style="color: #008000; font-weight: bold">if</span>(the_city.health <span style="color: #666666">&gt;=</span> <span style="color: #666666">1</span>){
            fillRect(the_planet.x <span style="color: #666666">-</span> the_planet.radius <span style="color: #666666">-1</span>, the_planet.y <span style="color: #666666">-</span> <span style="color: #666666">9</span>, <span style="color: #666666">5</span>, <span style="color: #666666">5</span>, color);
            drawPixel(the_planet.x <span style="color: #666666">-</span> the_planet.radius , the_planet.y <span style="color: #666666">-</span> <span style="color: #666666">8</span> , BLACK);
            drawPixel(the_planet.x <span style="color: #666666">-</span> the_planet.radius , the_planet.y <span style="color: #666666">-</span> <span style="color: #666666">6</span> , BLACK);
            drawPixel(the_planet.x <span style="color: #666666">-</span> the_planet.radius <span style="color: #666666">+2</span>, the_planet.y <span style="color: #666666">-</span> <span style="color: #666666">8</span>, BLACK);
            drawPixel(the_planet.x <span style="color: #666666">-</span> the_planet.radius <span style="color: #666666">+2</span>, the_planet.y <span style="color: #666666">-</span> <span style="color: #666666">6</span>, BLACK);
        }
        <span style="color: #008000; font-weight: bold">if</span>(the_city.health <span style="color: #666666">&gt;=</span> <span style="color: #666666">2</span>){
            fillRect(the_planet.x<span style="color: #666666">-</span> the_planet.radius <span style="color: #666666">-5</span>, the_planet.y <span style="color: #666666">-</span> <span style="color: #666666">3</span>, <span style="color: #666666">9</span>, <span style="color: #666666">5</span>, color);
            drawPixel(the_planet.x <span style="color: #666666">-</span> the_planet.radius, the_planet.y <span style="color: #666666">-</span> <span style="color: #666666">2</span> , BLACK);
            drawPixel(the_planet.x  <span style="color: #666666">-</span> the_planet.radius, the_planet.y , BLACK);
            drawPixel(the_planet.x <span style="color: #666666">-</span> the_planet.radius <span style="color: #666666">+2</span>, the_planet.y <span style="color: #666666">-</span> <span style="color: #666666">2</span>, BLACK);
            drawPixel(the_planet.x <span style="color: #666666">-</span> the_planet.radius <span style="color: #666666">+2</span> , the_planet.y, BLACK);
            drawPixel(the_planet.x <span style="color: #666666">-</span> the_planet.radius <span style="color: #666666">-2</span>, the_planet.y <span style="color: #666666">-</span> <span style="color: #666666">2</span>, BLACK);
            drawPixel(the_planet.x <span style="color: #666666">-</span> the_planet.radius <span style="color: #666666">-2</span> , the_planet.y , BLACK);
            drawPixel(the_planet.x <span style="color: #666666">-</span> the_planet.radius <span style="color: #666666">-4</span>, the_planet.y <span style="color: #666666">-</span> <span style="color: #666666">2</span>, BLACK);
            drawPixel(the_planet.x <span style="color: #666666">-</span> the_planet.radius <span style="color: #666666">-4</span> , the_planet.y, BLACK);
        }
        <span style="color: #008000; font-weight: bold">if</span>(the_city.health <span style="color: #666666">&gt;=</span> <span style="color: #666666">3</span>){
            fillRect(the_planet.x <span style="color: #666666">-</span> the_planet.radius <span style="color: #666666">-3</span>, the_planet.y <span style="color: #666666">+</span> <span style="color: #666666">3</span>, <span style="color: #666666">7</span>, <span style="color: #666666">5</span>, color);
            drawPixel(the_planet.x <span style="color: #666666">-</span> the_planet.radius, the_planet.y <span style="color: #666666">+</span> <span style="color: #666666">4</span> , BLACK);
            drawPixel(the_planet.x <span style="color: #666666">-</span> the_planet.radius, the_planet.y <span style="color: #666666">+</span> <span style="color: #666666">6</span> , BLACK);
            drawPixel(the_planet.x <span style="color: #666666">-</span> the_planet.radius <span style="color: #666666">+2</span>, the_planet.y <span style="color: #666666">+</span> <span style="color: #666666">4</span>, BLACK);
            drawPixel(the_planet.x <span style="color: #666666">-</span> the_planet.radius <span style="color: #666666">+2</span>, the_planet.y <span style="color: #666666">+</span> <span style="color: #666666">6</span>, BLACK);
            drawPixel(the_planet.x <span style="color: #666666">-</span> the_planet.radius <span style="color: #666666">-2</span>, the_planet.y <span style="color: #666666">+</span> <span style="color: #666666">4</span>, BLACK);
            drawPixel(the_planet.x <span style="color: #666666">-</span> the_planet.radius <span style="color: #666666">-2</span> , the_planet.y <span style="color: #666666">+</span> <span style="color: #666666">6</span>, BLACK);
        }
    }
    <span style="color: #008000; font-weight: bold">if</span>(the_city.num <span style="color: #666666">==</span> SOUTH){
        <span style="color: #008000; font-weight: bold">if</span>(the_city.health <span style="color: #666666">&gt;=</span> <span style="color: #666666">1</span>){
            fillRect(the_planet.x <span style="color: #666666">-</span> <span style="color: #666666">9</span>, the_planet.y <span style="color: #666666">+</span> the_planet.radius <span style="color: #666666">-3</span>, <span style="color: #666666">5</span>, <span style="color: #666666">5</span>, color);
            drawPixel(the_planet.x <span style="color: #666666">-</span> <span style="color: #666666">8</span>, the_planet.y <span style="color: #666666">+</span> the_planet.radius , BLACK);
            drawPixel(the_planet.x <span style="color: #666666">-</span> <span style="color: #666666">6</span>, the_planet.y <span style="color: #666666">+</span> the_planet.radius , BLACK);
            drawPixel(the_planet.x <span style="color: #666666">-</span> <span style="color: #666666">8</span>, the_planet.y <span style="color: #666666">+</span> the_planet.radius <span style="color: #666666">-2</span>, BLACK);
            drawPixel(the_planet.x <span style="color: #666666">-</span> <span style="color: #666666">6</span>, the_planet.y <span style="color: #666666">+</span> the_planet.radius <span style="color: #666666">-2</span>, BLACK);
        }
        <span style="color: #008000; font-weight: bold">if</span>(the_city.health <span style="color: #666666">&gt;=</span> <span style="color: #666666">2</span>){
            fillRect(the_planet.x <span style="color: #666666">-</span> <span style="color: #666666">3</span>, the_planet.y <span style="color: #666666">+</span> the_planet.radius <span style="color: #666666">-3</span>, <span style="color: #666666">5</span>, <span style="color: #666666">9</span>, color);
            drawPixel(the_planet.x <span style="color: #666666">-</span> <span style="color: #666666">2</span>, the_planet.y <span style="color: #666666">+</span> the_planet.radius , BLACK);
            drawPixel(the_planet.x , the_planet.y <span style="color: #666666">+</span> the_planet.radius , BLACK);
            drawPixel(the_planet.x <span style="color: #666666">-</span> <span style="color: #666666">2</span>, the_planet.y <span style="color: #666666">+</span> the_planet.radius <span style="color: #666666">-2</span>, BLACK);
            drawPixel(the_planet.x  , the_planet.y <span style="color: #666666">+</span> the_planet.radius <span style="color: #666666">-2</span>, BLACK);
            drawPixel(the_planet.x <span style="color: #666666">-</span> <span style="color: #666666">2</span>, the_planet.y <span style="color: #666666">+</span> the_planet.radius <span style="color: #666666">+2</span>, BLACK);
            drawPixel(the_planet.x  , the_planet.y <span style="color: #666666">+</span> the_planet.radius <span style="color: #666666">+2</span>, BLACK);
            drawPixel(the_planet.x <span style="color: #666666">-</span> <span style="color: #666666">2</span>, the_planet.y <span style="color: #666666">+</span> the_planet.radius <span style="color: #666666">+4</span>, BLACK);
            drawPixel(the_planet.x  , the_planet.y <span style="color: #666666">+</span> the_planet.radius <span style="color: #666666">+4</span>, BLACK);
        }
        <span style="color: #008000; font-weight: bold">if</span>(the_city.health <span style="color: #666666">&gt;=</span> <span style="color: #666666">3</span>){
            fillRect(the_planet.x <span style="color: #666666">+</span> <span style="color: #666666">3</span>, the_planet.y <span style="color: #666666">+</span> the_planet.radius <span style="color: #666666">-3</span>, <span style="color: #666666">5</span>, <span style="color: #666666">7</span>, color);
            drawPixel(the_planet.x <span style="color: #666666">+</span> <span style="color: #666666">4</span>, the_planet.y <span style="color: #666666">+</span> the_planet.radius , BLACK);
            drawPixel(the_planet.x <span style="color: #666666">+6</span>, the_planet.y <span style="color: #666666">+</span> the_planet.radius , BLACK);
            drawPixel(the_planet.x <span style="color: #666666">+</span> <span style="color: #666666">4</span>, the_planet.y <span style="color: #666666">+</span> the_planet.radius <span style="color: #666666">-2</span>, BLACK);
            drawPixel(the_planet.x  <span style="color: #666666">+6</span>, the_planet.y <span style="color: #666666">+</span> the_planet.radius <span style="color: #666666">-2</span>, BLACK);
            drawPixel(the_planet.x <span style="color: #666666">+</span> <span style="color: #666666">4</span>, the_planet.y <span style="color: #666666">+</span> the_planet.radius <span style="color: #666666">+2</span>, BLACK);
            drawPixel(the_planet.x <span style="color: #666666">+6</span> , the_planet.y <span style="color: #666666">+</span> the_planet.radius <span style="color: #666666">+2</span>, BLACK);
        }
    }
    <span style="color: #008000; font-weight: bold">if</span>(the_city.num <span style="color: #666666">==</span> EAST){
        <span style="color: #008000; font-weight: bold">if</span>(the_city.health <span style="color: #666666">&gt;=</span> <span style="color: #666666">1</span>){
            fillRect(the_planet.x <span style="color: #666666">+</span> the_planet.radius <span style="color: #666666">-3</span>, the_planet.y <span style="color: #666666">-</span> <span style="color: #666666">9</span>, <span style="color: #666666">5</span>, <span style="color: #666666">5</span>, color);
            drawPixel(the_planet.x <span style="color: #666666">+</span> the_planet.radius , the_planet.y <span style="color: #666666">-</span> <span style="color: #666666">8</span> , BLACK);
            drawPixel(the_planet.x <span style="color: #666666">+</span> the_planet.radius , the_planet.y <span style="color: #666666">-</span> <span style="color: #666666">6</span> , BLACK);
            drawPixel(the_planet.x <span style="color: #666666">+</span> the_planet.radius <span style="color: #666666">-2</span>, the_planet.y <span style="color: #666666">-</span> <span style="color: #666666">8</span>, BLACK);
            drawPixel(the_planet.x <span style="color: #666666">+</span> the_planet.radius <span style="color: #666666">-2</span>, the_planet.y <span style="color: #666666">-</span> <span style="color: #666666">6</span>, BLACK);
        }
        <span style="color: #008000; font-weight: bold">if</span>(the_city.health <span style="color: #666666">&gt;=</span> <span style="color: #666666">2</span>){
            fillRect(the_planet.x <span style="color: #666666">+</span> the_planet.radius <span style="color: #666666">-3</span>, the_planet.y <span style="color: #666666">-</span> <span style="color: #666666">3</span>, <span style="color: #666666">9</span>, <span style="color: #666666">5</span>, color);
            drawPixel(the_planet.x <span style="color: #666666">+</span> the_planet.radius, the_planet.y <span style="color: #666666">-</span> <span style="color: #666666">2</span> , BLACK);
            drawPixel(the_planet.x <span style="color: #666666">+</span> the_planet.radius, the_planet.y , BLACK);
            drawPixel(the_planet.x <span style="color: #666666">+</span> the_planet.radius <span style="color: #666666">-2</span>, the_planet.y <span style="color: #666666">-</span> <span style="color: #666666">2</span>, BLACK);
            drawPixel(the_planet.x <span style="color: #666666">+</span> the_planet.radius <span style="color: #666666">-2</span> , the_planet.y, BLACK);
            drawPixel(the_planet.x <span style="color: #666666">+</span> the_planet.radius <span style="color: #666666">+2</span>, the_planet.y <span style="color: #666666">-</span> <span style="color: #666666">2</span>, BLACK);
            drawPixel(the_planet.x <span style="color: #666666">+</span> the_planet.radius <span style="color: #666666">+2</span> , the_planet.y , BLACK);
            drawPixel(the_planet.x <span style="color: #666666">+</span> the_planet.radius <span style="color: #666666">+4</span>, the_planet.y <span style="color: #666666">-</span> <span style="color: #666666">2</span>, BLACK);
            drawPixel(the_planet.x <span style="color: #666666">+</span> the_planet.radius <span style="color: #666666">+4</span> , the_planet.y, BLACK);
        }
        <span style="color: #008000; font-weight: bold">if</span>(the_city.health <span style="color: #666666">&gt;=</span> <span style="color: #666666">3</span>){
            fillRect(the_planet.x <span style="color: #666666">+</span> the_planet.radius <span style="color: #666666">-3</span>, the_planet.y <span style="color: #666666">+</span> <span style="color: #666666">3</span>, <span style="color: #666666">7</span>, <span style="color: #666666">5</span>, color);
            drawPixel(the_planet.x <span style="color: #666666">+</span> the_planet.radius, the_planet.y <span style="color: #666666">+</span> <span style="color: #666666">4</span> , BLACK);
            drawPixel(the_planet.x <span style="color: #666666">+</span> the_planet.radius, the_planet.y <span style="color: #666666">+</span> <span style="color: #666666">6</span> , BLACK);
            drawPixel(the_planet.x <span style="color: #666666">+</span> the_planet.radius <span style="color: #666666">-2</span>, the_planet.y <span style="color: #666666">+</span> <span style="color: #666666">4</span>, BLACK);
            drawPixel(the_planet.x <span style="color: #666666">+</span> the_planet.radius <span style="color: #666666">-2</span>, the_planet.y <span style="color: #666666">+</span> <span style="color: #666666">6</span>, BLACK);
            drawPixel(the_planet.x <span style="color: #666666">+</span> the_planet.radius <span style="color: #666666">+2</span>, the_planet.y <span style="color: #666666">+</span> <span style="color: #666666">4</span>, BLACK);
            drawPixel(the_planet.x <span style="color: #666666">+</span> the_planet.radius <span style="color: #666666">+2</span> , the_planet.y <span style="color: #666666">+</span> <span style="color: #666666">6</span>, BLACK);
        }
    }
}

<span style="color: #408080; font-style: italic">// Animation on core 0</span>
<span style="color: #008000; font-weight: bold">static</span> <span style="color: #0000FF">PT_THREAD</span> (protothread_anim(<span style="color: #008000; font-weight: bold">struct</span> pt <span style="color: #666666">*</span>pt))
{
    <span style="color: #408080; font-style: italic">// Mark beginning of thread</span>
    PT_BEGIN(pt);
    <span style="color: #B00040">int</span> high_score <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
    
    <span style="color: #008000; font-weight: bold">while</span>(<span style="color: #666666">1</span>){
        <span style="color: #408080; font-style: italic">//START SCREEN!</span>
        fillRect(<span style="color: #666666">0</span>,<span style="color: #666666">0</span>,WINDOW_WIDTH, WINDOW_HEIGHT, BLACK);
        setTextSize(<span style="color: #666666">8</span>);
        setCursor(<span style="color: #666666">100</span>, <span style="color: #666666">100</span>);
        setTextColor2(color, BLACK);
        snprintf(screen_text_buffer, <span style="color: #666666">64</span>, <span style="color: #BA2121">&quot;ASTEROIDS&quot;</span>);
        writeString(screen_text_buffer);

        setTextSize(<span style="color: #666666">4</span>);
        setCursor(<span style="color: #666666">110</span>, <span style="color: #666666">175</span>);
        setTextColor2(color, BLACK);
        snprintf(screen_text_buffer, <span style="color: #666666">64</span>, <span style="color: #BA2121">&quot;By Monday Group 7&quot;</span>);
        writeString(screen_text_buffer);

        setTextSize(<span style="color: #666666">4</span>);
        setCursor(<span style="color: #666666">80</span>, <span style="color: #666666">250</span>);
        setTextColor2(color, BLACK);
        snprintf(screen_text_buffer, <span style="color: #666666">64</span>, <span style="color: #BA2121">&quot;Press button to play&quot;</span>);
        writeString(screen_text_buffer);
        <span style="color: #408080; font-style: italic">//wait for user input</span>
        <span style="color: #B00040">int</span> waiting <span style="color: #666666">=</span> <span style="color: #008000">true</span>;
        <span style="color: #B00040">int</span> again_pressed_state <span style="color: #666666">=</span> NOT_PRESSED;
        <span style="color: #B00040">int</span> again_possible <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
        dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan) ;
        <span style="color: #008000; font-weight: bold">while</span>(waiting){
            <span style="color: #B00040">int</span> again_button_val <span style="color: #666666">=</span> gpio_get(<span style="color: #666666">9</span>);
            <span style="color: #408080; font-style: italic">//debouncing code</span>
            <span style="color: #008000; font-weight: bold">if</span>(again_pressed_state <span style="color: #666666">==</span> NOT_PRESSED){
                <span style="color: #008000; font-weight: bold">if</span>(again_button_val <span style="color: #666666">!=</span> <span style="color: #666666">0</span>){
                    again_pressed_state <span style="color: #666666">=</span> MAYBE_PRESSED;
                    again_possible <span style="color: #666666">=</span> <span style="color: #666666">1</span>;
                }
            }
            <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(again_pressed_state <span style="color: #666666">==</span> MAYBE_PRESSED){
                <span style="color: #408080; font-style: italic">// On Transition from state MAYBE_PRESSED to state PRESSED, change the button state</span>
                <span style="color: #008000; font-weight: bold">if</span>(again_button_val <span style="color: #666666">==</span> up_possible){
                    again_pressed_state <span style="color: #666666">=</span> PRESSED;
                    
                    waiting <span style="color: #666666">=</span> <span style="color: #008000">false</span>;
                    dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan) ;
                }
                <span style="color: #008000; font-weight: bold">else</span>{
                    again_pressed_state <span style="color: #666666">=</span> NOT_PRESSED;
                }
            }
            <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(again_pressed_state <span style="color: #666666">==</span> PRESSED){
                <span style="color: #008000; font-weight: bold">if</span>(again_button_val <span style="color: #666666">==</span> up_possible){
                    again_pressed_state <span style="color: #666666">=</span> PRESSED;
                }
                <span style="color: #008000; font-weight: bold">else</span>{
                    again_pressed_state <span style="color: #666666">=</span> MAYBE_NOT_PRESSED;
                }
            }
            <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span> (again_pressed_state <span style="color: #666666">==</span> MAYBE_NOT_PRESSED){
                <span style="color: #008000; font-weight: bold">if</span>(again_button_val <span style="color: #666666">==</span> up_possible){
                    again_pressed_state <span style="color: #666666">=</span> PRESSED;
                }
                <span style="color: #008000; font-weight: bold">else</span>{
                    again_pressed_state <span style="color: #666666">=</span> NOT_PRESSED;
                }
            }
        }
        <span style="color: #408080; font-style: italic">//erase start sceen after user input</span>
        fillRect(<span style="color: #666666">0</span>,<span style="color: #666666">0</span>,WINDOW_WIDTH, WINDOW_HEIGHT, BLACK);
        setTextSize(<span style="color: #666666">1</span>);
        <span style="color: #408080; font-style: italic">//set score to zero</span>
        asteroids_shot <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
        <span style="color: #408080; font-style: italic">// Variables for maintaining frame rate</span>
        <span style="color: #008000; font-weight: bold">static</span> <span style="color: #B00040">int</span> begin_time ;
        <span style="color: #008000; font-weight: bold">static</span> <span style="color: #B00040">int</span> spare_time ;
        

        <span style="color: #408080; font-style: italic">//initialize game relevant variables</span>
        <span style="color: #B00040">bool</span> redraw <span style="color: #666666">=</span> <span style="color: #008000">false</span>;

        the_planet.x <span style="color: #666666">=</span> WINDOW_WIDTH<span style="color: #666666">/2</span>;
        the_planet.y <span style="color: #666666">=</span> WINDOW_HEIGHT<span style="color: #666666">/2</span>;
        the_planet.radius <span style="color: #666666">=</span> <span style="color: #666666">32</span>;
        the_planet.atmosphere <span style="color: #666666">=</span> <span style="color: #666666">18</span>;
        the_planet.mass <span style="color: #666666">=</span> <span style="color: #666666">100</span>;

        the_ship.x <span style="color: #666666">=</span> WINDOW_WIDTH<span style="color: #666666">/2</span>;
        the_ship.y <span style="color: #666666">=</span> the_planet.y <span style="color: #666666">+</span> <span style="color: #666666">175</span>;
        the_ship.vx <span style="color: #666666">=</span> <span style="color: #666666">3</span>;
        the_ship.vy <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
        the_ship.radius <span style="color: #666666">=</span> <span style="color: #666666">10</span>;
        the_ship.mass <span style="color: #666666">=</span> <span style="color: #666666">1</span>;
        the_ship.lives <span style="color: #666666">=</span> <span style="color: #666666">3</span>;

        <span style="color: #008000; font-weight: bold">for</span>(<span style="color: #B00040">int</span> a <span style="color: #666666">=</span> <span style="color: #666666">0</span>; a<span style="color: #666666">&lt;</span>asteroid_num; a<span style="color: #666666">++</span>){
            the_asteroids[a].radius <span style="color: #666666">=</span> <span style="color: #666666">4</span>;
            the_asteroids[a].x <span style="color: #666666">=</span> WINDOW_WIDTH <span style="color: #666666">-</span> the_asteroids[a].radius<span style="color: #666666">*2</span> <span style="color: #666666">-</span> the_asteroids[a].radius <span style="color: #666666">*</span> (<span style="color: #B00040">float</span>)(rand()) <span style="color: #666666">/</span> (<span style="color: #B00040">float</span>)(RAND_MAX);
            the_asteroids[a].y <span style="color: #666666">=</span> <span style="color: #666666">0</span> <span style="color: #666666">+</span> the_asteroids[a].radius<span style="color: #666666">*2</span> <span style="color: #666666">+</span> the_asteroids[a].radius <span style="color: #666666">*</span> (<span style="color: #B00040">float</span>)(rand()) <span style="color: #666666">/</span> (<span style="color: #B00040">float</span>)(RAND_MAX);
            the_asteroids[a].vx <span style="color: #666666">=</span>  <span style="color: #666666">-1.5</span> <span style="color: #666666">-</span> <span style="color: #666666">.1*</span>(<span style="color: #B00040">float</span>)(rand()) <span style="color: #666666">/</span> (<span style="color: #B00040">float</span>)(RAND_MAX);;
            the_asteroids[a].vy <span style="color: #666666">=</span> <span style="color: #666666">.01*</span>(<span style="color: #B00040">float</span>)(rand()) <span style="color: #666666">/</span> (<span style="color: #B00040">float</span>)(RAND_MAX);
            the_asteroids[a].mass <span style="color: #666666">=</span> <span style="color: #666666">500</span>;
            the_asteroids[a].off_screen <span style="color: #666666">=</span> <span style="color: #008000">false</span>;
            the_asteroids[a].exploding <span style="color: #666666">=</span> <span style="color: #008000">false</span>;
            the_asteroids[a].ex_anim_count <span style="color: #666666">=</span> <span style="color: #666666">00</span>;
        }

        <span style="color: #B00040">float</span> temp_x <span style="color: #666666">=</span> the_ship.x;
        <span style="color: #B00040">float</span> temp_y <span style="color: #666666">=</span> the_ship.y;
        <span style="color: #B00040">float</span> prev_x <span style="color: #666666">=</span> the_ship.x;
        <span style="color: #B00040">float</span> prev_y <span style="color: #666666">=</span> the_ship.y;

        <span style="color: #B00040">bool</span> thrust_flag <span style="color: #666666">=</span> <span style="color: #008000">false</span>;

        <span style="color: #B00040">bool</span> up_thrust_flag <span style="color: #666666">=</span> <span style="color: #008000">false</span>;
        <span style="color: #B00040">bool</span> down_thrust_flag <span style="color: #666666">=</span> <span style="color: #008000">false</span>;
        <span style="color: #B00040">bool</span> right_thrust_flag <span style="color: #666666">=</span> <span style="color: #008000">false</span>;
        <span style="color: #B00040">bool</span> left_thrust_flag <span style="color: #666666">=</span> <span style="color: #008000">false</span>;
        <span style="color: #B00040">bool</span> up <span style="color: #666666">=</span> <span style="color: #008000">false</span>;
        <span style="color: #B00040">bool</span> down<span style="color: #666666">=</span> <span style="color: #008000">false</span>;
        <span style="color: #B00040">bool</span> right <span style="color: #666666">=</span> <span style="color: #008000">false</span>;
        <span style="color: #B00040">bool</span> left <span style="color: #666666">=</span> <span style="color: #008000">false</span>;

        the_cities[<span style="color: #666666">0</span>].health <span style="color: #666666">=</span> <span style="color: #666666">3</span>;
        the_cities[<span style="color: #666666">0</span>].num <span style="color: #666666">=</span> NORTH;

        the_cities[<span style="color: #666666">1</span>].health <span style="color: #666666">=</span> <span style="color: #666666">3</span>;
        the_cities[<span style="color: #666666">1</span>].num <span style="color: #666666">=</span> EAST;

        the_cities[<span style="color: #666666">2</span>].health <span style="color: #666666">=</span> <span style="color: #666666">3</span>;
        the_cities[<span style="color: #666666">2</span>].num <span style="color: #666666">=</span> SOUTH;

        the_cities[<span style="color: #666666">3</span>].health <span style="color: #666666">=</span> <span style="color: #666666">3</span>;
        the_cities[<span style="color: #666666">3</span>].num <span style="color: #666666">=</span> WEST;
        <span style="color: #408080; font-style: italic">//draw planet</span>
        fillCircle((<span style="color: #B00040">int</span>)the_planet.x, (<span style="color: #B00040">int</span>)the_planet.y, (<span style="color: #B00040">int</span>)the_planet.radius, DARK_GREEN);
        <span style="color: #408080; font-style: italic">//game loop, runs once per frame while ship still has lives</span>
        <span style="color: #008000; font-weight: bold">while</span>(the_ship.lives <span style="color: #666666">&gt;</span> <span style="color: #666666">0</span>) {
            <span style="color: #408080; font-style: italic">// Measure time at start of thread</span>
            begin_time <span style="color: #666666">=</span> time_us_32() ;
            <span style="color: #408080; font-style: italic">//initialize per frame relevant varibles</span>
            <span style="color: #B00040">float</span> force;
            <span style="color: #B00040">float</span> distance_sq;
            <span style="color: #B00040">float</span> distance_sq_ship;
            <span style="color: #B00040">float</span> accel;
            <span style="color: #B00040">float</span> accel_x;
            <span style="color: #B00040">float</span> accel_y;
            <span style="color: #B00040">float</span> angle;
            <span style="color: #B00040">float</span> thrust_x <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
            <span style="color: #B00040">float</span> thrust_y <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
            <span style="color: #408080; font-style: italic">//erase lasers</span>
            <span style="color: #008000; font-weight: bold">for</span>(<span style="color: #B00040">int</span> l <span style="color: #666666">=</span> <span style="color: #666666">0</span>; l <span style="color: #666666">&lt;</span> laser_num; l<span style="color: #666666">++</span>){
                drawLaser(the_lasers[l], BLACK);
            }
    
            <span style="color: #408080; font-style: italic">//erase asteroids</span>
            <span style="color: #008000; font-weight: bold">for</span>(<span style="color: #B00040">int</span> a <span style="color: #666666">=</span> <span style="color: #666666">0</span>; a<span style="color: #666666">&lt;</span>asteroid_num; a<span style="color: #666666">++</span>){
                fillCircle((<span style="color: #B00040">int</span>)the_asteroids[a].x, (<span style="color: #B00040">int</span>)the_asteroids[a].y, (<span style="color: #B00040">int</span>)the_asteroids[a].radius, BLACK);
            }
            drawShip(the_ship.x, the_ship.y, the_ship.direction, BLACK);

            <span style="color: #408080; font-style: italic">//read thrust button</span>
            thrust_button_val <span style="color: #666666">=</span> gpio_get(<span style="color: #666666">9</span>);
            <span style="color: #408080; font-style: italic">//debouncing code</span>
            <span style="color: #008000; font-weight: bold">if</span>(thrust_pressed_state <span style="color: #666666">==</span> NOT_PRESSED){
                <span style="color: #008000; font-weight: bold">if</span>(thrust_button_val <span style="color: #666666">!=</span> <span style="color: #666666">0</span>){
                    thrust_pressed_state <span style="color: #666666">=</span> MAYBE_PRESSED;
                    thrust_possible <span style="color: #666666">=</span> <span style="color: #666666">1</span>;
                }
            }
            <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(thrust_pressed_state <span style="color: #666666">==</span> MAYBE_PRESSED){
                <span style="color: #408080; font-style: italic">// On Transition from state MAYBE_PRESSED to state PRESSED, change the button state</span>
                <span style="color: #008000; font-weight: bold">if</span>(thrust_button_val <span style="color: #666666">==</span> up_possible){
                    thrust_pressed_state <span style="color: #666666">=</span> PRESSED;
                    
                    thrust_flag <span style="color: #666666">=</span> <span style="color: #008000">true</span>;
                }
                <span style="color: #008000; font-weight: bold">else</span>{
                    thrust_pressed_state <span style="color: #666666">=</span> NOT_PRESSED;
                }
            }
            <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(thrust_pressed_state <span style="color: #666666">==</span> PRESSED){
                <span style="color: #008000; font-weight: bold">if</span>(thrust_button_val <span style="color: #666666">==</span> up_possible){
                    thrust_pressed_state <span style="color: #666666">=</span> PRESSED;
                }
                <span style="color: #008000; font-weight: bold">else</span>{
                    thrust_pressed_state <span style="color: #666666">=</span> MAYBE_NOT_PRESSED;
                }
            }
            <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span> (thrust_pressed_state <span style="color: #666666">==</span> MAYBE_NOT_PRESSED){
                <span style="color: #008000; font-weight: bold">if</span>(thrust_button_val <span style="color: #666666">==</span> up_possible){
                    thrust_pressed_state <span style="color: #666666">=</span> PRESSED;
                }
                <span style="color: #008000; font-weight: bold">else</span>{
                    thrust_pressed_state <span style="color: #666666">=</span> NOT_PRESSED;
                    
                    thrust_flag <span style="color: #666666">=</span> <span style="color: #008000">false</span>;
                }
            }
            <span style="color: #408080; font-style: italic">//read joystick inputs</span>
            up_button_val <span style="color: #666666">=</span> gpio_get(<span style="color: #666666">15</span>);
            down_button_val <span style="color: #666666">=</span> gpio_get(<span style="color: #666666">14</span>);
            right_button_val <span style="color: #666666">=</span> gpio_get(<span style="color: #666666">13</span>);
            left_button_val <span style="color: #666666">=</span> gpio_get(<span style="color: #666666">12</span>);
            <span style="color: #408080; font-style: italic">//debouncing code</span>
            <span style="color: #008000; font-weight: bold">if</span>(up_pressed_state <span style="color: #666666">==</span> NOT_PRESSED){
                <span style="color: #008000; font-weight: bold">if</span>(up_button_val <span style="color: #666666">!=</span> <span style="color: #666666">0</span>){
                    up_pressed_state <span style="color: #666666">=</span> MAYBE_PRESSED;
                    up_possible <span style="color: #666666">=</span> <span style="color: #666666">1</span>;
                }
            }
            <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(up_pressed_state <span style="color: #666666">==</span> MAYBE_PRESSED){
                <span style="color: #408080; font-style: italic">// On Transition from state MAYBE_PRESSED to state PRESSED, change the button state</span>
                <span style="color: #008000; font-weight: bold">if</span>(up_button_val <span style="color: #666666">==</span> up_possible){
                    up_pressed_state <span style="color: #666666">=</span> PRESSED;
                    up_thrust_flag <span style="color: #666666">=</span> <span style="color: #008000">true</span> <span style="color: #666666">&amp;&amp;</span> thrust_flag;
                    up <span style="color: #666666">=</span> <span style="color: #008000">true</span>;
                }
                <span style="color: #008000; font-weight: bold">else</span>{
                    up_pressed_state <span style="color: #666666">=</span> NOT_PRESSED;
                }
            }
            <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(up_pressed_state <span style="color: #666666">==</span> PRESSED){
                <span style="color: #008000; font-weight: bold">if</span>(up_button_val <span style="color: #666666">==</span> up_possible){
                    up_pressed_state <span style="color: #666666">=</span> PRESSED;
                }
                <span style="color: #008000; font-weight: bold">else</span>{
                    up_pressed_state <span style="color: #666666">=</span> MAYBE_NOT_PRESSED;
                }
            }
            <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span> (up_pressed_state <span style="color: #666666">==</span> MAYBE_NOT_PRESSED){
                <span style="color: #008000; font-weight: bold">if</span>(up_button_val <span style="color: #666666">==</span> up_possible){
                    up_pressed_state <span style="color: #666666">=</span> PRESSED;
                }
                <span style="color: #008000; font-weight: bold">else</span>{
                    up_pressed_state <span style="color: #666666">=</span> NOT_PRESSED;
                    up_thrust_flag <span style="color: #666666">=</span> <span style="color: #008000">false</span>;
                    up <span style="color: #666666">=</span> <span style="color: #008000">false</span>;
                }
            }
            <span style="color: #408080; font-style: italic">// DOWN</span>
            <span style="color: #008000; font-weight: bold">if</span>(down_pressed_state <span style="color: #666666">==</span> NOT_PRESSED){
                <span style="color: #008000; font-weight: bold">if</span>(down_button_val <span style="color: #666666">!=</span> <span style="color: #666666">0</span>){
                    down_pressed_state <span style="color: #666666">=</span> MAYBE_PRESSED;
                    down_possible <span style="color: #666666">=</span> <span style="color: #666666">1</span>;
                }
            }
            <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(down_pressed_state <span style="color: #666666">==</span> MAYBE_PRESSED){
                <span style="color: #408080; font-style: italic">// On Transition from state MAYBE_PRESSED to state PRESSED, change the button state</span>
                <span style="color: #008000; font-weight: bold">if</span>(down_button_val <span style="color: #666666">==</span> down_possible){
                    down_pressed_state <span style="color: #666666">=</span> PRESSED;
                    down_thrust_flag <span style="color: #666666">=</span> <span style="color: #008000">true</span> <span style="color: #666666">&amp;&amp;</span> thrust_flag;
                    down <span style="color: #666666">=</span> <span style="color: #008000">true</span>;
                }
                <span style="color: #008000; font-weight: bold">else</span>{
                    down_pressed_state <span style="color: #666666">=</span> NOT_PRESSED;
                }
            }
            <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(down_pressed_state <span style="color: #666666">==</span> PRESSED){
                <span style="color: #008000; font-weight: bold">if</span>(down_button_val <span style="color: #666666">==</span> down_possible){
                    down_pressed_state <span style="color: #666666">=</span> PRESSED;
                }
                <span style="color: #008000; font-weight: bold">else</span>{
                    down_pressed_state <span style="color: #666666">=</span> MAYBE_NOT_PRESSED;
                }
            }
            <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span> (down_pressed_state <span style="color: #666666">==</span> MAYBE_NOT_PRESSED){
                <span style="color: #008000; font-weight: bold">if</span>(down_button_val <span style="color: #666666">==</span> down_possible){
                    down_pressed_state <span style="color: #666666">=</span> PRESSED;
                }
                <span style="color: #008000; font-weight: bold">else</span>{
                    down_pressed_state <span style="color: #666666">=</span> NOT_PRESSED;
                    down_thrust_flag <span style="color: #666666">=</span> <span style="color: #008000">false</span>;
                    down <span style="color: #666666">=</span> <span style="color: #008000">false</span>;
                }
            }
            <span style="color: #408080; font-style: italic">// RIGHT</span>
            <span style="color: #008000; font-weight: bold">if</span>(right_pressed_state <span style="color: #666666">==</span> NOT_PRESSED){
                <span style="color: #008000; font-weight: bold">if</span>(right_button_val <span style="color: #666666">!=</span> <span style="color: #666666">0</span>){
                    right_pressed_state <span style="color: #666666">=</span> MAYBE_PRESSED;
                    right_possible <span style="color: #666666">=</span> <span style="color: #666666">1</span>;
                }
            }
            <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(right_pressed_state <span style="color: #666666">==</span> MAYBE_PRESSED){
                <span style="color: #408080; font-style: italic">// On Transition from state MAYBE_PRESSED to state PRESSED, change the button state</span>
                <span style="color: #008000; font-weight: bold">if</span>(right_button_val <span style="color: #666666">==</span> right_possible){
                    right_pressed_state <span style="color: #666666">=</span> PRESSED;
                    right_thrust_flag <span style="color: #666666">=</span> <span style="color: #008000">true</span> <span style="color: #666666">&amp;&amp;</span> thrust_flag;
                    right <span style="color: #666666">=</span> <span style="color: #008000">true</span>;
                }
                <span style="color: #008000; font-weight: bold">else</span>{
                    right_pressed_state <span style="color: #666666">=</span> NOT_PRESSED;
                }
            }
            <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(right_pressed_state <span style="color: #666666">==</span> PRESSED){
                <span style="color: #008000; font-weight: bold">if</span>(right_button_val <span style="color: #666666">==</span> right_possible){
                    right_pressed_state <span style="color: #666666">=</span> PRESSED;
                }
                <span style="color: #008000; font-weight: bold">else</span>{
                    right_pressed_state <span style="color: #666666">=</span> MAYBE_NOT_PRESSED;
                }
            }
            <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span> (right_pressed_state <span style="color: #666666">==</span> MAYBE_NOT_PRESSED){
                <span style="color: #008000; font-weight: bold">if</span>(right_button_val <span style="color: #666666">==</span> right_possible){
                    right_pressed_state <span style="color: #666666">=</span> PRESSED;
                }
                <span style="color: #008000; font-weight: bold">else</span>{
                    right_pressed_state <span style="color: #666666">=</span> NOT_PRESSED;
                    right_thrust_flag <span style="color: #666666">=</span> <span style="color: #008000">false</span>;
                    right <span style="color: #666666">=</span> <span style="color: #008000">false</span>;
                }
            }
            <span style="color: #408080; font-style: italic">// LEFT</span>
            <span style="color: #008000; font-weight: bold">if</span>(left_pressed_state <span style="color: #666666">==</span> NOT_PRESSED){
                <span style="color: #008000; font-weight: bold">if</span>(left_button_val <span style="color: #666666">!=</span> <span style="color: #666666">0</span>){
                    left_pressed_state <span style="color: #666666">=</span> MAYBE_PRESSED;
                    left_possible <span style="color: #666666">=</span> <span style="color: #666666">1</span>;
                }
            }
            <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(left_pressed_state <span style="color: #666666">==</span> MAYBE_PRESSED){
                <span style="color: #408080; font-style: italic">// On Transition from state MAYBE_PRESSED to state PRESSED, change the button state</span>
                <span style="color: #008000; font-weight: bold">if</span>(left_button_val <span style="color: #666666">==</span> left_possible){
                    left_pressed_state <span style="color: #666666">=</span> PRESSED;
                    left_thrust_flag <span style="color: #666666">=</span> <span style="color: #008000">true</span> <span style="color: #666666">&amp;&amp;</span> thrust_flag;
                    left <span style="color: #666666">=</span> <span style="color: #008000">true</span>;
                }
                <span style="color: #008000; font-weight: bold">else</span>{
                    left_pressed_state <span style="color: #666666">=</span> NOT_PRESSED;
                }
            }
            <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(left_pressed_state <span style="color: #666666">==</span> PRESSED){
                <span style="color: #008000; font-weight: bold">if</span>(left_button_val <span style="color: #666666">==</span> left_possible){
                    left_pressed_state <span style="color: #666666">=</span> PRESSED;
                }
                <span style="color: #008000; font-weight: bold">else</span>{
                    left_pressed_state <span style="color: #666666">=</span> MAYBE_NOT_PRESSED;
                }
            }
            <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span> (left_pressed_state <span style="color: #666666">==</span> MAYBE_NOT_PRESSED){
                <span style="color: #008000; font-weight: bold">if</span>(left_button_val <span style="color: #666666">==</span> left_possible){
                    left_pressed_state <span style="color: #666666">=</span> PRESSED;
                }
                <span style="color: #008000; font-weight: bold">else</span>{
                    left_pressed_state <span style="color: #666666">=</span> NOT_PRESSED;
                    left_thrust_flag <span style="color: #666666">=</span> <span style="color: #008000">false</span>;
                    left <span style="color: #666666">=</span> <span style="color: #008000">false</span>;
                }
            }

            <span style="color: #008000; font-weight: bold">if</span>(up <span style="color: #666666">&amp;&amp;</span> right){
                the_ship.direction <span style="color: #666666">=</span> UPRIGHT;
            } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(up <span style="color: #666666">&amp;&amp;</span> left){
                the_ship.direction <span style="color: #666666">=</span> UPLEFT;
            } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(down <span style="color: #666666">&amp;&amp;</span> right){
                the_ship.direction <span style="color: #666666">=</span> DOWNRIGHT;
            } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(down <span style="color: #666666">&amp;&amp;</span> left){
                the_ship.direction <span style="color: #666666">=</span> DOWNLEFT;
            } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(down){
                the_ship.direction <span style="color: #666666">=</span> DOWN;
            } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(up){
                the_ship.direction <span style="color: #666666">=</span> UP;
            } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(right){
                the_ship.direction <span style="color: #666666">=</span> RIGHT;
            } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(left){
                the_ship.direction <span style="color: #666666">=</span> LEFT;
            }

            <span style="color: #408080; font-style: italic">//get angle and distance from ship to planet</span>
            angle <span style="color: #666666">=</span> atan2(the_ship.y<span style="color: #666666">-</span>the_planet.y, the_ship.x <span style="color: #666666">-</span> the_planet.x);
            distance_sq <span style="color: #666666">=</span> abs(the_planet.x<span style="color: #666666">-</span>the_ship.x)<span style="color: #666666">*</span>abs(the_planet.x<span style="color: #666666">-</span>the_ship.x) <span style="color: #666666">+</span> abs(the_planet.y<span style="color: #666666">-</span>the_ship.y)<span style="color: #666666">*</span>abs(the_planet.y<span style="color: #666666">-</span>the_ship.y);
            <span style="color: #408080; font-style: italic">//check for collisions</span>
            <span style="color: #008000; font-weight: bold">if</span>(distance_sq <span style="color: #666666">&lt;</span> the_planet.radius<span style="color: #666666">*</span>the_planet.radius){
                <span style="color: #408080; font-style: italic">//if collide, erase ship and reset ship and asteroid positions</span>
                drawShip(the_ship.x, the_ship.y, the_ship.direction, BLACK);
                <span style="color: #B00040">int</span> temp_x <span style="color: #666666">=</span> (<span style="color: #B00040">float</span>)the_ship.x;
                <span style="color: #B00040">int</span> temp_y <span style="color: #666666">=</span> (<span style="color: #B00040">float</span>)the_ship.y;
                the_ship.x <span style="color: #666666">=</span> WINDOW_WIDTH<span style="color: #666666">/2</span>;
                the_ship.y <span style="color: #666666">=</span> the_planet.y <span style="color: #666666">+</span> <span style="color: #666666">175</span>;
                the_ship.vx <span style="color: #666666">=</span> <span style="color: #666666">3</span>;
                the_ship.vy <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
                the_ship.lives <span style="color: #666666">-=</span> <span style="color: #666666">1</span>;
                <span style="color: #008000; font-weight: bold">for</span>(<span style="color: #B00040">int</span> a <span style="color: #666666">=</span> <span style="color: #666666">0</span>; a<span style="color: #666666">&lt;</span>asteroid_num; a<span style="color: #666666">++</span>){
                    the_asteroids[a].off_screen <span style="color: #666666">=</span> <span style="color: #008000">true</span>;    
                }
                <span style="color: #408080; font-style: italic">//play explosion animation witg sounds</span>
                fillCircle(temp_x, temp_y, <span style="color: #666666">16</span>, YELLOW);
                dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan_1) ;
                sleep_ms(<span style="color: #666666">100</span>);
                fillCircle(temp_x, temp_y, <span style="color: #666666">16</span>, RED);
                dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan_1) ;
                sleep_ms(<span style="color: #666666">100</span>);
                fillCircle(temp_x, temp_y, <span style="color: #666666">16</span>, YELLOW);
                dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan_1) ;
                sleep_ms(<span style="color: #666666">100</span>);
                fillCircle(temp_x, temp_y, <span style="color: #666666">8</span>, RED);
                dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan_1) ;
                sleep_ms(<span style="color: #666666">100</span>);
                fillCircle(temp_x, temp_y, <span style="color: #666666">8</span>, YELLOW);
                dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan_1) ;
                sleep_ms(<span style="color: #666666">100</span>);
                fillCircle(temp_x, temp_y, <span style="color: #666666">8</span>, RED);
                dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan_1) ;
                sleep_ms(<span style="color: #666666">100</span>);
                fillCircle(temp_x, temp_y, <span style="color: #666666">16</span>, YELLOW);
                dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan_1) ;
                sleep_ms(<span style="color: #666666">100</span>);
                fillCircle(temp_x, temp_y, <span style="color: #666666">16</span>, RED);
                dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan_1) ;
                sleep_ms(<span style="color: #666666">100</span>);
                fillCircle(temp_x, temp_y, <span style="color: #666666">16</span>, YELLOW);
                dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan_1) ;
                sleep_ms(<span style="color: #666666">100</span>);
                fillCircle(temp_x, temp_y, <span style="color: #666666">8</span>, RED);
                dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan_1) ;
                sleep_ms(<span style="color: #666666">100</span>);
                fillCircle(temp_x, temp_y, <span style="color: #666666">16</span>, BLACK);
                redraw <span style="color: #666666">=</span> <span style="color: #008000">true</span>;
                fillCircle((<span style="color: #B00040">int</span>)the_planet.x, (<span style="color: #B00040">int</span>)the_planet.y, (<span style="color: #B00040">int</span>)the_planet.radius, DARK_GREEN);
                corner_counter <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
                
            } <span style="color: #008000; font-weight: bold">else</span>{
                <span style="color: #408080; font-style: italic">//if no collisions, update accel to reflect ship&#39;s acceleration due to gravity</span>
                force <span style="color: #666666">=</span> <span style="color: #666666">-1*</span>GRAV_CONST<span style="color: #666666">*</span>(the_planet.mass<span style="color: #666666">*</span>the_ship.mass)<span style="color: #666666">/</span>distance_sq;
                accel <span style="color: #666666">=</span> force<span style="color: #666666">/</span>the_ship.mass;
            }
            <span style="color: #408080; font-style: italic">//check if under thrust</span>
            <span style="color: #008000; font-weight: bold">if</span>(thrust_flag){
                <span style="color: #408080; font-style: italic">//if under thrust, play thrust noise, increment rocket exhaust animation, </span>
                <span style="color: #408080; font-style: italic">//and create x an y components of thrust based off of ship direction</span>
                dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan_1) ;
                <span style="color: #408080; font-style: italic">// color = RED;</span>
                <span style="color: #008000; font-weight: bold">if</span>(thruster_val <span style="color: #666666">&lt;</span> <span style="color: #666666">4</span>){
                    thruster_val<span style="color: #666666">++</span>;
                } <span style="color: #008000; font-weight: bold">else</span>{
                    thruster_val <span style="color: #666666">=</span> <span style="color: #666666">1</span>;
                }
                <span style="color: #008000; font-weight: bold">if</span>(the_ship.direction <span style="color: #666666">==</span> UPLEFT){
                    thrust_y <span style="color: #666666">=</span> <span style="color: #666666">-1*</span>THRUST;
                    thrust_x <span style="color: #666666">=</span> <span style="color: #666666">-1*</span>THRUST;
                
                } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_ship.direction <span style="color: #666666">==</span> UPRIGHT){
                    thrust_y <span style="color: #666666">=</span> <span style="color: #666666">-1*</span>THRUST;
                    thrust_x <span style="color: #666666">=</span> THRUST;
                
                } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_ship.direction <span style="color: #666666">==</span> DOWNRIGHT){
                    thrust_y <span style="color: #666666">=</span> THRUST;
                    thrust_x <span style="color: #666666">=</span> THRUST;
                
                } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_ship.direction <span style="color: #666666">==</span> DOWNLEFT){
                    thrust_y <span style="color: #666666">=</span> THRUST;
                    thrust_x <span style="color: #666666">=</span> <span style="color: #666666">-1*</span>THRUST;
                
                } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_ship.direction <span style="color: #666666">==</span> DOWN){
                    thrust_y <span style="color: #666666">=</span> THRUST;
                    
                } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_ship.direction <span style="color: #666666">==</span> UP){
                    thrust_y <span style="color: #666666">=</span> <span style="color: #666666">-1*</span>THRUST;
                    
                } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_ship.direction <span style="color: #666666">==</span> RIGHT){
                    thrust_x <span style="color: #666666">=</span> THRUST;
                    
                } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_ship.direction <span style="color: #666666">==</span> LEFT){
                    thrust_x <span style="color: #666666">=</span> <span style="color: #666666">-1*</span>THRUST;
                    
                }
            } <span style="color: #008000; font-weight: bold">else</span>{
                <span style="color: #408080; font-style: italic">//if not under thrust, reset exhaust animation</span>
                thruster_val <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
            }

            <span style="color: #408080; font-style: italic">//update ship acceleration vector based off of thrust and gravity</span>
            accel_x <span style="color: #666666">=</span> accel<span style="color: #666666">*</span>cos(angle)<span style="color: #666666">+</span>thrust_x;
            accel_y <span style="color: #666666">=</span> accel<span style="color: #666666">*</span>sin(angle)<span style="color: #666666">+</span>thrust_y;
            <span style="color: #408080; font-style: italic">// wrap around if we&#39;ve hit a wall</span>
            <span style="color: #008000; font-weight: bold">if</span> (the_ship.y <span style="color: #666666">&lt;</span> <span style="color: #666666">0</span>) {
                <span style="color: #408080; font-style: italic">// the_ship.vy = (-the_ship.vy)*BOUNCE ;</span>
                the_ship.y  <span style="color: #666666">=</span> (WINDOW_HEIGHT <span style="color: #666666">-</span> <span style="color: #666666">1</span>) ;
            }
            <span style="color: #008000; font-weight: bold">if</span> (the_ship.y <span style="color: #666666">&gt;</span> WINDOW_HEIGHT) {
                <span style="color: #408080; font-style: italic">// the_ship.vy = (-the_ship.vy)*BOUNCE ;</span>
                the_ship.y  <span style="color: #666666">=</span> (<span style="color: #666666">1</span>) ;
            }
            <span style="color: #008000; font-weight: bold">if</span> (the_ship.x <span style="color: #666666">&gt;</span> WINDOW_WIDTH) {
                <span style="color: #408080; font-style: italic">// the_ship.vx = (-the_ship.vx)*BOUNCE ;</span>
                the_ship.x  <span style="color: #666666">=</span> (<span style="color: #666666">1</span>) ;
            }
            <span style="color: #008000; font-weight: bold">if</span> (the_ship.x <span style="color: #666666">&lt;</span> <span style="color: #666666">0</span>) {
                <span style="color: #408080; font-style: italic">// the_ship.vx = (-the_ship.vx)*BOUNCE ;</span>
                the_ship.x  <span style="color: #666666">=</span> (WINDOW_WIDTH <span style="color: #666666">-1</span>) ;
            } 
            <span style="color: #408080; font-style: italic">//if 4th frame, shoot a new laser</span>
            <span style="color: #008000; font-weight: bold">if</span>(laser_counter <span style="color: #666666">&gt;</span> <span style="color: #666666">3</span>){
                dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan) ;
                the_lasers[laser_inc].x <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
                the_lasers[laser_inc].y <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
                the_lasers[laser_inc].direction <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
                the_lasers[laser_inc].x <span style="color: #666666">+=</span> the_ship.x;
                the_lasers[laser_inc].y <span style="color: #666666">+=</span> the_ship.y;
                the_lasers[laser_inc].direction <span style="color: #666666">+=</span> the_ship.direction;
                <span style="color: #008000; font-weight: bold">if</span>(the_lasers[laser_inc].direction <span style="color: #666666">==</span> UPRIGHT){
                    the_lasers[laser_inc].vy <span style="color: #666666">=</span> <span style="color: #666666">-7</span> <span style="color: #666666">+</span> the_ship.vy;
                    the_lasers[laser_inc].vx <span style="color: #666666">=</span> <span style="color: #666666">7</span> <span style="color: #666666">+</span> the_ship.vx;
                } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_lasers[laser_inc].direction <span style="color: #666666">==</span> UPLEFT){
                    the_lasers[laser_inc].vy <span style="color: #666666">=</span> <span style="color: #666666">-7</span> <span style="color: #666666">+</span> the_ship.vy;
                    the_lasers[laser_inc].vx <span style="color: #666666">=</span> <span style="color: #666666">-7</span> <span style="color: #666666">+</span> the_ship.vx;
                } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_lasers[laser_inc].direction <span style="color: #666666">==</span> DOWNRIGHT){
                    the_lasers[laser_inc].vy <span style="color: #666666">=</span> <span style="color: #666666">7</span> <span style="color: #666666">+</span> the_ship.vy;
                    the_lasers[laser_inc].vx <span style="color: #666666">=</span> <span style="color: #666666">7</span> <span style="color: #666666">+</span> the_ship.vx;
                } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_lasers[laser_inc].direction <span style="color: #666666">==</span> DOWNLEFT){
                    the_lasers[laser_inc].vy <span style="color: #666666">=</span> <span style="color: #666666">7</span> <span style="color: #666666">+</span> the_ship.vy;
                    the_lasers[laser_inc].vx <span style="color: #666666">=</span> <span style="color: #666666">-7</span> <span style="color: #666666">+</span> the_ship.vx;
                }
                <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_lasers[laser_inc].direction <span style="color: #666666">==</span> UP){
                    the_lasers[laser_inc].vy <span style="color: #666666">=</span> <span style="color: #666666">-10</span> <span style="color: #666666">+</span> the_ship.vy;
                    the_lasers[laser_inc].vx <span style="color: #666666">=</span> <span style="color: #666666">0</span> <span style="color: #666666">+</span> the_ship.vx;
                } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_lasers[laser_inc].direction <span style="color: #666666">==</span> DOWN){
                    the_lasers[laser_inc].vy <span style="color: #666666">=</span> <span style="color: #666666">10</span> <span style="color: #666666">+</span> the_ship.vy;
                    the_lasers[laser_inc].vx <span style="color: #666666">=</span> <span style="color: #666666">0</span> <span style="color: #666666">+</span> the_ship.vx;
                } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_lasers[laser_inc].direction <span style="color: #666666">==</span> LEFT){
                    the_lasers[laser_inc].vy <span style="color: #666666">=</span> <span style="color: #666666">0</span> <span style="color: #666666">+</span> the_ship.vy;
                    the_lasers[laser_inc].vx <span style="color: #666666">=</span> <span style="color: #666666">-10</span> <span style="color: #666666">+</span> the_ship.vx;
                } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_lasers[laser_inc].direction <span style="color: #666666">==</span> RIGHT){
                    the_lasers[laser_inc].vy <span style="color: #666666">=</span> <span style="color: #666666">0</span> <span style="color: #666666">+</span> the_ship.vy;
                    the_lasers[laser_inc].vx <span style="color: #666666">=</span> <span style="color: #666666">10</span> <span style="color: #666666">+</span> the_ship.vx;
                }
                the_lasers[laser_inc].exist <span style="color: #666666">=</span> <span style="color: #008000">true</span>;
                laser_counter <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
                <span style="color: #008000; font-weight: bold">if</span>(laser_inc <span style="color: #666666">&gt;=</span> laser_num<span style="color: #666666">-1</span>){
                    laser_inc <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
                } <span style="color: #008000; font-weight: bold">else</span>{
                    laser_inc<span style="color: #666666">++</span>;
                }

            } <span style="color: #008000; font-weight: bold">else</span>{
                <span style="color: #008000; font-weight: bold">for</span>(<span style="color: #B00040">int</span> l <span style="color: #666666">=</span> <span style="color: #666666">0</span>; l<span style="color: #666666">&lt;</span>laser_num; l<span style="color: #666666">++</span>){
                    <span style="color: #408080; font-style: italic">//update laser velocity</span>
                    the_lasers[l].x <span style="color: #666666">+=</span> the_lasers[l].vx;
                    the_lasers[l].y <span style="color: #666666">+=</span> the_lasers[l].vy;
                    <span style="color: #408080; font-style: italic">//only draw lasers if they exist</span>
                    <span style="color: #008000; font-weight: bold">if</span>(the_lasers[l].exist <span style="color: #666666">==</span> <span style="color: #008000">true</span>){
                        drawLaser(the_lasers[l], RED);
                    } <span style="color: #008000; font-weight: bold">else</span>{
                        drawLaser(the_lasers[l], BLACK);
                    }
                    
                }
                laser_counter<span style="color: #666666">++</span>;
                
            }
            <span style="color: #008000; font-weight: bold">for</span>(<span style="color: #B00040">int</span> l <span style="color: #666666">=</span> <span style="color: #666666">0</span>; l<span style="color: #666666">&lt;</span>laser_num; l<span style="color: #666666">++</span>){
                <span style="color: #408080; font-style: italic">//check for laser collisions</span>
                <span style="color: #008000; font-weight: bold">if</span>(the_lasers[l].exist <span style="color: #666666">==</span> <span style="color: #008000">true</span> <span style="color: #666666">&amp;&amp;</span> (the_planet.x <span style="color: #666666">-</span> the_lasers[l].x)<span style="color: #666666">*</span>(the_planet.x <span style="color: #666666">-</span> the_lasers[l].x) <span style="color: #666666">+</span>(the_planet.y <span style="color: #666666">-</span> the_lasers[l].y)<span style="color: #666666">*</span>(the_planet.y <span style="color: #666666">-</span> the_lasers[l].y)  <span style="color: #666666">&lt;</span>  (<span style="color: #666666">2*</span>the_planet.radius<span style="color: #666666">*</span>the_planet.radius)){
                    the_lasers[l].exist <span style="color: #666666">=</span> <span style="color: #008000">false</span>;
                    drawLaser(the_lasers[l], BLACK);
                    the_lasers[l].x <span style="color: #666666">=</span> <span style="color: #666666">100000</span>;
                }
            }
            <span style="color: #408080; font-style: italic">//euler integration for ship</span>
            the_ship.vx <span style="color: #666666">=</span> the_ship.vx <span style="color: #666666">+</span> accel_x; 
            the_ship.vy <span style="color: #666666">=</span> the_ship.vy <span style="color: #666666">+</span> accel_y; 
            the_ship.x <span style="color: #666666">=</span> the_ship.x <span style="color: #666666">+</span> the_ship.vx;
            the_ship.y <span style="color: #666666">=</span> the_ship.y <span style="color: #666666">+</span> the_ship.vy;
            <span style="color: #408080; font-style: italic">//draw ship with new positon and direction</span>
            drawShip(the_ship.x, the_ship.y, the_ship.direction, color);
            
            <span style="color: #408080; font-style: italic">//draw atmosphere</span>
            drawCircle((<span style="color: #B00040">int</span>)the_planet.x, (<span style="color: #B00040">int</span>)the_planet.y, (<span style="color: #B00040">int</span>)(the_planet.radius<span style="color: #666666">+</span>the_planet.atmosphere), CYAN);
            <span style="color: #408080; font-style: italic">//loop through all asteroids</span>
            <span style="color: #008000; font-weight: bold">for</span>(<span style="color: #B00040">int</span> a <span style="color: #666666">=</span> <span style="color: #666666">0</span>; a<span style="color: #666666">&lt;</span>asteroid_num; a<span style="color: #666666">++</span>){
                <span style="color: #B00040">bool</span> laser_col <span style="color: #666666">=</span> <span style="color: #008000">false</span>;
                <span style="color: #408080; font-style: italic">//check for laser collisions</span>
                <span style="color: #008000; font-weight: bold">for</span>(<span style="color: #B00040">int</span> l <span style="color: #666666">=</span> <span style="color: #666666">0</span>; l<span style="color: #666666">&lt;</span>laser_num; l<span style="color: #666666">++</span>){
                    <span style="color: #008000; font-weight: bold">if</span>(the_lasers[l].exist <span style="color: #666666">==</span> <span style="color: #008000">true</span> <span style="color: #666666">&amp;&amp;</span> (the_asteroids[a].x <span style="color: #666666">-</span> the_lasers[l].x)<span style="color: #666666">*</span>(the_asteroids[a].x <span style="color: #666666">-</span> the_lasers[l].x) <span style="color: #666666">+</span>(the_asteroids[a].y <span style="color: #666666">-</span> the_lasers[l].y)<span style="color: #666666">*</span>(the_asteroids[a].y <span style="color: #666666">-</span> the_lasers[l].y)  <span style="color: #666666">&lt;</span>  (<span style="color: #666666">4*</span>the_asteroids[a].radius<span style="color: #666666">*</span>the_asteroids[a].radius)){
                        laser_col <span style="color: #666666">=</span> <span style="color: #008000">true</span>;
                        the_lasers[l].exist <span style="color: #666666">=</span> <span style="color: #008000">false</span>;
                        drawLaser(the_lasers[l], BLACK);
                    }
                }
                <span style="color: #408080; font-style: italic">//update score if lasers hits asteroid</span>
                <span style="color: #008000; font-weight: bold">if</span>(laser_col){
                    asteroids_shot<span style="color: #666666">++</span>;
                }
                <span style="color: #408080; font-style: italic">//calculate squared distance from planet to asteroid (for later)</span>
                distance_sq <span style="color: #666666">=</span> abs(the_planet.x<span style="color: #666666">-</span>the_asteroids[a].x)<span style="color: #666666">*</span>abs(the_planet.x<span style="color: #666666">-</span>the_asteroids[a].x) <span style="color: #666666">+</span> abs(the_planet.y<span style="color: #666666">-</span>the_asteroids[a].y)<span style="color: #666666">*</span>abs(the_planet.y<span style="color: #666666">-</span>the_asteroids[a].y);
                <span style="color: #008000; font-weight: bold">if</span>(laser_col){
                    <span style="color: #408080; font-style: italic">//of laser collide, destroy asteroid (play explosion anim)</span>
                    <span style="color: #008000; font-weight: bold">if</span>(the_asteroids[a].off_screen <span style="color: #666666">==</span> <span style="color: #008000">false</span>){
                        dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan_1) ;
                        queue<span style="color: #666666">++</span>;
                        the_asteroids[a].off_screen <span style="color: #666666">=</span> <span style="color: #008000">true</span>;
                        the_asteroids[a].exploding <span style="color: #666666">=</span> <span style="color: #008000">true</span>;
                        the_asteroids[a].vx <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
                        the_asteroids[a].vy <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
                    }
                    
                }  
                <span style="color: #408080; font-style: italic">//check if asteroid collides with planet</span>
                <span style="color: #008000; font-weight: bold">if</span>(distance_sq <span style="color: #666666">&lt;</span> the_planet.radius<span style="color: #666666">*</span>the_planet.radius <span style="color: #666666">+</span> the_asteroids[a].radius<span style="color: #666666">*</span>the_asteroids[a].radius){
                    <span style="color: #008000; font-weight: bold">if</span>(the_asteroids[a].off_screen <span style="color: #666666">==</span> <span style="color: #008000">false</span>){
                        <span style="color: #408080; font-style: italic">//if asteroid collide with planet, destroy asteroid and play explosion animation</span>
                        dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan_1) ;
                        queue<span style="color: #666666">++</span>;
                        the_asteroids[a].off_screen <span style="color: #666666">=</span> <span style="color: #008000">true</span>;
                        the_asteroids[a].exploding <span style="color: #666666">=</span> <span style="color: #008000">true</span>;
                        the_asteroids[a].vx <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
                        the_asteroids[a].vy <span style="color: #666666">=</span> <span style="color: #666666">0</span>;

                        <span style="color: #408080; font-style: italic">//update city health based off asteroid collision location</span>
                        <span style="color: #008000; font-weight: bold">if</span>(the_asteroids[a].x <span style="color: #666666">&lt;</span> the_planet.x <span style="color: #666666">-</span> the_planet.radius<span style="color: #666666">*0.707</span>){
                            <span style="color: #008000; font-weight: bold">if</span>(the_cities[WEST].health <span style="color: #666666">&gt;</span> <span style="color: #666666">0</span>){
                                drawCity(the_cities[WEST], BLACK);
                                the_cities[WEST].health <span style="color: #666666">-=</span> <span style="color: #666666">1</span>;
                            }
                        } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_asteroids[a].x <span style="color: #666666">&gt;</span> the_planet.x <span style="color: #666666">+</span> the_planet.radius<span style="color: #666666">*0.707</span>){
                            <span style="color: #008000; font-weight: bold">if</span>(the_cities[EAST].health <span style="color: #666666">&gt;</span> <span style="color: #666666">0</span>){
                                drawCity(the_cities[EAST], BLACK);
                                the_cities[EAST].health <span style="color: #666666">-=</span> <span style="color: #666666">1</span>;
                            }
                        } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_asteroids[a].y <span style="color: #666666">&gt;</span> the_planet.y){
                            <span style="color: #008000; font-weight: bold">if</span>(the_cities[SOUTH].health <span style="color: #666666">&gt;</span> <span style="color: #666666">0</span>){
                                drawCity(the_cities[SOUTH], BLACK);
                                the_cities[SOUTH].health <span style="color: #666666">-=</span> <span style="color: #666666">1</span>;
                            }
                        } <span style="color: #008000; font-weight: bold">else</span>{
                            <span style="color: #008000; font-weight: bold">if</span>(the_cities[NORTH].health <span style="color: #666666">&gt;</span> <span style="color: #666666">0</span>){
                                drawCity(the_cities[NORTH], BLACK);
                                the_cities[NORTH].health <span style="color: #666666">-=</span> <span style="color: #666666">1</span>;
                            }
                        }
                    }
                } 
                <span style="color: #408080; font-style: italic">//if laser&#39;s in atmosphere, apply drag (randomized to spread out asteroids)</span>
                <span style="color: #008000; font-weight: bold">if</span>(distance_sq <span style="color: #666666">&lt;</span> (the_planet.radius<span style="color: #666666">+</span>the_planet.atmosphere)<span style="color: #666666">*</span>(the_planet.radius<span style="color: #666666">+</span>the_planet.atmosphere) <span style="color: #666666">+</span> the_asteroids[a].radius<span style="color: #666666">*</span>the_asteroids[a].radius){
                    the_asteroids[a].vx <span style="color: #666666">*=</span> <span style="color: #666666">0.994</span> <span style="color: #666666">+</span> <span style="color: #666666">.001*</span>(<span style="color: #B00040">float</span>)(rand()) <span style="color: #666666">/</span> (<span style="color: #B00040">float</span>)(RAND_MAX);
                    the_asteroids[a].vy <span style="color: #666666">*=</span> <span style="color: #666666">0.994</span> <span style="color: #666666">+</span> <span style="color: #666666">.001*</span>(<span style="color: #B00040">float</span>)(rand()) <span style="color: #666666">/</span> (<span style="color: #B00040">float</span>)(RAND_MAX);
                    fillCircle((<span style="color: #B00040">int</span>)the_planet.x, (<span style="color: #B00040">int</span>)the_planet.y, (<span style="color: #B00040">int</span>)the_planet.radius, DARK_GREEN);
                }
                <span style="color: #408080; font-style: italic">//check for ship collisions</span>
                distance_sq_ship <span style="color: #666666">=</span> abs(the_asteroids[a].x<span style="color: #666666">-</span>the_ship.x)<span style="color: #666666">*</span>abs(the_asteroids[a].x<span style="color: #666666">-</span>the_ship.x) <span style="color: #666666">+</span> abs(the_asteroids[a].y<span style="color: #666666">-</span>the_ship.y)<span style="color: #666666">*</span>abs(the_asteroids[a].y<span style="color: #666666">-</span>the_ship.y);
                <span style="color: #008000; font-weight: bold">if</span>(distance_sq_ship <span style="color: #666666">&lt;</span> the_asteroids[a].radius<span style="color: #666666">*</span>the_asteroids[a].radius <span style="color: #666666">+</span> <span style="color: #666666">8</span> <span style="color: #666666">&amp;&amp;</span> the_asteroids[a].off_screen <span style="color: #666666">==</span> <span style="color: #008000">false</span>){
                    <span style="color: #408080; font-style: italic">//if collide, reset and play explosion animation</span>
                    drawShip(the_ship.x, the_ship.y, the_ship.direction, BLACK);
                    <span style="color: #B00040">int</span> temp_x <span style="color: #666666">=</span> (<span style="color: #B00040">float</span>)the_ship.x;
                    <span style="color: #B00040">int</span> temp_y <span style="color: #666666">=</span> (<span style="color: #B00040">float</span>)the_ship.y;
                    the_ship.x <span style="color: #666666">=</span> WINDOW_WIDTH<span style="color: #666666">/2</span>;
                    the_ship.y <span style="color: #666666">=</span> the_planet.y <span style="color: #666666">+</span> <span style="color: #666666">175</span>;
                    the_ship.vx <span style="color: #666666">=</span> <span style="color: #666666">3</span>;
                    the_ship.vy <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
                    the_ship.lives <span style="color: #666666">-=</span> <span style="color: #666666">1</span>;
                    <span style="color: #008000; font-weight: bold">for</span>(<span style="color: #B00040">int</span> a <span style="color: #666666">=</span> <span style="color: #666666">0</span>; a<span style="color: #666666">&lt;</span>asteroid_num; a<span style="color: #666666">++</span>){
                        the_asteroids[a].off_screen <span style="color: #666666">=</span> <span style="color: #008000">true</span>;    
                    }
                    fillCircle(temp_x, temp_y, <span style="color: #666666">8</span>, YELLOW);
                    dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan_1) ;
                    sleep_ms(<span style="color: #666666">100</span>);
                    fillCircle(temp_x, temp_y, <span style="color: #666666">8</span>, RED);
                    dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan_1) ;
                    sleep_ms(<span style="color: #666666">100</span>);
                    fillCircle(temp_x, temp_y, <span style="color: #666666">8</span>, YELLOW);
                    dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan_1) ;
                    sleep_ms(<span style="color: #666666">100</span>);
                    fillCircle(temp_x, temp_y, <span style="color: #666666">16</span>, RED);
                    dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan_1) ;
                    sleep_ms(<span style="color: #666666">100</span>);
                    fillCircle(temp_x, temp_y, <span style="color: #666666">16</span>, YELLOW);
                    dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan_1) ;
                    sleep_ms(<span style="color: #666666">100</span>);
                    fillCircle(temp_x, temp_y, <span style="color: #666666">16</span>, RED);
                    dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan_1) ;
                    sleep_ms(<span style="color: #666666">100</span>);
                    fillCircle(temp_x, temp_y, <span style="color: #666666">8</span>, YELLOW);
                    dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan_1) ;
                    sleep_ms(<span style="color: #666666">100</span>);
                    fillCircle(temp_x, temp_y, <span style="color: #666666">8</span>, RED);
                    dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan_1) ;
                    sleep_ms(<span style="color: #666666">100</span>);
                    fillCircle(temp_x, temp_y, <span style="color: #666666">8</span>, YELLOW);
                    dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan_1) ;
                    sleep_ms(<span style="color: #666666">100</span>);
                    fillCircle(temp_x, temp_y, <span style="color: #666666">16</span>, RED);
                    dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan_1) ;
                    sleep_ms(<span style="color: #666666">100</span>);
                    fillCircle(temp_x, temp_y, <span style="color: #666666">16</span>, BLACK);
                    redraw <span style="color: #666666">=</span> <span style="color: #008000">true</span>;
                    corner_counter <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
                    fillCircle((<span style="color: #B00040">int</span>)the_planet.x, (<span style="color: #B00040">int</span>)the_planet.y, (<span style="color: #B00040">int</span>)the_planet.radius, DARK_GREEN);
                }     
            }
            <span style="color: #408080; font-style: italic">//if all asteroids have been destroyed, redraw them in new corner</span>
            <span style="color: #008000; font-weight: bold">if</span>(queue <span style="color: #666666">&gt;=</span> A_QUEUE){
                redraw <span style="color: #666666">=</span> <span style="color: #008000">true</span>;
                queue <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
            }
            <span style="color: #408080; font-style: italic">//redraw asteroids in new corner when needed</span>
            <span style="color: #008000; font-weight: bold">if</span>(redraw <span style="color: #666666">&amp;&amp;</span> corner_counter <span style="color: #666666">==</span> <span style="color: #666666">0</span>){
                <span style="color: #008000; font-weight: bold">if</span>(corner <span style="color: #666666">==</span> TOPRIGHT){
                    <span style="color: #008000; font-weight: bold">for</span>(<span style="color: #B00040">int</span> a <span style="color: #666666">=</span> <span style="color: #666666">0</span>; a<span style="color: #666666">&lt;</span>asteroid_num; a<span style="color: #666666">++</span>){
                        <span style="color: #008000; font-weight: bold">if</span>(the_asteroids[a].off_screen <span style="color: #666666">==</span> <span style="color: #008000">true</span>){
                            fillCircle((<span style="color: #B00040">int</span>)the_asteroids[a].x, (<span style="color: #B00040">int</span>)the_asteroids[a].y, (<span style="color: #B00040">int</span>)the_asteroids[a].radius<span style="color: #666666">*2</span>, BLACK);
                            the_asteroids[a].vx <span style="color: #666666">=</span> <span style="color: #666666">-1.5</span> <span style="color: #666666">-</span> <span style="color: #666666">.1*</span>(<span style="color: #B00040">float</span>)(rand()) <span style="color: #666666">/</span> (<span style="color: #B00040">float</span>)(RAND_MAX);
                            the_asteroids[a].vy <span style="color: #666666">=</span> <span style="color: #666666">.05*</span>(<span style="color: #B00040">float</span>)(rand()) <span style="color: #666666">/</span> (<span style="color: #B00040">float</span>)(RAND_MAX);
                            the_asteroids[a].x <span style="color: #666666">=</span> WINDOW_WIDTH <span style="color: #666666">-</span> the_asteroids[a].radius<span style="color: #666666">*2</span> <span style="color: #666666">-</span> the_asteroids[a].radius <span style="color: #666666">*</span> (<span style="color: #B00040">float</span>)(rand()) <span style="color: #666666">/</span> (<span style="color: #B00040">float</span>)(RAND_MAX);
                            the_asteroids[a].y <span style="color: #666666">=</span> <span style="color: #666666">0</span> <span style="color: #666666">+</span> the_asteroids[a].radius<span style="color: #666666">*2</span> <span style="color: #666666">+</span> the_asteroids[a].radius <span style="color: #666666">*</span> (<span style="color: #B00040">float</span>)(rand()) <span style="color: #666666">/</span> (<span style="color: #B00040">float</span>)(RAND_MAX);
                            the_asteroids[a].off_screen <span style="color: #666666">=</span> <span style="color: #008000">false</span>;
                            the_asteroids[a].ex_anim_count <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
                        }     
                    }
                    corner <span style="color: #666666">=</span> TOPLEFT;
                }
                <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(corner <span style="color: #666666">==</span> TOPLEFT){
                    <span style="color: #008000; font-weight: bold">for</span>(<span style="color: #B00040">int</span> a <span style="color: #666666">=</span> <span style="color: #666666">0</span>; a<span style="color: #666666">&lt;</span>asteroid_num; a<span style="color: #666666">++</span>){
                        <span style="color: #008000; font-weight: bold">if</span>(the_asteroids[a].off_screen <span style="color: #666666">==</span> <span style="color: #008000">true</span>){
                            fillCircle((<span style="color: #B00040">int</span>)the_asteroids[a].x, (<span style="color: #B00040">int</span>)the_asteroids[a].y, (<span style="color: #B00040">int</span>)the_asteroids[a].radius<span style="color: #666666">*2</span>, BLACK);
                            the_asteroids[a].vx <span style="color: #666666">=</span> <span style="color: #666666">1.5</span> <span style="color: #666666">-</span> <span style="color: #666666">.1*</span>(<span style="color: #B00040">float</span>)(rand()) <span style="color: #666666">/</span> (<span style="color: #B00040">float</span>)(RAND_MAX);
                            the_asteroids[a].vy <span style="color: #666666">=</span> <span style="color: #666666">.05*</span>(<span style="color: #B00040">float</span>)(rand()) <span style="color: #666666">/</span> (<span style="color: #B00040">float</span>)(RAND_MAX);
                            the_asteroids[a].x <span style="color: #666666">=</span> <span style="color: #666666">0</span> <span style="color: #666666">+</span> the_asteroids[a].radius<span style="color: #666666">*2</span> <span style="color: #666666">+</span> the_asteroids[a].radius <span style="color: #666666">*</span> (<span style="color: #B00040">float</span>)(rand()) <span style="color: #666666">/</span> (<span style="color: #B00040">float</span>)(RAND_MAX);
                            the_asteroids[a].y <span style="color: #666666">=</span> <span style="color: #666666">0</span> <span style="color: #666666">+</span> the_asteroids[a].radius<span style="color: #666666">*2</span> <span style="color: #666666">+</span> the_asteroids[a].radius <span style="color: #666666">*</span> (<span style="color: #B00040">float</span>)(rand()) <span style="color: #666666">/</span> (<span style="color: #B00040">float</span>)(RAND_MAX);
                            the_asteroids[a].off_screen <span style="color: #666666">=</span> <span style="color: #008000">false</span>;
                            the_asteroids[a].ex_anim_count <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
                        }     
                    }
                    corner <span style="color: #666666">=</span> BOTTOMLEFT;
                }
                <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(corner <span style="color: #666666">==</span> BOTTOMLEFT){
                    <span style="color: #008000; font-weight: bold">for</span>(<span style="color: #B00040">int</span> a <span style="color: #666666">=</span> <span style="color: #666666">0</span>; a<span style="color: #666666">&lt;</span>asteroid_num; a<span style="color: #666666">++</span>){
                        <span style="color: #008000; font-weight: bold">if</span>(the_asteroids[a].off_screen <span style="color: #666666">==</span> <span style="color: #008000">true</span>){
                            fillCircle((<span style="color: #B00040">int</span>)the_asteroids[a].x, (<span style="color: #B00040">int</span>)the_asteroids[a].y, (<span style="color: #B00040">int</span>)the_asteroids[a].radius<span style="color: #666666">*2</span>, BLACK);
                            the_asteroids[a].vx <span style="color: #666666">=</span> <span style="color: #666666">1.5</span> <span style="color: #666666">-</span> <span style="color: #666666">.1*</span>(<span style="color: #B00040">float</span>)(rand()) <span style="color: #666666">/</span> (<span style="color: #B00040">float</span>)(RAND_MAX);
                            the_asteroids[a].vy <span style="color: #666666">=</span> <span style="color: #666666">.05*</span>(<span style="color: #B00040">float</span>)(rand()) <span style="color: #666666">/</span> (<span style="color: #B00040">float</span>)(RAND_MAX);
                            the_asteroids[a].x <span style="color: #666666">=</span> <span style="color: #666666">0</span> <span style="color: #666666">+</span> the_asteroids[a].radius<span style="color: #666666">*2</span> <span style="color: #666666">+</span> the_asteroids[a].radius <span style="color: #666666">*</span> (<span style="color: #B00040">float</span>)(rand()) <span style="color: #666666">/</span> (<span style="color: #B00040">float</span>)(RAND_MAX);
                            the_asteroids[a].y <span style="color: #666666">=</span> WINDOW_HEIGHT <span style="color: #666666">-</span> the_asteroids[a].radius<span style="color: #666666">*2</span> <span style="color: #666666">-</span> the_asteroids[a].radius <span style="color: #666666">*</span> (<span style="color: #B00040">float</span>)(rand()) <span style="color: #666666">/</span> (<span style="color: #B00040">float</span>)(RAND_MAX);
                            the_asteroids[a].off_screen <span style="color: #666666">=</span> <span style="color: #008000">false</span>;
                            the_asteroids[a].ex_anim_count <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
                        }     
                    }
                    corner <span style="color: #666666">=</span> BOTTOMRIGHT;
                }
                <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(corner <span style="color: #666666">==</span> BOTTOMRIGHT){
                    <span style="color: #008000; font-weight: bold">for</span>(<span style="color: #B00040">int</span> a <span style="color: #666666">=</span> <span style="color: #666666">0</span>; a<span style="color: #666666">&lt;</span>asteroid_num; a<span style="color: #666666">++</span>){
                        <span style="color: #008000; font-weight: bold">if</span>(the_asteroids[a].off_screen <span style="color: #666666">==</span> <span style="color: #008000">true</span>){
                            fillCircle((<span style="color: #B00040">int</span>)the_asteroids[a].x, (<span style="color: #B00040">int</span>)the_asteroids[a].y, (<span style="color: #B00040">int</span>)the_asteroids[a].radius<span style="color: #666666">*2</span>, BLACK);
                            the_asteroids[a].vx <span style="color: #666666">=</span> <span style="color: #666666">-1.5</span> <span style="color: #666666">-</span> <span style="color: #666666">.1*</span>(<span style="color: #B00040">float</span>)(rand()) <span style="color: #666666">/</span> (<span style="color: #B00040">float</span>)(RAND_MAX);
                            the_asteroids[a].vy <span style="color: #666666">=</span> <span style="color: #666666">.05*</span>(<span style="color: #B00040">float</span>)(rand()) <span style="color: #666666">/</span> (<span style="color: #B00040">float</span>)(RAND_MAX);
                            the_asteroids[a].x <span style="color: #666666">=</span> WINDOW_WIDTH <span style="color: #666666">-</span> the_asteroids[a].radius<span style="color: #666666">*2</span> <span style="color: #666666">-</span> the_asteroids[a].radius <span style="color: #666666">*</span> (<span style="color: #B00040">float</span>)(rand()) <span style="color: #666666">/</span> (<span style="color: #B00040">float</span>)(RAND_MAX);
                            the_asteroids[a].y <span style="color: #666666">=</span> WINDOW_HEIGHT <span style="color: #666666">-</span> the_asteroids[a].radius<span style="color: #666666">*2</span> <span style="color: #666666">-</span> the_asteroids[a].radius <span style="color: #666666">*</span> (<span style="color: #B00040">float</span>)(rand()) <span style="color: #666666">/</span> (<span style="color: #B00040">float</span>)(RAND_MAX);
                            the_asteroids[a].off_screen <span style="color: #666666">=</span> <span style="color: #008000">false</span>;
                            the_asteroids[a].ex_anim_count <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
                        }     
                    }
                    corner <span style="color: #666666">=</span> TOPRIGHT;
                }
                <span style="color: #408080; font-style: italic">//redraw planet only if asteroid hits it</span>
                fillCircle((<span style="color: #B00040">int</span>)the_planet.x, (<span style="color: #B00040">int</span>)the_planet.y, (<span style="color: #B00040">int</span>)the_planet.radius, DARK_GREEN);
                redraw <span style="color: #666666">=</span> <span style="color: #008000">false</span>;
            }
            <span style="color: #408080; font-style: italic">//euler integrate positions and velocities of all asteroids, if they haven&#39;t been destroyed</span>
            <span style="color: #008000; font-weight: bold">for</span>(<span style="color: #B00040">int</span> a <span style="color: #666666">=</span> <span style="color: #666666">0</span>; a<span style="color: #666666">&lt;</span>asteroid_num; a<span style="color: #666666">++</span>){
                <span style="color: #008000; font-weight: bold">if</span>(the_asteroids[a].off_screen <span style="color: #666666">==</span> <span style="color: #008000">false</span>){
                    angle <span style="color: #666666">=</span> atan2(the_asteroids[a].y<span style="color: #666666">-</span>the_planet.y, the_asteroids[a].x <span style="color: #666666">-</span> the_planet.x);
                    force <span style="color: #666666">=</span> <span style="color: #666666">-1*</span>GRAV_CONST<span style="color: #666666">*</span>(the_planet.mass<span style="color: #666666">*</span>the_asteroids[a].mass)<span style="color: #666666">/</span>distance_sq;
                    accel <span style="color: #666666">=</span> force<span style="color: #666666">/</span>the_asteroids[a].mass;
                    accel_x <span style="color: #666666">=</span> accel<span style="color: #666666">*</span>cos(angle);
                    accel_y <span style="color: #666666">=</span> accel<span style="color: #666666">*</span>sin(angle);
                    the_asteroids[a].vx <span style="color: #666666">=</span> the_asteroids[a].vx <span style="color: #666666">+</span> accel_x; 
                    the_asteroids[a].vy <span style="color: #666666">=</span> the_asteroids[a].vy <span style="color: #666666">+</span> accel_y; 
                    the_asteroids[a].x <span style="color: #666666">=</span> the_asteroids[a].x <span style="color: #666666">+</span> the_asteroids[a].vx;
                    the_asteroids[a].y <span style="color: #666666">=</span> the_asteroids[a].y <span style="color: #666666">+</span> the_asteroids[a].vy;
                    fillCircle((<span style="color: #B00040">int</span>)the_asteroids[a].x, (<span style="color: #B00040">int</span>)the_asteroids[a].y, (<span style="color: #B00040">int</span>)the_asteroids[a].radius, WHITE);
                }
                <span style="color: #008000; font-weight: bold">if</span>(the_asteroids[a].exploding <span style="color: #666666">==</span> <span style="color: #008000">true</span> <span style="color: #666666">&amp;&amp;</span> the_asteroids[a].off_screen <span style="color: #666666">==</span> <span style="color: #008000">true</span>){
                    <span style="color: #408080; font-style: italic">//if asteroids are exploding, play explosion animation</span>
                    <span style="color: #008000; font-weight: bold">if</span>(the_asteroids[a].ex_anim_count <span style="color: #666666">==</span> <span style="color: #666666">0</span>){
                        dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan_1) ;
                        fillCircle((<span style="color: #B00040">int</span>)the_asteroids[a].x, (<span style="color: #B00040">int</span>)the_asteroids[a].y, (<span style="color: #B00040">int</span>)the_asteroids[a].radius, RED);
                        the_asteroids[a].ex_anim_count<span style="color: #666666">++</span>;
                    } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_asteroids[a].ex_anim_count <span style="color: #666666">==</span> <span style="color: #666666">1</span>){
                        dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan_1) ;
                        fillCircle((<span style="color: #B00040">int</span>)the_asteroids[a].x, (<span style="color: #B00040">int</span>)the_asteroids[a].y, (<span style="color: #B00040">int</span>)the_asteroids[a].radius<span style="color: #666666">*2</span>, RED);
                        the_asteroids[a].ex_anim_count<span style="color: #666666">++</span>;
                    } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_asteroids[a].ex_anim_count <span style="color: #666666">==</span> <span style="color: #666666">2</span>){
                        dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan_1) ;
                        fillCircle((<span style="color: #B00040">int</span>)the_asteroids[a].x, (<span style="color: #B00040">int</span>)the_asteroids[a].y, (<span style="color: #B00040">int</span>)the_asteroids[a].radius, YELLOW);
                        the_asteroids[a].ex_anim_count<span style="color: #666666">++</span>;
                    } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_asteroids[a].ex_anim_count <span style="color: #666666">==</span> <span style="color: #666666">3</span>){
                        dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan_1) ;
                        fillCircle((<span style="color: #B00040">int</span>)the_asteroids[a].x, (<span style="color: #B00040">int</span>)the_asteroids[a].y, (<span style="color: #B00040">int</span>)the_asteroids[a].radius<span style="color: #666666">*2</span>, YELLOW);
                        the_asteroids[a].ex_anim_count<span style="color: #666666">++</span>;
                    } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_asteroids[a].ex_anim_count <span style="color: #666666">==</span> <span style="color: #666666">4</span>){
                        dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan_1) ;
                        fillCircle((<span style="color: #B00040">int</span>)the_asteroids[a].x, (<span style="color: #B00040">int</span>)the_asteroids[a].y, (<span style="color: #B00040">int</span>)the_asteroids[a].radius, RED);
                        the_asteroids[a].ex_anim_count<span style="color: #666666">++</span>;
                    } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_asteroids[a].ex_anim_count <span style="color: #666666">==</span> <span style="color: #666666">5</span>){
                        dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan_1) ;
                        fillCircle((<span style="color: #B00040">int</span>)the_asteroids[a].x, (<span style="color: #B00040">int</span>)the_asteroids[a].y, (<span style="color: #B00040">int</span>)the_asteroids[a].radius<span style="color: #666666">*2</span>, RED);
                        the_asteroids[a].ex_anim_count<span style="color: #666666">++</span>;
                    } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_asteroids[a].ex_anim_count <span style="color: #666666">==</span> <span style="color: #666666">6</span>){
                        dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan_1) ;
                        fillCircle((<span style="color: #B00040">int</span>)the_asteroids[a].x, (<span style="color: #B00040">int</span>)the_asteroids[a].y, (<span style="color: #B00040">int</span>)the_asteroids[a].radius, YELLOW);
                        the_asteroids[a].ex_anim_count<span style="color: #666666">++</span>;
                    } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_asteroids[a].ex_anim_count <span style="color: #666666">==</span> <span style="color: #666666">7</span>){
                        fillCircle((<span style="color: #B00040">int</span>)the_asteroids[a].x, (<span style="color: #B00040">int</span>)the_asteroids[a].y, (<span style="color: #B00040">int</span>)the_asteroids[a].radius<span style="color: #666666">*2</span>, YELLOW);
                        the_asteroids[a].ex_anim_count<span style="color: #666666">++</span>;
                    } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_asteroids[a].ex_anim_count <span style="color: #666666">==</span> <span style="color: #666666">8</span>){
                        fillCircle((<span style="color: #B00040">int</span>)the_asteroids[a].x, (<span style="color: #B00040">int</span>)the_asteroids[a].y, (<span style="color: #B00040">int</span>)the_asteroids[a].radius, RED);
                        the_asteroids[a].ex_anim_count<span style="color: #666666">++</span>;
                    } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_asteroids[a].ex_anim_count <span style="color: #666666">==</span> <span style="color: #666666">9</span>){
                        fillCircle((<span style="color: #B00040">int</span>)the_asteroids[a].x, (<span style="color: #B00040">int</span>)the_asteroids[a].y, (<span style="color: #B00040">int</span>)the_asteroids[a].radius<span style="color: #666666">*2</span>, RED);
                        the_asteroids[a].ex_anim_count<span style="color: #666666">++</span>;
                    } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_asteroids[a].ex_anim_count <span style="color: #666666">==</span> <span style="color: #666666">10</span>){
                        fillCircle((<span style="color: #B00040">int</span>)the_asteroids[a].x, (<span style="color: #B00040">int</span>)the_asteroids[a].y, (<span style="color: #B00040">int</span>)the_asteroids[a].radius, YELLOW);
                        the_asteroids[a].ex_anim_count<span style="color: #666666">++</span>;
                    } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_asteroids[a].ex_anim_count <span style="color: #666666">==</span> <span style="color: #666666">11</span>){
                        fillCircle((<span style="color: #B00040">int</span>)the_asteroids[a].x, (<span style="color: #B00040">int</span>)the_asteroids[a].y, (<span style="color: #B00040">int</span>)the_asteroids[a].radius<span style="color: #666666">*2</span>, YELLOW);
                        the_asteroids[a].ex_anim_count<span style="color: #666666">++</span>;
                    } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_asteroids[a].ex_anim_count <span style="color: #666666">==</span> <span style="color: #666666">12</span>){
                        fillCircle((<span style="color: #B00040">int</span>)the_asteroids[a].x, (<span style="color: #B00040">int</span>)the_asteroids[a].y, (<span style="color: #B00040">int</span>)the_asteroids[a].radius, RED);
                        the_asteroids[a].ex_anim_count<span style="color: #666666">++</span>;
                    } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_asteroids[a].ex_anim_count <span style="color: #666666">==</span> <span style="color: #666666">13</span>){
                        fillCircle((<span style="color: #B00040">int</span>)the_asteroids[a].x, (<span style="color: #B00040">int</span>)the_asteroids[a].y, (<span style="color: #B00040">int</span>)the_asteroids[a].radius<span style="color: #666666">*2</span>, RED);
                        the_asteroids[a].ex_anim_count<span style="color: #666666">++</span>;
                    } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_asteroids[a].ex_anim_count <span style="color: #666666">==</span> <span style="color: #666666">14</span>){
                        fillCircle((<span style="color: #B00040">int</span>)the_asteroids[a].x, (<span style="color: #B00040">int</span>)the_asteroids[a].y, (<span style="color: #B00040">int</span>)the_asteroids[a].radius, YELLOW);
                        the_asteroids[a].ex_anim_count<span style="color: #666666">++</span>;
                    } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_asteroids[a].ex_anim_count <span style="color: #666666">==</span> <span style="color: #666666">15</span>){
                        fillCircle((<span style="color: #B00040">int</span>)the_asteroids[a].x, (<span style="color: #B00040">int</span>)the_asteroids[a].y, (<span style="color: #B00040">int</span>)the_asteroids[a].radius<span style="color: #666666">*2</span>, YELLOW);
                        the_asteroids[a].ex_anim_count<span style="color: #666666">++</span>;
                    }
                    <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(the_asteroids[a].ex_anim_count <span style="color: #666666">==</span> <span style="color: #666666">16</span>){
                        fillCircle((<span style="color: #B00040">int</span>)the_asteroids[a].x, (<span style="color: #B00040">int</span>)the_asteroids[a].y, (<span style="color: #B00040">int</span>)the_asteroids[a].radius<span style="color: #666666">*2</span>, BLACK);
                        the_asteroids[a].exploding <span style="color: #666666">=</span> <span style="color: #008000">false</span>;
                        the_asteroids[a].x <span style="color: #666666">=</span> <span style="color: #666666">1000</span>;
                        fillCircle((<span style="color: #B00040">int</span>)the_planet.x, (<span style="color: #B00040">int</span>)the_planet.y, (<span style="color: #B00040">int</span>)the_planet.radius, DARK_GREEN);
                    }
                    fillCircle((<span style="color: #B00040">int</span>)the_planet.x, (<span style="color: #B00040">int</span>)the_planet.y, (<span style="color: #B00040">int</span>)the_planet.radius, DARK_GREEN);
                }     
            }
            <span style="color: #408080; font-style: italic">//ensure at least 200 frames pass between waves </span>
            <span style="color: #008000; font-weight: bold">if</span>(corner_counter <span style="color: #666666">&lt;</span> <span style="color: #666666">200</span>){
                corner_counter<span style="color: #666666">++</span>;
            }<span style="color: #008000; font-weight: bold">else</span>{
                corner_counter <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
            }
            <span style="color: #408080; font-style: italic">//draw cities</span>
            drawCity(the_cities[<span style="color: #666666">0</span>], WHITE);
            drawCity(the_cities[<span style="color: #666666">1</span>], WHITE);
            drawCity(the_cities[<span style="color: #666666">2</span>], WHITE);
            drawCity(the_cities[<span style="color: #666666">3</span>], WHITE);

            <span style="color: #408080; font-style: italic">//draw score and lives</span>
            setCursor(<span style="color: #666666">0</span>, <span style="color: #666666">0</span>);
            setTextColor2(color, BLACK);
            snprintf(screen_text_buffer, <span style="color: #666666">64</span>, <span style="color: #BA2121">&quot;ASTEROIDS SHOT: %d&quot;</span>, asteroids_shot);
            writeString(screen_text_buffer);
            setCursor(<span style="color: #666666">0</span>, <span style="color: #666666">12</span>);
            setTextColor2(color, BLACK);
            snprintf(screen_text_buffer, <span style="color: #666666">64</span>, <span style="color: #BA2121">&quot;LIVES: %d&quot;</span>, the_ship.lives);
            writeString(screen_text_buffer);

            <span style="color: #408080; font-style: italic">//if all cities are destroyed, set ship lives to zero</span>
            <span style="color: #008000; font-weight: bold">if</span>(the_cities[NORTH].health <span style="color: #666666">==</span> <span style="color: #666666">0</span> <span style="color: #666666">&amp;&amp;</span> the_cities[SOUTH].health <span style="color: #666666">==</span> <span style="color: #666666">0</span> <span style="color: #666666">&amp;&amp;</span> the_cities[EAST].health <span style="color: #666666">==</span> <span style="color: #666666">0</span> <span style="color: #666666">&amp;&amp;</span> the_cities[WEST].health <span style="color: #666666">==</span> <span style="color: #666666">0</span>){
                the_ship.lives <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
            }
            <span style="color: #408080; font-style: italic">//check timing</span>
            spare_time <span style="color: #666666">=</span> FRAME_RATE <span style="color: #666666">-</span> (time_us_32() <span style="color: #666666">-</span> begin_time) ;
            <span style="color: #008000; font-weight: bold">if</span>(spare_time <span style="color: #666666">&lt;</span> <span style="color: #666666">0</span>){
            gpio_put(LED, <span style="color: #666666">0</span>) ;
            }
            <span style="color: #008000; font-weight: bold">else</span>{
            gpio_put(LED, <span style="color: #666666">1</span>) ;
            }
            <span style="color: #408080; font-style: italic">// delay in accordance with frame rate</span>
            <span style="color: #408080; font-style: italic">// yield for necessary amount of time</span>
            PT_YIELD_usec(spare_time) ;
        } <span style="color: #408080; font-style: italic">// END WHILE</span>
        <span style="color: #408080; font-style: italic">//calculate high score</span>
        <span style="color: #008000; font-weight: bold">if</span>(asteroids_shot <span style="color: #666666">&gt;</span> high_score){
            high_score <span style="color: #666666">=</span> asteroids_shot;
        }
        <span style="color: #408080; font-style: italic">//draw end screen</span>
        fillRect(<span style="color: #666666">0</span>,<span style="color: #666666">0</span>,WINDOW_WIDTH, WINDOW_HEIGHT, BLACK);
        setTextSize(<span style="color: #666666">8</span>);
        setCursor(<span style="color: #666666">100</span>, <span style="color: #666666">100</span>);
        setTextColor2(color, BLACK);
        snprintf(screen_text_buffer, <span style="color: #666666">64</span>, <span style="color: #BA2121">&quot;GAME OVER&quot;</span>);
        writeString(screen_text_buffer);

        setTextSize(<span style="color: #666666">4</span>);
        setCursor(<span style="color: #666666">155</span>, <span style="color: #666666">175</span>);
        setTextColor2(color, BLACK);
        snprintf(screen_text_buffer, <span style="color: #666666">64</span>, <span style="color: #BA2121">&quot;YOUR SCORE: %d&quot;</span>, asteroids_shot);
        writeString(screen_text_buffer);

        setTextSize(<span style="color: #666666">4</span>);
        setCursor(<span style="color: #666666">155</span>, <span style="color: #666666">250</span>);
        setTextColor2(color, BLACK);
        snprintf(screen_text_buffer, <span style="color: #666666">64</span>, <span style="color: #BA2121">&quot;HIGH SCORE: %d&quot;</span>, high_score);
        writeString(screen_text_buffer);

        setTextSize(<span style="color: #666666">4</span>);
        setCursor(<span style="color: #666666">180</span>, <span style="color: #666666">325</span>);
        setTextColor2(color, BLACK);
        snprintf(screen_text_buffer, <span style="color: #666666">64</span>, <span style="color: #BA2121">&quot;PLAY AGAIN?&quot;</span>);
        writeString(screen_text_buffer);
        waiting <span style="color: #666666">=</span> <span style="color: #008000">true</span>;
        again_pressed_state <span style="color: #666666">=</span> NOT_PRESSED;
        again_possible <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
        dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan) ;
        <span style="color: #408080; font-style: italic">//wait for button press</span>
        <span style="color: #008000; font-weight: bold">while</span>(waiting){
            <span style="color: #B00040">int</span> again_button_val <span style="color: #666666">=</span> gpio_get(<span style="color: #666666">9</span>);
            <span style="color: #408080; font-style: italic">//debouncing code</span>
            <span style="color: #008000; font-weight: bold">if</span>(again_pressed_state <span style="color: #666666">==</span> NOT_PRESSED){
                <span style="color: #008000; font-weight: bold">if</span>(again_button_val <span style="color: #666666">!=</span> <span style="color: #666666">0</span>){
                    again_pressed_state <span style="color: #666666">=</span> MAYBE_PRESSED;
                    again_possible <span style="color: #666666">=</span> <span style="color: #666666">1</span>;
                }
            }
            <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(again_pressed_state <span style="color: #666666">==</span> MAYBE_PRESSED){
                <span style="color: #408080; font-style: italic">// On Transition from state MAYBE_PRESSED to state PRESSED, change the button state</span>
                <span style="color: #008000; font-weight: bold">if</span>(again_button_val <span style="color: #666666">==</span> up_possible){
                    again_pressed_state <span style="color: #666666">=</span> PRESSED;
                    
                    waiting <span style="color: #666666">=</span> <span style="color: #008000">false</span>;
                    dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan) ;
                }
                <span style="color: #008000; font-weight: bold">else</span>{
                    again_pressed_state <span style="color: #666666">=</span> NOT_PRESSED;
                }
            }
            <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(again_pressed_state <span style="color: #666666">==</span> PRESSED){
                <span style="color: #008000; font-weight: bold">if</span>(again_button_val <span style="color: #666666">==</span> up_possible){
                    again_pressed_state <span style="color: #666666">=</span> PRESSED;
                }
                <span style="color: #008000; font-weight: bold">else</span>{
                    again_pressed_state <span style="color: #666666">=</span> MAYBE_NOT_PRESSED;
                }
            }
            <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span> (again_pressed_state <span style="color: #666666">==</span> MAYBE_NOT_PRESSED){
                <span style="color: #008000; font-weight: bold">if</span>(again_button_val <span style="color: #666666">==</span> up_possible){
                    again_pressed_state <span style="color: #666666">=</span> PRESSED;
                }
                <span style="color: #008000; font-weight: bold">else</span>{
                    again_pressed_state <span style="color: #666666">=</span> NOT_PRESSED;
                }
            }
        }
        fillRect(<span style="color: #666666">0</span>,<span style="color: #666666">0</span>,WINDOW_WIDTH, WINDOW_HEIGHT, BLACK);
        setTextSize(<span style="color: #666666">1</span>);
    }
  PT_END(pt);
} <span style="color: #408080; font-style: italic">// animation thread</span>



<span style="color: #408080; font-style: italic">// ========================================</span>
<span style="color: #408080; font-style: italic">// === main</span>
<span style="color: #408080; font-style: italic">// ========================================</span>
<span style="color: #408080; font-style: italic">// USE ONLY C-sdk library</span>
<span style="color: #B00040">int</span> <span style="color: #0000FF">main</span>(){
    
    <span style="color: #408080; font-style: italic">// initialize stio</span>
    stdio_init_all() ;

    <span style="color: #408080; font-style: italic">// initialize VGA</span>
    initVGA() ;

    <span style="color: #408080; font-style: italic">//initialize GPIOs</span>
    gpio_init(LED) ;
    gpio_set_dir(LED, GPIO_OUT) ;
    gpio_put(LED, <span style="color: #666666">0</span>) ;

    gpio_init(<span style="color: #666666">9</span>);
    gpio_set_dir(<span style="color: #666666">9</span>, GPIO_IN) ;

    gpio_init(<span style="color: #666666">15</span>);
    gpio_set_dir(<span style="color: #666666">15</span>, GPIO_IN) ;

    gpio_init(<span style="color: #666666">14</span>);
    gpio_set_dir(<span style="color: #666666">14</span>, GPIO_IN) ;

    gpio_init(<span style="color: #666666">13</span>);
    gpio_set_dir(<span style="color: #666666">13</span>, GPIO_IN) ;

    gpio_init(<span style="color: #666666">12</span>);
    gpio_set_dir(<span style="color: #666666">12</span>, GPIO_IN) ;

    <span style="color: #408080; font-style: italic">// Initialize SPI channel (channel, baud rate set to 20MHz)</span>
    spi_init(SPI_PORT, <span style="color: #666666">20000000</span>) ;

    <span style="color: #408080; font-style: italic">// Format SPI channel (channel, data bits per transfer, polarity, phase, order)</span>
    spi_set_format(SPI_PORT, <span style="color: #666666">16</span>, <span style="color: #666666">0</span>, <span style="color: #666666">0</span>, <span style="color: #666666">0</span>);

    <span style="color: #408080; font-style: italic">// Map SPI signals to GPIO ports, acts like framed SPI with this CS mapping</span>
    gpio_set_function(PIN_MISO, GPIO_FUNC_SPI);
    gpio_set_function(PIN_CS, GPIO_FUNC_SPI) ;
    gpio_set_function(PIN_SCK, GPIO_FUNC_SPI);
    gpio_set_function(PIN_MOSI, GPIO_FUNC_SPI);
    gpio_init(<span style="color: #666666">15</span>);
    gpio_set_dir(<span style="color: #666666">15</span>, GPIO_IN) ;

    <span style="color: #408080; font-style: italic">// Build sine table and DAC data table</span>
    <span style="color: #B00040">int</span> i ;
    <span style="color: #B00040">float</span> ramp;
    <span style="color: #008000; font-weight: bold">for</span> (i<span style="color: #666666">=0</span>; i<span style="color: #666666">&lt;</span>(sine_table_size); i<span style="color: #666666">++</span>){
            <span style="color: #008000; font-weight: bold">if</span>(i<span style="color: #666666">&lt;100</span>){
                ramp <span style="color: #666666">=</span> i<span style="color: #666666">/100.0</span>;
            } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(i<span style="color: #666666">&gt;</span>sine_table_size<span style="color: #666666">-100</span>){
                ramp <span style="color: #666666">=</span> (sine_table_size<span style="color: #666666">-</span>i)<span style="color: #666666">/100.0</span>;
            } <span style="color: #008000; font-weight: bold">else</span>{
                ramp <span style="color: #666666">=</span> <span style="color: #666666">1</span>;
            }
        <span style="color: #008000; font-weight: bold">if</span>(i<span style="color: #666666">&lt;64</span>){
            raw_sin[i] <span style="color: #666666">=</span> (<span style="color: #B00040">int</span>)(<span style="color: #666666">2047*</span>ramp<span style="color: #666666">*0.5</span> <span style="color: #666666">+2047</span>);
        } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(i<span style="color: #666666">&lt;128</span>){
            raw_sin[i] <span style="color: #666666">=</span> (<span style="color: #B00040">int</span>)(<span style="color: #666666">-1*2047*</span>ramp<span style="color: #666666">*0.5</span> <span style="color: #666666">+2047</span>);
        } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(i <span style="color: #666666">&lt;</span> <span style="color: #666666">192</span>){
            raw_sin[i] <span style="color: #666666">=</span> (<span style="color: #B00040">int</span>)(<span style="color: #666666">2047*</span>ramp<span style="color: #666666">*0.5</span> <span style="color: #666666">+2047</span>);
        }<span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(i <span style="color: #666666">&lt;</span> <span style="color: #666666">256</span>){
            raw_sin[i] <span style="color: #666666">=</span> (<span style="color: #B00040">int</span>)(<span style="color: #666666">-1*2047*</span>ramp<span style="color: #666666">*0.5</span> <span style="color: #666666">+2047</span>); 
        }<span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(i <span style="color: #666666">&lt;</span> <span style="color: #666666">320</span>){
            raw_sin[i] <span style="color: #666666">=</span> (<span style="color: #B00040">int</span>)(<span style="color: #666666">2047*</span>ramp<span style="color: #666666">*0.5</span> <span style="color: #666666">+2047</span>); 
        }<span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(i <span style="color: #666666">&lt;</span> <span style="color: #666666">384</span>){
            raw_sin[i] <span style="color: #666666">=</span> (<span style="color: #B00040">int</span>)(<span style="color: #666666">-1*2047*</span>ramp<span style="color: #666666">*0.5</span> <span style="color: #666666">+2047</span>); 
        }<span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(i <span style="color: #666666">&lt;</span> <span style="color: #666666">448</span>){
            raw_sin[i] <span style="color: #666666">=</span> (<span style="color: #B00040">int</span>)(<span style="color: #666666">2047*</span>ramp<span style="color: #666666">*0.5</span> <span style="color: #666666">+2047</span>); 
        }<span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(i <span style="color: #666666">&lt;</span> <span style="color: #666666">512</span>){
            raw_sin[i] <span style="color: #666666">=</span> (<span style="color: #B00040">int</span>)(<span style="color: #666666">-1*2047*</span>ramp<span style="color: #666666">*0.5</span> <span style="color: #666666">+2047</span>); 
        }<span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(i <span style="color: #666666">&lt;</span> <span style="color: #666666">576</span>){
            raw_sin[i] <span style="color: #666666">=</span> (<span style="color: #B00040">int</span>)(<span style="color: #666666">2047*</span>ramp<span style="color: #666666">*0.5</span> <span style="color: #666666">+2047</span>); 
        }<span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(i <span style="color: #666666">&lt;</span> <span style="color: #666666">640</span>){
            raw_sin[i] <span style="color: #666666">=</span> (<span style="color: #B00040">int</span>)(<span style="color: #666666">-1*2047*</span>ramp<span style="color: #666666">*0.5</span> <span style="color: #666666">+2047</span>); 
        }<span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(i <span style="color: #666666">&lt;</span> <span style="color: #666666">704</span>){
            raw_sin[i] <span style="color: #666666">=</span> (<span style="color: #B00040">int</span>)(<span style="color: #666666">2047*</span>ramp<span style="color: #666666">*0.5</span> <span style="color: #666666">+2047</span>);
        }<span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(i <span style="color: #666666">&lt;</span> <span style="color: #666666">768</span>){
            raw_sin[i] <span style="color: #666666">=</span> (<span style="color: #B00040">int</span>)(<span style="color: #666666">-1*2047*</span>ramp<span style="color: #666666">*0.5</span> <span style="color: #666666">+2047</span>);  
        }<span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(i <span style="color: #666666">&lt;</span> <span style="color: #666666">832</span>){
            raw_sin[i] <span style="color: #666666">=</span> (<span style="color: #B00040">int</span>)(<span style="color: #666666">2047*</span>ramp<span style="color: #666666">*0.5</span> <span style="color: #666666">+2047</span>); 
        }<span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(i <span style="color: #666666">&lt;</span> <span style="color: #666666">896</span>){
            raw_sin[i] <span style="color: #666666">=</span> (<span style="color: #B00040">int</span>)(<span style="color: #666666">-1*2047*</span>ramp<span style="color: #666666">*0.5</span> <span style="color: #666666">+2047</span>);
        }<span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(i <span style="color: #666666">&lt;</span> <span style="color: #666666">960</span>){
            raw_sin[i] <span style="color: #666666">=</span> (<span style="color: #B00040">int</span>)(<span style="color: #666666">2047*</span>ramp<span style="color: #666666">*0.5</span> <span style="color: #666666">+2047</span>);  
        } <span style="color: #008000; font-weight: bold">else</span>{
            raw_sin[i] <span style="color: #666666">=</span> (<span style="color: #B00040">int</span>)(<span style="color: #666666">-1*2047*</span>ramp<span style="color: #666666">*0.5</span> <span style="color: #666666">+2047</span>);
        }
        DAC_data[i] <span style="color: #666666">=</span> DAC_config_chan_A <span style="color: #666666">|</span> (raw_sin[i] <span style="color: #666666">&amp;</span> <span style="color: #666666">0x0fff</span>) ;
    }
    
    <span style="color: #008000; font-weight: bold">for</span> (i<span style="color: #666666">=0</span>; i<span style="color: #666666">&lt;</span>(sine_table_size); i<span style="color: #666666">++</span>){
        ramp<span style="color: #666666">=8</span>;
        <span style="color: #408080; font-style: italic">// raw_sin_1[i] = (int)(ramp*2047 * sin((float)0.5*i*6.283/(float)sine_table_size) + 2047); //12 bit</span>
        raw_sin_1[i] <span style="color: #666666">=</span> (<span style="color: #B00040">int</span>)(ramp<span style="color: #666666">*2047*</span>(<span style="color: #B00040">float</span>)rand()<span style="color: #666666">/</span>RAND_MAX <span style="color: #666666">+</span> <span style="color: #666666">2047</span>); <span style="color: #408080; font-style: italic">//12 bit</span>
        DAC_data_1[i] <span style="color: #666666">=</span> DAC_config_chan_B <span style="color: #666666">|</span> (raw_sin_1[i] <span style="color: #666666">&amp;</span> <span style="color: #666666">0x0fff</span>) ;
    }

    <span style="color: #008000; font-weight: bold">for</span> (i<span style="color: #666666">=0</span>; i<span style="color: #666666">&lt;</span>(sine_table_size); i<span style="color: #666666">++</span>){
        ramp<span style="color: #666666">=8</span>;
        raw_sin_2[i] <span style="color: #666666">=</span> (<span style="color: #B00040">int</span>)(ramp<span style="color: #666666">*</span>(<span style="color: #B00040">float</span>)rand()<span style="color: #666666">/</span>RAND_MAX); <span style="color: #408080; font-style: italic">//12 bit</span>
        DAC_data_2[i] <span style="color: #666666">=</span> DAC_config_chan_B <span style="color: #666666">|</span> (raw_sin_1[i] <span style="color: #666666">&amp;</span> <span style="color: #666666">0x0fff</span>) ;
    }

    
    <span style="color: #408080; font-style: italic">// Select DMA channels</span>
    data_chan <span style="color: #666666">=</span> dma_claim_unused_channel(<span style="color: #008000">true</span>);
    ctrl_chan <span style="color: #666666">=</span> dma_claim_unused_channel(<span style="color: #008000">true</span>);

    data_chan_1 <span style="color: #666666">=</span> dma_claim_unused_channel(<span style="color: #008000">true</span>);
    ctrl_chan_1 <span style="color: #666666">=</span> dma_claim_unused_channel(<span style="color: #008000">true</span>);

    <span style="color: #408080; font-style: italic">// Setup the control channel</span>
    dma_channel_config c <span style="color: #666666">=</span> dma_channel_get_default_config(ctrl_chan);   <span style="color: #408080; font-style: italic">// default configs</span>
    channel_config_set_transfer_data_size(<span style="color: #666666">&amp;</span>c, DMA_SIZE_32);             <span style="color: #408080; font-style: italic">// 32-bit txfers</span>
    channel_config_set_read_increment(<span style="color: #666666">&amp;</span>c, <span style="color: #008000">false</span>);                       <span style="color: #408080; font-style: italic">// no read incrementing</span>
    channel_config_set_write_increment(<span style="color: #666666">&amp;</span>c, <span style="color: #008000">false</span>);                      <span style="color: #408080; font-style: italic">// no write incrementing</span>
    channel_config_set_chain_to(<span style="color: #666666">&amp;</span>c, data_chan);                         <span style="color: #408080; font-style: italic">// chain to data channel</span>

    dma_channel_config c1 <span style="color: #666666">=</span> dma_channel_get_default_config(ctrl_chan_1);   <span style="color: #408080; font-style: italic">// default configs</span>
    channel_config_set_transfer_data_size(<span style="color: #666666">&amp;</span>c1, DMA_SIZE_32);             <span style="color: #408080; font-style: italic">// 32-bit txfers</span>
    channel_config_set_read_increment(<span style="color: #666666">&amp;</span>c1, <span style="color: #008000">false</span>);                       <span style="color: #408080; font-style: italic">// no read incrementing</span>
    channel_config_set_write_increment(<span style="color: #666666">&amp;</span>c1, <span style="color: #008000">false</span>);                      <span style="color: #408080; font-style: italic">// no write incrementing</span>
    channel_config_set_chain_to(<span style="color: #666666">&amp;</span>c1, data_chan_1);                         <span style="color: #408080; font-style: italic">// chain to data channel</span>

    dma_channel_configure(
        ctrl_chan,                          <span style="color: #408080; font-style: italic">// Channel to be configured</span>
        <span style="color: #666666">&amp;</span>c,                                 <span style="color: #408080; font-style: italic">// The configuration we just created</span>
        <span style="color: #666666">&amp;</span>dma_hw<span style="color: #666666">-&gt;</span>ch[data_chan].read_addr,   <span style="color: #408080; font-style: italic">// Write address (data channel read address)</span>
        <span style="color: #666666">&amp;</span>DAC_address_pointer,                   <span style="color: #408080; font-style: italic">// Read address (POINTER TO AN ADDRESS)</span>
        <span style="color: #666666">1</span>,                                  <span style="color: #408080; font-style: italic">// Number of transfers</span>
        <span style="color: #008000">false</span>                               <span style="color: #408080; font-style: italic">// Don&#39;t start immediately</span>
    );

    dma_channel_configure(
        ctrl_chan_1,                          <span style="color: #408080; font-style: italic">// Channel to be configured</span>
        <span style="color: #666666">&amp;</span>c1,                                 <span style="color: #408080; font-style: italic">// The configuration we just created</span>
        <span style="color: #666666">&amp;</span>dma_hw<span style="color: #666666">-&gt;</span>ch[data_chan_1].read_addr,   <span style="color: #408080; font-style: italic">// Write address (data channel read address)</span>
        <span style="color: #666666">&amp;</span>DAC_address_pointer_1,                   <span style="color: #408080; font-style: italic">// Read address (POINTER TO AN ADDRESS)</span>
        <span style="color: #666666">1</span>,                                  <span style="color: #408080; font-style: italic">// Number of transfers</span>
        <span style="color: #008000">false</span>                               <span style="color: #408080; font-style: italic">// Don&#39;t start immediately</span>
    );

    <span style="color: #408080; font-style: italic">// Setup the data channel</span>
    dma_channel_config c2 <span style="color: #666666">=</span> dma_channel_get_default_config(data_chan);  <span style="color: #408080; font-style: italic">// Default configs</span>
    channel_config_set_transfer_data_size(<span style="color: #666666">&amp;</span>c2, DMA_SIZE_16);            <span style="color: #408080; font-style: italic">// 16-bit txfers</span>
    channel_config_set_read_increment(<span style="color: #666666">&amp;</span>c2, <span style="color: #008000">true</span>);                       <span style="color: #408080; font-style: italic">// yes read incrementing</span>
    channel_config_set_write_increment(<span style="color: #666666">&amp;</span>c2, <span style="color: #008000">false</span>);                     <span style="color: #408080; font-style: italic">// no write incrementing</span>
    <span style="color: #408080; font-style: italic">// (X/Y)*sys_clk, where X is the first 16 bytes and Y is the second</span>
    <span style="color: #408080; font-style: italic">// sys_clk is 125 MHz unless changed in code. Configured to ~44 kHz</span>
    dma_timer_set_fraction(<span style="color: #666666">0</span>, <span style="color: #666666">0x0017</span>, <span style="color: #666666">0xffff</span>) ;
    <span style="color: #408080; font-style: italic">// 0x3b means timer0 (see SDK manual)</span>
    channel_config_set_dreq(<span style="color: #666666">&amp;</span>c2, <span style="color: #666666">0x3b</span>);                                 <span style="color: #408080; font-style: italic">// DREQ paced by timer 0</span>



    <span style="color: #408080; font-style: italic">// Setup the data channel</span>
    dma_channel_config c21 <span style="color: #666666">=</span> dma_channel_get_default_config(data_chan_1);  <span style="color: #408080; font-style: italic">// Default configs</span>
    channel_config_set_transfer_data_size(<span style="color: #666666">&amp;</span>c21, DMA_SIZE_16);            <span style="color: #408080; font-style: italic">// 16-bit txfers</span>
    channel_config_set_read_increment(<span style="color: #666666">&amp;</span>c21, <span style="color: #008000">true</span>);                       <span style="color: #408080; font-style: italic">// yes read incrementing</span>
    channel_config_set_write_increment(<span style="color: #666666">&amp;</span>c21, <span style="color: #008000">false</span>);                     <span style="color: #408080; font-style: italic">// no write incrementing</span>
    <span style="color: #408080; font-style: italic">// (X/Y)*sys_clk, where X is the first 16 bytes and Y is the second</span>
    <span style="color: #408080; font-style: italic">// sys_clk is 125 MHz unless changed in code. Configured to ~44 kHz</span>
    dma_timer_set_fraction(<span style="color: #666666">0</span>, <span style="color: #666666">0x0017</span>, <span style="color: #666666">0xffff</span>) ;
    <span style="color: #408080; font-style: italic">// 0x3b means timer0 (see SDK manual)</span>
    channel_config_set_dreq(<span style="color: #666666">&amp;</span>c21, <span style="color: #666666">0x3b</span>);                                 <span style="color: #408080; font-style: italic">// DREQ paced by timer 0</span>


    dma_channel_configure(
        data_chan,                  <span style="color: #408080; font-style: italic">// Channel to be configured</span>
        <span style="color: #666666">&amp;</span>c2,                        <span style="color: #408080; font-style: italic">// The configuration we just created</span>
        <span style="color: #666666">&amp;</span>spi_get_hw(SPI_PORT)<span style="color: #666666">-&gt;</span>dr,  <span style="color: #408080; font-style: italic">// write address (SPI data register)</span>
        DAC_data,                   <span style="color: #408080; font-style: italic">// The initial read address</span>
        sine_table_size,            <span style="color: #408080; font-style: italic">// Number of transfers</span>
        <span style="color: #008000">false</span>                       <span style="color: #408080; font-style: italic">// Don&#39;t start immediately.</span>
    );

    dma_channel_configure(
        data_chan_1,                  <span style="color: #408080; font-style: italic">// Channel to be configured</span>
        <span style="color: #666666">&amp;</span>c21,                        <span style="color: #408080; font-style: italic">// The configuration we just created</span>
        <span style="color: #666666">&amp;</span>spi_get_hw(SPI_PORT)<span style="color: #666666">-&gt;</span>dr,  <span style="color: #408080; font-style: italic">// write address (SPI data register)</span>
        DAC_data_1,                   <span style="color: #408080; font-style: italic">// The initial read address</span>
        sine_table_size,            <span style="color: #408080; font-style: italic">// Number of transfers</span>
        <span style="color: #008000">false</span>                       <span style="color: #408080; font-style: italic">// Don&#39;t start immediately.</span>
    );

    dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan) ;
    dma_start_channel_mask(<span style="color: #666666">1u</span> <span style="color: #666666">&lt;&lt;</span> ctrl_chan_1) ;


    sleep_ms(<span style="color: #666666">1000</span>);
    <span style="color: #408080; font-style: italic">// add threads</span>
    pt_add_thread(protothread_serial);
    pt_add_thread(protothread_anim);

    <span style="color: #408080; font-style: italic">// start scheduler</span>
    pt_schedule_start;
} 
</pre></div>

						</div>
					</section>


				<!-- Contact
					<section id="contact" class="four">
						<div class="container">

							<header>
								<h2>Contact</h2>
							</header>

							<p>Elementum sem parturient nulla quam placerat viverra
							mauris non cum elit tempus ullamcorper dolor. Libero rutrum ut lacinia
							donec curae mus. Eleifend id porttitor ac ultricies lobortis sem nunc
							orci ridiculus faucibus a consectetur. Porttitor curae mauris urna mi dolor.</p>

							<form method="post" action="#">
								<div class="row">
									<div class="col-6 col-12-mobile"><input type="text" name="name" placeholder="Name" /></div>
									<div class="col-6 col-12-mobile"><input type="text" name="email" placeholder="Email" /></div>
									<div class="col-12">
										<textarea name="message" placeholder="Message"></textarea>
									</div>
									<div class="col-12">
										<input type="submit" value="Send Message" />
									</div>
								</div>
							</form>

						</div>
					</section> -->

			</div>

		<!-- Footer -->
			<div id="footer">

				<!-- Copyright -->
					<ul class="copyright">
						<li>&copy; Untitled. All rights reserved.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
					</ul>

			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>