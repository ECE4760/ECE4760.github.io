<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav ul li a { background-image: none; } </style> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>High Level Design | Audio Localization</title> <meta name="generator" content="Jekyll v4.4.1" /> <meta property="og:title" content="High Level Design" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="A device that listens with 3 microphones, using cross-correlation to instantly point you towards a sound’s origin." /> <meta property="og:description" content="A device that listens with 3 microphones, using cross-correlation to instantly point you towards a sound’s origin." /> <link rel="canonical" href="/2-high-level-design.html" /> <meta property="og:url" content="/2-high-level-design.html" /> <meta property="og:site_name" content="Audio Localization" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="High Level Design" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"A device that listens with 3 microphones, using cross-correlation to instantly point you towards a sound’s origin.","headline":"High Level Design","url":"/2-high-level-design.html"}</script> <!-- End Jekyll SEO tag --> <base href="./" /> <link rel="stylesheet" href="assets/css/custom.css" /> <link rel="stylesheet" href="assets/css/just-the-docs-default.css" /> <script> (function (jtd, undefined) { jtd.addEvent = function (el, type, handler) { if (el.attachEvent) el.attachEvent("on" + type, handler); else el.addEventListener(type, handler); }; jtd.removeEvent = function (el, type, handler) { if (el.detachEvent) el.detachEvent("on" + type, handler); else el.removeEventListener(type, handler); }; jtd.onReady = function (ready) { if (document.readyState != "loading") ready(); else if (document.addEventListener) document.addEventListener("DOMContentLoaded", ready); else document.attachEvent("onreadystatechange", function () { if (document.readyState == "complete") ready(); }); }; function initNav() { jtd.addEvent(document, "click", function (e) { var target = e.target; while ( target && !(target.classList && target.classList.contains("nav-list-expander")) ) { target = target.parentNode; } if (target) { e.preventDefault(); target.ariaPressed = target.parentNode.classList.toggle("active"); } }); const siteNav = document.getElementById("site-nav"); const mainHeader = document.getElementById("main-header"); const menuButton = document.getElementById("menu-button"); disableHeadStyleSheets(); jtd.addEvent(menuButton, "click", function (e) { e.preventDefault(); if (menuButton.classList.toggle("nav-open")) { siteNav.classList.add("nav-open"); mainHeader.classList.add("nav-open"); menuButton.ariaPressed = true; } else { siteNav.classList.remove("nav-open"); mainHeader.classList.remove("nav-open"); menuButton.ariaPressed = false; } }); } function disableHeadStyleSheets() { const headNav = document.getElementById("jtd-head-nav-stylesheet"); if (headNav) { headNav.disabled = true; } const activation = document.getElementById("jtd-nav-activation"); if (activation) { activation.disabled = true; } } function initSearch() { var request = new XMLHttpRequest(); request.open("GET", "/assets/js/search-data.json", true); request.onload = function () { if (request.status >= 200 && request.status < 400) { var docs = JSON.parse(request.responseText); lunr.tokenizer.separator = /[\s\-/]+/; var index = lunr(function () { this.ref("id"); this.field("title", { boost: 200 }); this.field("content", { boost: 2 }); this.field("relUrl"); this.metadataWhitelist = ["position"]; for (var i in docs) { this.add({ id: i, title: docs[i].title, content: docs[i].content, relUrl: docs[i].relUrl, }); } }); searchLoaded(index, docs); } else { console.log( "Error loading ajax request. Request status:" + request.status ); } }; request.onerror = function () { console.log("There was a connection error"); }; request.send(); } function searchLoaded(index, docs) { var index = index; var docs = docs; var searchInput = document.getElementById("search-input"); var searchResults = document.getElementById("search-results"); var mainHeader = document.getElementById("main-header"); var currentInput; var currentSearchIndex = 0; function showSearch() { document.documentElement.classList.add("search-active"); } function hideSearch() { document.documentElement.classList.remove("search-active"); } function update() { currentSearchIndex++; var input = searchInput.value; if (input === "") { hideSearch(); } else { showSearch(); window.scroll(0, -1); setTimeout(function () { window.scroll(0, 0); }, 0); } if (input === currentInput) { return; } currentInput = input; searchResults.innerHTML = ""; if (input === "") { return; } var results = index.query(function (query) { var tokens = lunr.tokenizer(input); query.term(tokens, { boost: 10, }); query.term(tokens, { wildcard: lunr.Query.wildcard.TRAILING, }); }); if (results.length == 0 && input.length > 2) { var tokens = lunr.tokenizer(input).filter(function (token, i) { return token.str.length < 20; }); if (tokens.length > 0) { results = index.query(function (query) { query.term(tokens, { editDistance: Math.round(Math.sqrt(input.length / 2 - 1)), }); }); } } if (results.length == 0) { var noResultsDiv = document.createElement("div"); noResultsDiv.classList.add("search-no-result"); noResultsDiv.innerText = "No results found"; searchResults.appendChild(noResultsDiv); } else { var resultsList = document.createElement("ul"); resultsList.classList.add("search-results-list"); searchResults.appendChild(resultsList); addResults(resultsList, results, 0, 10, 100, currentSearchIndex); } function addResults( resultsList, results, start, batchSize, batchMillis, searchIndex ) { if (searchIndex != currentSearchIndex) { return; } for (var i = start; i < start + batchSize; i++) { if (i == results.length) { return; } addResult(resultsList, results[i]); } setTimeout(function () { addResults( resultsList, results, start + batchSize, batchSize, batchMillis, searchIndex ); }, batchMillis); } function addResult(resultsList, result) { var doc = docs[result.ref]; var resultsListItem = document.createElement("li"); resultsListItem.classList.add("search-results-list-item"); resultsList.appendChild(resultsListItem); var resultLink = document.createElement("a"); resultLink.classList.add("search-result"); resultLink.setAttribute("href", doc.url); resultsListItem.appendChild(resultLink); var resultTitle = document.createElement("div"); resultTitle.classList.add("search-result-title"); resultLink.appendChild(resultTitle); var resultDoc = document.createElement("div"); resultDoc.classList.add("search-result-doc"); resultDoc.innerHTML = '<svg viewBox="0 0 24 24" class="search-result-icon"><use xlink:href="#svg-doc"></use></svg>'; resultTitle.appendChild(resultDoc); var resultDocTitle = document.createElement("div"); resultDocTitle.classList.add("search-result-doc-title"); resultDocTitle.innerHTML = doc.doc; resultDoc.appendChild(resultDocTitle); var resultDocOrSection = resultDocTitle; if (doc.doc != doc.title) { resultDoc.classList.add("search-result-doc-parent"); var resultSection = document.createElement("div"); resultSection.classList.add("search-result-section"); resultSection.innerHTML = doc.title; resultTitle.appendChild(resultSection); resultDocOrSection = resultSection; } var metadata = result.matchData.metadata; var titlePositions = []; var contentPositions = []; for (var j in metadata) { var meta = metadata[j]; if (meta.title) { var positions = meta.title.position; for (var k in positions) { titlePositions.push(positions[k]); } } if (meta.content) { var positions = meta.content.position; for (var k in positions) { var position = positions[k]; var previewStart = position[0]; var previewEnd = position[0] + position[1]; var ellipsesBefore = true; var ellipsesAfter = true; for (var k = 0; k < 5; k++) { var nextSpace = doc.content.lastIndexOf( " ", previewStart - 2 ); var nextDot = doc.content.lastIndexOf(". ", previewStart - 2); if (nextDot >= 0 && nextDot > nextSpace) { previewStart = nextDot + 1; ellipsesBefore = false; break; } if (nextSpace < 0) { previewStart = 0; ellipsesBefore = false; break; } previewStart = nextSpace + 1; } for (var k = 0; k < 10; k++) { var nextSpace = doc.content.indexOf(" ", previewEnd + 1); var nextDot = doc.content.indexOf(". ", previewEnd + 1); if (nextDot >= 0 && nextDot < nextSpace) { previewEnd = nextDot; ellipsesAfter = false; break; } if (nextSpace < 0) { previewEnd = doc.content.length; ellipsesAfter = false; break; } previewEnd = nextSpace; } contentPositions.push({ highlight: position, previewStart: previewStart, previewEnd: previewEnd, ellipsesBefore: ellipsesBefore, ellipsesAfter: ellipsesAfter, }); } } } if (titlePositions.length > 0) { titlePositions.sort(function (p1, p2) { return p1[0] - p2[0]; }); resultDocOrSection.innerHTML = ""; addHighlightedText( resultDocOrSection, doc.title, 0, doc.title.length, titlePositions ); } if (contentPositions.length > 0) { contentPositions.sort(function (p1, p2) { return p1.highlight[0] - p2.highlight[0]; }); var contentPosition = contentPositions[0]; var previewPosition = { highlight: [contentPosition.highlight], previewStart: contentPosition.previewStart, previewEnd: contentPosition.previewEnd, ellipsesBefore: contentPosition.ellipsesBefore, ellipsesAfter: contentPosition.ellipsesAfter, }; var previewPositions = [previewPosition]; for (var j = 1; j < contentPositions.length; j++) { contentPosition = contentPositions[j]; if (previewPosition.previewEnd < contentPosition.previewStart) { previewPosition = { highlight: [contentPosition.highlight], previewStart: contentPosition.previewStart, previewEnd: contentPosition.previewEnd, ellipsesBefore: contentPosition.ellipsesBefore, ellipsesAfter: contentPosition.ellipsesAfter, }; previewPositions.push(previewPosition); } else { previewPosition.highlight.push(contentPosition.highlight); previewPosition.previewEnd = contentPosition.previewEnd; previewPosition.ellipsesAfter = contentPosition.ellipsesAfter; } } var resultPreviews = document.createElement("div"); resultPreviews.classList.add("search-result-previews"); resultLink.appendChild(resultPreviews); var content = doc.content; for (var j = 0; j < Math.min(previewPositions.length, 3); j++) { var position = previewPositions[j]; var resultPreview = document.createElement("div"); resultPreview.classList.add("search-result-preview"); resultPreviews.appendChild(resultPreview); if (position.ellipsesBefore) { resultPreview.appendChild(document.createTextNode("... ")); } addHighlightedText( resultPreview, content, position.previewStart, position.previewEnd, position.highlight ); if (position.ellipsesAfter) { resultPreview.appendChild(document.createTextNode(" ...")); } } } var resultRelUrl = document.createElement("span"); resultRelUrl.classList.add("search-result-rel-url"); resultRelUrl.innerText = doc.relUrl; resultTitle.appendChild(resultRelUrl); } function addHighlightedText(parent, text, start, end, positions) { var index = start; for (var i in positions) { var position = positions[i]; var span = document.createElement("span"); span.innerHTML = text.substring(index, position[0]); parent.appendChild(span); index = position[0] + position[1]; var highlight = document.createElement("span"); highlight.classList.add("search-result-highlight"); highlight.innerHTML = text.substring(position[0], index); parent.appendChild(highlight); } var span = document.createElement("span"); span.innerHTML = text.substring(index, end); parent.appendChild(span); } } jtd.addEvent(searchInput, "focus", function () { setTimeout(update, 0); }); jtd.addEvent(searchInput, "keyup", function (e) { switch (e.keyCode) { case 27: searchInput.value = ""; break; case 38: case 40: case 13: e.preventDefault(); return; } update(); }); jtd.addEvent(searchInput, "keydown", function (e) { switch (e.keyCode) { case 38: e.preventDefault(); var active = document.querySelector(".search-result.active"); if (active) { active.classList.remove("active"); if (active.parentElement.previousSibling) { var previous = active.parentElement.previousSibling.querySelector( ".search-result" ); previous.classList.add("active"); } } return; case 40: e.preventDefault(); var active = document.querySelector(".search-result.active"); if (active) { if (active.parentElement.nextSibling) { var next = active.parentElement.nextSibling.querySelector( ".search-result" ); active.classList.remove("active"); next.classList.add("active"); } } else { var next = document.querySelector(".search-result"); if (next) { next.classList.add("active"); } } return; case 13: e.preventDefault(); var active = document.querySelector(".search-result.active"); if (active) { active.click(); } else { var first = document.querySelector(".search-result"); if (first) { first.click(); } } return; } }); jtd.addEvent(document, "click", function (e) { if (e.target != searchInput) { hideSearch(); } }); } jtd.getTheme = function () { var cssFileHref = document .querySelector('[rel="stylesheet"]') .getAttribute("href"); return cssFileHref.substring( cssFileHref.lastIndexOf("-") + 1, cssFileHref.length - 4 ); }; jtd.setTheme = function (theme) { var cssFile = document.querySelector('[rel="stylesheet"]'); cssFile.setAttribute( "href", "/assets/css/just-the-docs-" + theme + ".css" ); }; function navLink() { var pathname = document.location.pathname; var navLink = document .getElementById("site-nav") .querySelector('a[href="' + pathname + '"]'); if (navLink) { return navLink; } if (pathname.endsWith("/") && pathname != "/") { pathname = pathname.slice(0, -1); } if (pathname != "/") { navLink = document .getElementById("site-nav") .querySelector( 'a[href="' + pathname + '"], a[href="' + pathname + '/"], a[href="' + pathname + '.html"]' ); if (navLink) { return navLink; } } return null; } function scrollNav() { const targetLink = navLink(); if (targetLink) { targetLink.scrollIntoView({ block: "center" }); targetLink.removeAttribute("href"); } } function activateNav() { var target = navLink(); if (target) { target.classList.toggle("active", true); } while (target) { while ( target && !(target.classList && target.classList.contains("nav-list-item")) ) { target = target.parentNode; } if (target) { target.classList.toggle("active", true); target = target.parentNode; } } } jtd.onReady(function () { if (document.getElementById("site-nav")) { initNav(); activateNav(); scrollNav(); } initSearch(); }); jtd.onReady(function () { if (!window.isSecureContext) { console.log( "Window does not have a secure context, therefore code clipboard copy functionality will not be available. For more details see https://web.dev/async-clipboard/#security-and-permissions" ); return; } var codeBlocks = document.querySelectorAll( "div.highlighter-rouge, div.listingblock > div.content, figure.highlight" ); var svgCopied = '<svg viewBox="0 0 24 24" class="copy-icon"><use xlink:href="#svg-copied"></use></svg>'; var svgCopy = '<svg viewBox="0 0 24 24" class="copy-icon"><use xlink:href="#svg-copy"></use></svg>'; codeBlocks.forEach((codeBlock) => { var copyButton = document.createElement("button"); var timeout = null; copyButton.type = "button"; copyButton.ariaLabel = "Copy code to clipboard"; copyButton.innerHTML = svgCopy; codeBlock.append(copyButton); copyButton.addEventListener("click", function () { if (timeout === null) { var code = ( codeBlock.querySelector("pre:not(.lineno, .highlight)") || codeBlock.querySelector("code") ).innerText; window.navigator.clipboard.writeText(code); copyButton.innerHTML = svgCopied; var timeoutSetting = 4000; timeout = setTimeout(function () { copyButton.innerHTML = svgCopy; timeout = null; }, timeoutSetting); } }); }); }); })((window.jtd = window.jtd || {})); window.MathJax = { tex: { inlineMath: [ ["$", "$"], ["\\(", "\\)"], ], displayMath: [ ["$$", "$$"], ["\\[", "\\]"], ], }, }; </script> <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> Audio Localization </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="index.html" class="nav-list-link">0. Homepage</a></li><li class="nav-list-item"><a href="1-introduction.html" class="nav-list-link">1. Introduction</a></li><li class="nav-list-item"><a href="2-high-level-design.html" class="nav-list-link">2. High Level Design</a></li><li class="nav-list-item"><a href="3-design.html" class="nav-list-link">3. Program & Hardware Design</a></li><li class="nav-list-item"><a href="4-things-that-did-not-work.html" class="nav-list-link">4. Things Tried That Didn’t Work</a></li><li class="nav-list-item"><a href="5-results.html" class="nav-list-link">5. Testing and Results of the Design</a></li><li class="nav-list-item"><a href="6-conclusion.html" class="nav-list-link">6. Conclusion</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Audio Localization" aria-label="Search Audio Localization" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div class="main-content-wrap"> <div id="main-content" class="main-content"> <main> <h1 id="2-high-level-design"> <a href="#2-high-level-design" class="anchor-heading" aria-labelledby="2-high-level-design"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. High-Level Design </h1> <h2 id="21-rationale--inspiration"> <a href="#21-rationale--inspiration" class="anchor-heading" aria-labelledby="21-rationale--inspiration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2.1 Rationale &amp; Inspiration </h2> <p>Audio localization typically depends on specialized DSP hardware or simplified methods that only work with sharp transients. This often makes such projects out of reach for hobbyists and also results in expensive systems.</p> <p>By leveraging the Raspberry Pi Pico’s ADC along with the RP2040’s fast processors, we determined it was possible to implement a more sophisticated localization technique entirely on-chip.</p> <p>We decided to implement a time-difference-of-arrival (TDOA) method to determine sound location. To compute the time difference between microphones, we use cross-correlations to estimate the likelihood of various sample shifts.</p> <h2 id="22-background-math"> <a href="#22-background-math" class="anchor-heading" aria-labelledby="22-background-math"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2.2 Background Math </h2> <p>At standard temperature and pressure, the speed of sound is approximately ($343\,\mathrm{m/s}$). This means that for every additional centimeter between microphones, the maximum travel time is:</p> \[\frac{\text{distance}}{\text{velocity}} = \frac{0.01\,\mathrm{m}}{343\,\mathrm{m/s}} \approx 29.15\,\mu\mathrm{s}\] <p><img src="./assets/images/sample_rate_resolution_char.gif" alt="Resolution gif" class="float-right" /></p> <p>Due to discrete sampling, time-difference estimates are quantized by the ADC sample period and microphone spacing.</p> <p>The Desmos visualization demonstrates our system’s theoretical resolution as a function of sampling rate. The gif displays resolution for rates from $0$ to $50\,\mathrm{kHz}$ at $2\,\mathrm{kHz}$ intervals. Each curve intersection represents a uniquely identifiable sound location, creating a discrete positional grid. White regions within the triangular array map to their nearest intersection point, showing the practical resolution limits at different sampling frequencies.</p> <p>For example, sampling at ($100\,\mathrm{kHz}$) ($10\,\mu\mathrm{s}$ per sample) with an equilateral microphone triangle of ($10\,\mathrm{cm}$) sides yields a maximum shift of about $\pm 30$ samples. Each pair of microphones then produces an integer shift in $\left[-30, +30\right]$ indicating their relative time difference.</p> <p>With three microphones, there are roughly $61^3$ distinct shift combinations. Increasing the ADC rate or spacing the microphones farther apart increases resolution by allowing more distinct shifts.</p> <h3 id="cross-correlation"> <a href="#cross-correlation" class="anchor-heading" aria-labelledby="cross-correlation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Cross Correlation </h3> <p>The cross correlation calculation makes up the core of our algorithm. Cross‑correlation is a sliding inner‑product that quantifies the similarity between two signals as one is shifted in time. The cross correlation operation is defined as</p> \[R_{xy}[k] \;=\;\sum_{n=-\infty}^{\infty} x[n]\,y[n + k]\] <p>In our case, the cross correlation peaks at a point k which represents the point at which the signals overlap the most. This k effectively gives you the time difference of arrival between 2 microphones.</p> <h3 id="fft-based-approaches"> <a href="#fft-based-approaches" class="anchor-heading" aria-labelledby="fft-based-approaches"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> FFT Based-Approaches </h3> <p>To efficiently calculate the Time Difference of Arrival (TDOA) between two microphone signals, $x[n]$ and $y[n]$, using an FFT-based approach, the following steps are typically performed:</p> <ol> <li><strong>Compute Discrete Fourier Transforms (DFTs):</strong> The DFTs of the windowed signal frames are calculated.</li> <li><strong>Form the (Weighted) Cross-Power Spectrum:</strong> The cross-power spectrum \(P_{xy}(\omega) = X(\omega) Y^*(\omega)\) is computed, where $Y^*(\omega)$ is the complex conjugate of $Y(\omega)$. For improved robustness, especially in noisy or reverberant conditions, a weighting function is applied.</li> <li><strong>Compute Inverse DFT (IDFT):</strong> The cross-correlation sequence $r_{xy}[k]$ in the time lag domain is obtained by taking the IDFT of $P_{xy}(\omega)$: This sequence represents the correlation between the two signals for various time lags $k$.</li> <li><strong>Identify Peak Lag:</strong> The lag $k_{\text{max}}$ at which the cross-correlation sequence $r_{xy}[k]$ reaches its maximum value corresponds to the estimated time delay in samples: \(k_{\text{max}} = \underset{k}{\text{argmax}} \{r_{xy}[k]\}\)</li> </ol> <p>The FFT approach leverages the convolution theorem, which states that convolution in the time domain equals multiplication in the frequency domain:</p> \[x[n] * y[n] \Leftrightarrow X(f) \cdot Y(f)\] <p>This property transforms the computationally expensive $O(N^2)$ cross-correlation operation into an $O(N\log N)$ process. However, for our buffer size of $N=1024$, this theoretical advantage provided minimal practical speedup. More importantly, the FFT approach introduced additional complications: increased sensitivity to phase shifts from our filters and vulnerability to non-equivalent sampling times between our three microphones. One of the innovations of our project is to remove the need for the calculation of the FFT prior to taking the cross-correlation. So while these approaches operate in the frequency domain, we operate on the sampled microphone power level readings.</p> <p><img src="./assets/images/hyperbola_density_based_on_distance.gif" alt="Resolution gif" class="float-right" /></p> <h3 id="tdoa-conversion-to-position"> <a href="#tdoa-conversion-to-position" class="anchor-heading" aria-labelledby="tdoa-conversion-to-position"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> TDOA Conversion to Position </h3> <p>In our implementation, we actually perform the inverse operation: converting possible positions to expected TDOA values. For each point in the VGA display space, we calculate what the theoretical time delay would be between each microphone pair if a sound originated from that position.</p> \[c \cdot \tau_{\text{delay}} = d_2 - d_1\] <p>where $c$ is the speed of sound, and $d_1, d_2$ are the distances from the potential source position to microphones 1 and 2, respectively.</p> <p>We do this calulation for 3 times (once for each microphone). Since our time delays are quantized by the sampling rate, only specific TDOA values are possible. These values create a grid of hyperbolas for each microphone pair, and only at the intersections of these hyperbolas can we uniquely identify a sound source. As shown in the animation, most points in space do not map to valid sample-shift combinations, so we map each position to its nearest hyperbola intersection.</p> <p>The visualization demonstrates how microphone spacing affects resolution. While we’ve scaled down the sampling rate in the animation for clarity, it illustrates a key principle: increasing the distance between microphones creates more hyperbolas within the same area, leading to more distinct intersection points. This effectively increases our system’s spatial resolution without requiring a higher sampling rate.</p><hr /> <h2 id="23-logical-structure"> <a href="#23-logical-structure" class="anchor-heading" aria-labelledby="23-logical-structure"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2.3 Logical Structure </h2> <p><img src="./assets/images/control_flow_diagram.jpg" alt="Control Flow" class="float-right" /></p> <p>The software pipeline on a single RP2040 core follows:</p> <ol> <li> <p><strong>DMA-driven sampling</strong><br /> Configure the ADC in round-robin mode for three channels and set up a ping-pong DMA to fill a three-byte <code class="language-plaintext highlighter-rouge">dma_sample_array</code>.</p> </li> <li> <p><strong>Rolling buffers</strong><br /> The <code class="language-plaintext highlighter-rouge">sample_and_compute_loop()</code> function reads the DMA array at ($50\,\mathrm{kHz}$), converts each $8$-bit sample to signed $16$-bit, and pushes them into three rolling buffers via <code class="language-plaintext highlighter-rouge">rolling_buffer_push()</code>.</p> </li> <li> <p><strong>Event detection</strong><br /> Once buffers are full, outgoing and incoming windowed power are compared. Crossing the threshold triggers processing.</p> </li> <li> <p><strong>Cross-correlation</strong><br /> Each buffer is flattened into a DC-centered frame and optionally windowed. <code class="language-plaintext highlighter-rouge">correlations_init()</code> scores integer sample shifts over the physically possible range.</p> </li> <li> <p><strong>Best-shift computation</strong><br /> The shift with the highest correlation score for each microphone pair is selected; <code class="language-plaintext highlighter-rouge">correlations_average()</code> exponentially smooths these over time.</p> </li> <li> <p><strong>VGA rendering</strong><br /> If any shift is nonzero, <code class="language-plaintext highlighter-rouge">vga_draw()</code> renders the full heatmap and waveforms. Otherwise, <code class="language-plaintext highlighter-rouge">vga_draw_lite()</code> updates only the latest curves and markers.</p> </li> </ol> <h2 id="24-hardwaresoftware-trade-offs"> <a href="#24-hardwaresoftware-trade-offs" class="anchor-heading" aria-labelledby="24-hardwaresoftware-trade-offs"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2.4 Hardware/Software Trade-Offs </h2> <p>Achieving ($50\,\mathrm{kHz}$) sampling across three ADC channels on a Pico with ($264\,\mathrm{KB}$) SRAM and ($133\,\mathrm{MHz}$) cores required careful balancing:</p> <ul> <li><strong>DMA offload:</strong> The DMA ensures jitter-free ($50\,\mathrm{kHz}$) sampling without CPU interrupts.</li> <li><strong>Buffer size vs. compute time:</strong> We experimented with buffer lengths up to $2048$ samples but settled on $1024$ to balance noise reduction and CPU load.</li> <li><strong>Display overhead:</strong> Full heatmap draws are only on loud events; <code class="language-plaintext highlighter-rouge">vga_draw_lite()</code> handles most frames to stay within sampling deadlines.</li> </ul> <h2 id="25-intellectual-property-landscape"> <a href="#25-intellectual-property-landscape" class="anchor-heading" aria-labelledby="25-intellectual-property-landscape"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2.5 Intellectual Property Landscape </h2> <p>Time-difference-of-arrival localization with cross-correlation is a long-standing, public-domain DSP technique. While specific microphone array patents exist, our breadboard layout and algorithms are original or derived from public-domain sources.</p> </main> <hr> <footer> <p><a href="#top" id="back-to-top">Back to top</a></p> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
