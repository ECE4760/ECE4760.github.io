<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav ul li a { background-image: none; } </style> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Program &amp; Hardware Design | Audio Localization</title> <meta name="generator" content="Jekyll v4.4.1" /> <meta property="og:title" content="Program &amp; Hardware Design" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="A device that listens with 3 microphones, using cross-correlation to instantly point you towards a sound’s origin." /> <meta property="og:description" content="A device that listens with 3 microphones, using cross-correlation to instantly point you towards a sound’s origin." /> <link rel="canonical" href="/3-design.html" /> <meta property="og:url" content="/3-design.html" /> <meta property="og:site_name" content="Audio Localization" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Program &amp; Hardware Design" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"A device that listens with 3 microphones, using cross-correlation to instantly point you towards a sound’s origin.","headline":"Program &amp; Hardware Design","url":"/3-design.html"}</script> <!-- End Jekyll SEO tag --> <base href="./" /> <link rel="stylesheet" href="assets/css/custom.css" /> <link rel="stylesheet" href="assets/css/just-the-docs-default.css" /> <script> (function (jtd, undefined) { jtd.addEvent = function (el, type, handler) { if (el.attachEvent) el.attachEvent("on" + type, handler); else el.addEventListener(type, handler); }; jtd.removeEvent = function (el, type, handler) { if (el.detachEvent) el.detachEvent("on" + type, handler); else el.removeEventListener(type, handler); }; jtd.onReady = function (ready) { if (document.readyState != "loading") ready(); else if (document.addEventListener) document.addEventListener("DOMContentLoaded", ready); else document.attachEvent("onreadystatechange", function () { if (document.readyState == "complete") ready(); }); }; function initNav() { jtd.addEvent(document, "click", function (e) { var target = e.target; while ( target && !(target.classList && target.classList.contains("nav-list-expander")) ) { target = target.parentNode; } if (target) { e.preventDefault(); target.ariaPressed = target.parentNode.classList.toggle("active"); } }); const siteNav = document.getElementById("site-nav"); const mainHeader = document.getElementById("main-header"); const menuButton = document.getElementById("menu-button"); disableHeadStyleSheets(); jtd.addEvent(menuButton, "click", function (e) { e.preventDefault(); if (menuButton.classList.toggle("nav-open")) { siteNav.classList.add("nav-open"); mainHeader.classList.add("nav-open"); menuButton.ariaPressed = true; } else { siteNav.classList.remove("nav-open"); mainHeader.classList.remove("nav-open"); menuButton.ariaPressed = false; } }); } function disableHeadStyleSheets() { const headNav = document.getElementById("jtd-head-nav-stylesheet"); if (headNav) { headNav.disabled = true; } const activation = document.getElementById("jtd-nav-activation"); if (activation) { activation.disabled = true; } } function initSearch() { var request = new XMLHttpRequest(); request.open("GET", "/assets/js/search-data.json", true); request.onload = function () { if (request.status >= 200 && request.status < 400) { var docs = JSON.parse(request.responseText); lunr.tokenizer.separator = /[\s\-/]+/; var index = lunr(function () { this.ref("id"); this.field("title", { boost: 200 }); this.field("content", { boost: 2 }); this.field("relUrl"); this.metadataWhitelist = ["position"]; for (var i in docs) { this.add({ id: i, title: docs[i].title, content: docs[i].content, relUrl: docs[i].relUrl, }); } }); searchLoaded(index, docs); } else { console.log( "Error loading ajax request. Request status:" + request.status ); } }; request.onerror = function () { console.log("There was a connection error"); }; request.send(); } function searchLoaded(index, docs) { var index = index; var docs = docs; var searchInput = document.getElementById("search-input"); var searchResults = document.getElementById("search-results"); var mainHeader = document.getElementById("main-header"); var currentInput; var currentSearchIndex = 0; function showSearch() { document.documentElement.classList.add("search-active"); } function hideSearch() { document.documentElement.classList.remove("search-active"); } function update() { currentSearchIndex++; var input = searchInput.value; if (input === "") { hideSearch(); } else { showSearch(); window.scroll(0, -1); setTimeout(function () { window.scroll(0, 0); }, 0); } if (input === currentInput) { return; } currentInput = input; searchResults.innerHTML = ""; if (input === "") { return; } var results = index.query(function (query) { var tokens = lunr.tokenizer(input); query.term(tokens, { boost: 10, }); query.term(tokens, { wildcard: lunr.Query.wildcard.TRAILING, }); }); if (results.length == 0 && input.length > 2) { var tokens = lunr.tokenizer(input).filter(function (token, i) { return token.str.length < 20; }); if (tokens.length > 0) { results = index.query(function (query) { query.term(tokens, { editDistance: Math.round(Math.sqrt(input.length / 2 - 1)), }); }); } } if (results.length == 0) { var noResultsDiv = document.createElement("div"); noResultsDiv.classList.add("search-no-result"); noResultsDiv.innerText = "No results found"; searchResults.appendChild(noResultsDiv); } else { var resultsList = document.createElement("ul"); resultsList.classList.add("search-results-list"); searchResults.appendChild(resultsList); addResults(resultsList, results, 0, 10, 100, currentSearchIndex); } function addResults( resultsList, results, start, batchSize, batchMillis, searchIndex ) { if (searchIndex != currentSearchIndex) { return; } for (var i = start; i < start + batchSize; i++) { if (i == results.length) { return; } addResult(resultsList, results[i]); } setTimeout(function () { addResults( resultsList, results, start + batchSize, batchSize, batchMillis, searchIndex ); }, batchMillis); } function addResult(resultsList, result) { var doc = docs[result.ref]; var resultsListItem = document.createElement("li"); resultsListItem.classList.add("search-results-list-item"); resultsList.appendChild(resultsListItem); var resultLink = document.createElement("a"); resultLink.classList.add("search-result"); resultLink.setAttribute("href", doc.url); resultsListItem.appendChild(resultLink); var resultTitle = document.createElement("div"); resultTitle.classList.add("search-result-title"); resultLink.appendChild(resultTitle); var resultDoc = document.createElement("div"); resultDoc.classList.add("search-result-doc"); resultDoc.innerHTML = '<svg viewBox="0 0 24 24" class="search-result-icon"><use xlink:href="#svg-doc"></use></svg>'; resultTitle.appendChild(resultDoc); var resultDocTitle = document.createElement("div"); resultDocTitle.classList.add("search-result-doc-title"); resultDocTitle.innerHTML = doc.doc; resultDoc.appendChild(resultDocTitle); var resultDocOrSection = resultDocTitle; if (doc.doc != doc.title) { resultDoc.classList.add("search-result-doc-parent"); var resultSection = document.createElement("div"); resultSection.classList.add("search-result-section"); resultSection.innerHTML = doc.title; resultTitle.appendChild(resultSection); resultDocOrSection = resultSection; } var metadata = result.matchData.metadata; var titlePositions = []; var contentPositions = []; for (var j in metadata) { var meta = metadata[j]; if (meta.title) { var positions = meta.title.position; for (var k in positions) { titlePositions.push(positions[k]); } } if (meta.content) { var positions = meta.content.position; for (var k in positions) { var position = positions[k]; var previewStart = position[0]; var previewEnd = position[0] + position[1]; var ellipsesBefore = true; var ellipsesAfter = true; for (var k = 0; k < 5; k++) { var nextSpace = doc.content.lastIndexOf( " ", previewStart - 2 ); var nextDot = doc.content.lastIndexOf(". ", previewStart - 2); if (nextDot >= 0 && nextDot > nextSpace) { previewStart = nextDot + 1; ellipsesBefore = false; break; } if (nextSpace < 0) { previewStart = 0; ellipsesBefore = false; break; } previewStart = nextSpace + 1; } for (var k = 0; k < 10; k++) { var nextSpace = doc.content.indexOf(" ", previewEnd + 1); var nextDot = doc.content.indexOf(". ", previewEnd + 1); if (nextDot >= 0 && nextDot < nextSpace) { previewEnd = nextDot; ellipsesAfter = false; break; } if (nextSpace < 0) { previewEnd = doc.content.length; ellipsesAfter = false; break; } previewEnd = nextSpace; } contentPositions.push({ highlight: position, previewStart: previewStart, previewEnd: previewEnd, ellipsesBefore: ellipsesBefore, ellipsesAfter: ellipsesAfter, }); } } } if (titlePositions.length > 0) { titlePositions.sort(function (p1, p2) { return p1[0] - p2[0]; }); resultDocOrSection.innerHTML = ""; addHighlightedText( resultDocOrSection, doc.title, 0, doc.title.length, titlePositions ); } if (contentPositions.length > 0) { contentPositions.sort(function (p1, p2) { return p1.highlight[0] - p2.highlight[0]; }); var contentPosition = contentPositions[0]; var previewPosition = { highlight: [contentPosition.highlight], previewStart: contentPosition.previewStart, previewEnd: contentPosition.previewEnd, ellipsesBefore: contentPosition.ellipsesBefore, ellipsesAfter: contentPosition.ellipsesAfter, }; var previewPositions = [previewPosition]; for (var j = 1; j < contentPositions.length; j++) { contentPosition = contentPositions[j]; if (previewPosition.previewEnd < contentPosition.previewStart) { previewPosition = { highlight: [contentPosition.highlight], previewStart: contentPosition.previewStart, previewEnd: contentPosition.previewEnd, ellipsesBefore: contentPosition.ellipsesBefore, ellipsesAfter: contentPosition.ellipsesAfter, }; previewPositions.push(previewPosition); } else { previewPosition.highlight.push(contentPosition.highlight); previewPosition.previewEnd = contentPosition.previewEnd; previewPosition.ellipsesAfter = contentPosition.ellipsesAfter; } } var resultPreviews = document.createElement("div"); resultPreviews.classList.add("search-result-previews"); resultLink.appendChild(resultPreviews); var content = doc.content; for (var j = 0; j < Math.min(previewPositions.length, 3); j++) { var position = previewPositions[j]; var resultPreview = document.createElement("div"); resultPreview.classList.add("search-result-preview"); resultPreviews.appendChild(resultPreview); if (position.ellipsesBefore) { resultPreview.appendChild(document.createTextNode("... ")); } addHighlightedText( resultPreview, content, position.previewStart, position.previewEnd, position.highlight ); if (position.ellipsesAfter) { resultPreview.appendChild(document.createTextNode(" ...")); } } } var resultRelUrl = document.createElement("span"); resultRelUrl.classList.add("search-result-rel-url"); resultRelUrl.innerText = doc.relUrl; resultTitle.appendChild(resultRelUrl); } function addHighlightedText(parent, text, start, end, positions) { var index = start; for (var i in positions) { var position = positions[i]; var span = document.createElement("span"); span.innerHTML = text.substring(index, position[0]); parent.appendChild(span); index = position[0] + position[1]; var highlight = document.createElement("span"); highlight.classList.add("search-result-highlight"); highlight.innerHTML = text.substring(position[0], index); parent.appendChild(highlight); } var span = document.createElement("span"); span.innerHTML = text.substring(index, end); parent.appendChild(span); } } jtd.addEvent(searchInput, "focus", function () { setTimeout(update, 0); }); jtd.addEvent(searchInput, "keyup", function (e) { switch (e.keyCode) { case 27: searchInput.value = ""; break; case 38: case 40: case 13: e.preventDefault(); return; } update(); }); jtd.addEvent(searchInput, "keydown", function (e) { switch (e.keyCode) { case 38: e.preventDefault(); var active = document.querySelector(".search-result.active"); if (active) { active.classList.remove("active"); if (active.parentElement.previousSibling) { var previous = active.parentElement.previousSibling.querySelector( ".search-result" ); previous.classList.add("active"); } } return; case 40: e.preventDefault(); var active = document.querySelector(".search-result.active"); if (active) { if (active.parentElement.nextSibling) { var next = active.parentElement.nextSibling.querySelector( ".search-result" ); active.classList.remove("active"); next.classList.add("active"); } } else { var next = document.querySelector(".search-result"); if (next) { next.classList.add("active"); } } return; case 13: e.preventDefault(); var active = document.querySelector(".search-result.active"); if (active) { active.click(); } else { var first = document.querySelector(".search-result"); if (first) { first.click(); } } return; } }); jtd.addEvent(document, "click", function (e) { if (e.target != searchInput) { hideSearch(); } }); } jtd.getTheme = function () { var cssFileHref = document .querySelector('[rel="stylesheet"]') .getAttribute("href"); return cssFileHref.substring( cssFileHref.lastIndexOf("-") + 1, cssFileHref.length - 4 ); }; jtd.setTheme = function (theme) { var cssFile = document.querySelector('[rel="stylesheet"]'); cssFile.setAttribute( "href", "/assets/css/just-the-docs-" + theme + ".css" ); }; function navLink() { var pathname = document.location.pathname; var navLink = document .getElementById("site-nav") .querySelector('a[href="' + pathname + '"]'); if (navLink) { return navLink; } if (pathname.endsWith("/") && pathname != "/") { pathname = pathname.slice(0, -1); } if (pathname != "/") { navLink = document .getElementById("site-nav") .querySelector( 'a[href="' + pathname + '"], a[href="' + pathname + '/"], a[href="' + pathname + '.html"]' ); if (navLink) { return navLink; } } return null; } function scrollNav() { const targetLink = navLink(); if (targetLink) { targetLink.scrollIntoView({ block: "center" }); targetLink.removeAttribute("href"); } } function activateNav() { var target = navLink(); if (target) { target.classList.toggle("active", true); } while (target) { while ( target && !(target.classList && target.classList.contains("nav-list-item")) ) { target = target.parentNode; } if (target) { target.classList.toggle("active", true); target = target.parentNode; } } } jtd.onReady(function () { if (document.getElementById("site-nav")) { initNav(); activateNav(); scrollNav(); } initSearch(); }); jtd.onReady(function () { if (!window.isSecureContext) { console.log( "Window does not have a secure context, therefore code clipboard copy functionality will not be available. For more details see https://web.dev/async-clipboard/#security-and-permissions" ); return; } var codeBlocks = document.querySelectorAll( "div.highlighter-rouge, div.listingblock > div.content, figure.highlight" ); var svgCopied = '<svg viewBox="0 0 24 24" class="copy-icon"><use xlink:href="#svg-copied"></use></svg>'; var svgCopy = '<svg viewBox="0 0 24 24" class="copy-icon"><use xlink:href="#svg-copy"></use></svg>'; codeBlocks.forEach((codeBlock) => { var copyButton = document.createElement("button"); var timeout = null; copyButton.type = "button"; copyButton.ariaLabel = "Copy code to clipboard"; copyButton.innerHTML = svgCopy; codeBlock.append(copyButton); copyButton.addEventListener("click", function () { if (timeout === null) { var code = ( codeBlock.querySelector("pre:not(.lineno, .highlight)") || codeBlock.querySelector("code") ).innerText; window.navigator.clipboard.writeText(code); copyButton.innerHTML = svgCopied; var timeoutSetting = 4000; timeout = setTimeout(function () { copyButton.innerHTML = svgCopy; timeout = null; }, timeoutSetting); } }); }); }); })((window.jtd = window.jtd || {})); window.MathJax = { tex: { inlineMath: [ ["$", "$"], ["\\(", "\\)"], ], displayMath: [ ["$$", "$$"], ["\\[", "\\]"], ], }, }; </script> <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> Audio Localization </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="index.html" class="nav-list-link">0. Homepage</a></li><li class="nav-list-item"><a href="1-introduction.html" class="nav-list-link">1. Introduction</a></li><li class="nav-list-item"><a href="2-high-level-design.html" class="nav-list-link">2. High Level Design</a></li><li class="nav-list-item"><a href="3-design.html" class="nav-list-link">3. Program & Hardware Design</a></li><li class="nav-list-item"><a href="4-things-that-did-not-work.html" class="nav-list-link">4. Things Tried That Didn’t Work</a></li><li class="nav-list-item"><a href="5-results.html" class="nav-list-link">5. Testing and Results of the Design</a></li><li class="nav-list-item"><a href="6-conclusion.html" class="nav-list-link">6. Conclusion</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Audio Localization" aria-label="Search Audio Localization" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div class="main-content-wrap"> <div id="main-content" class="main-content"> <main> <h1 id="3-program--hardware-design"> <a href="#3-program--hardware-design" class="anchor-heading" aria-labelledby="3-program--hardware-design"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. Program &amp; Hardware Design </h1> <h2 id="31-hardware-design"> <a href="#31-hardware-design" class="anchor-heading" aria-labelledby="31-hardware-design"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.1 Hardware Design </h2> <p><img src="./assets/images/final_board.png" alt="Hardware Design" class="bordered" /></p> <p>We used three MAX4466 microphones at the corners of a breadboard forming a right triangle. Each mic’s output passes through a second-order ($20\,\mathrm{kHz}$) low-pass filter to remove ultrasonic noise.</p> <p>The filtered outputs connect to the Pico’s ADC channels <code class="language-plaintext highlighter-rouge">0</code>, <code class="language-plaintext highlighter-rouge">1</code>, and <code class="language-plaintext highlighter-rouge">2</code>. We minimized wiring length to reduce interference.</p> <p>The provided VGA driver uses three PIO state machines and DMA:</p> <ul> <li><strong>HSYNC PIO:</strong> Generates horizontal sync, front/back porches.</li> <li><strong>VSYNC PIO:</strong> Counts lines via HSYNC interrupts and manages vertical timing.</li> <li><strong>RGB PIO:</strong> Streams pixel data from a DMA-fed global pixel array (($3$ bits per pixel)).</li> </ul> <p>A ($330\,\Omega$) resistor in series (with the Pico’s internal ($70\,\Omega$)) forms a divider to step the Pico’s ($3.3\,\mathrm{V}$) GPIO down to ($0$-$0.7\,\mathrm{V}$) safe for VGA inputs.</p> <h2 id="32-core-software-loop"> <a href="#32-core-software-loop" class="anchor-heading" aria-labelledby="32-core-software-loop"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.2 Core Software Loop </h2> <p>The heart of the system resides in the <code class="language-plaintext highlighter-rouge">sample_and_compute_loop()</code> function within <code class="language-plaintext highlighter-rouge">sample_compute.c</code>, which orchestrates audio capture, processing, and visualization. Upon startup, <code class="language-plaintext highlighter-rouge">vga_init()</code> prepares the display subsystem.</p> <p>The loop initializes three rolling buffers-one per microphone-and records time for pacing. In the inner sampling loop, the code:</p> <ol> <li>Reads $8$-bit ADC values from <code class="language-plaintext highlighter-rouge">dma_sample_array</code> for channels A, B, and C.</li> <li>Converts them to signed $16$-bit samples.</li> <li>Pushes them into the respective circular buffers with <code class="language-plaintext highlighter-rouge">rolling_buffer_push()</code>.</li> </ol> <p>Once each buffer is full, outgoing and incoming power are computed. If the “outgoing” energy (older half of each buffer) exceeds twice the “incoming” energy (newer half), an acoustic event is detected and processing begins.</p> <p>Each rolling buffer is then flattened into a DC-offset-normalized frame via <code class="language-plaintext highlighter-rouge">rolling_buffer_write_out()</code>. Pairwise cross-correlations (<code class="language-plaintext highlighter-rouge">correlations_init()</code>) determine sample-shift estimates. If any shift is nonzero, <code class="language-plaintext highlighter-rouge">correlations_average()</code> updates long-term averages, and <code class="language-plaintext highlighter-rouge">vga_draw()</code> runs; otherwise, <code class="language-plaintext highlighter-rouge">vga_draw_lite()</code> updates only waveforms and shift markers.</p> <h2 id="33-rolling-buffer-algorithm"> <a href="#33-rolling-buffer-algorithm" class="anchor-heading" aria-labelledby="33-rolling-buffer-algorithm"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.3 Rolling Buffer Algorithm </h2> <p>Circular buffering of the microphone streams is implemented in <code class="language-plaintext highlighter-rouge">rolling_buffer.c</code> using a fixed-size array of <code class="language-plaintext highlighter-rouge">BUFFER_SIZE</code> samples. Each call to <code class="language-plaintext highlighter-rouge">rolling_buffer_push()</code>:</p> <ol> <li>Computes indices for the “outgoing” sample (current head) and the midpoint sample (head minus half the buffer, wrapped).</li> <li>Updates four accumulators: <code class="language-plaintext highlighter-rouge">outgoing_total</code>, <code class="language-plaintext highlighter-rouge">outgoing_power</code>, <code class="language-plaintext highlighter-rouge">incoming_total</code>, and <code class="language-plaintext highlighter-rouge">incoming_power</code>.</li> <li>Uses the <code class="language-plaintext highlighter-rouge">SAMPLE_POWER(sample)</code> macro for power tracking.</li> <li>Overwrites the oldest sample, increments the head (wrapping at <code class="language-plaintext highlighter-rouge">BUFFER_SIZE</code>), and sets <code class="language-plaintext highlighter-rouge">is_full</code> after the first wrap.</li> </ol> <p>When processing, <code class="language-plaintext highlighter-rouge">rolling_buffer_write_out()</code> copies samples into a contiguous <code class="language-plaintext highlighter-rouge">buffer_t</code>, subtracts the average (<code class="language-plaintext highlighter-rouge">dst_offset</code>), and computes total power for correlation normalization.</p> <h2 id="34-cross-correlation-module"> <a href="#34-cross-correlation-module" class="anchor-heading" aria-labelledby="34-cross-correlation-module"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.4 Cross-Correlation Module </h2> <p>The cross-correlation engine in <code class="language-plaintext highlighter-rouge">correlations.c</code> provides both instantaneous and smoothed time-delay estimates.</p> <ul> <li> <p><strong><code class="language-plaintext highlighter-rouge">correlations_init()</code>:</strong><br /> For each integer shift <code class="language-plaintext highlighter-rouge">s</code> in [-<code class="language-plaintext highlighter-rouge">MAX_SHIFT_SAMPLES</code>, +<code class="language-plaintext highlighter-rouge">MAX_SHIFT_SAMPLES</code>], it computes the dot-product of two sample buffers offset by <code class="language-plaintext highlighter-rouge">s</code> and stores the 64-bit sum in <code class="language-plaintext highlighter-rouge">corr-&gt;correlations[s + MAX_SHIFT_SAMPLES]</code>. The <code class="language-plaintext highlighter-rouge">best_shift</code> is set to the highest-scoring <code class="language-plaintext highlighter-rouge">s</code>.</p> </li> <li> <p><strong><code class="language-plaintext highlighter-rouge">correlations_average()</code>:</strong><br /> Applies an exponential decay filter based on elapsed time, blends new correlation values into a long-term array, and recomputes <code class="language-plaintext highlighter-rouge">best_shift</code> on the smoothed data.</p> </li> </ul> <h2 id="35-dma-driven-sampling"> <a href="#35-dma-driven-sampling" class="anchor-heading" aria-labelledby="35-dma-driven-sampling"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.5 DMA-Driven Sampling </h2> <p>High-throughput ADC sampling is achieved in <code class="language-plaintext highlighter-rouge">dma_sampler.c</code>.</p> <p>During <code class="language-plaintext highlighter-rouge">dma_sampler_init()</code>, the ADC is configured in round-robin mode for channels <code class="language-plaintext highlighter-rouge">0</code>, <code class="language-plaintext highlighter-rouge">1</code>, and <code class="language-plaintext highlighter-rouge">2</code> (GPIO26-28) with FIFO enabled and the clock divider set for maximum rate.</p> <p>Two DMA channels are used:</p> <ol> <li><strong>Sample channel:</strong> Reads $8$-bit samples from the ADC FIFO into the three-byte <code class="language-plaintext highlighter-rouge">dma_sample_array</code>.</li> <li><strong>Control channel:</strong> Reloads the sample channel’s transfer pointer to form a continuous ping-pong cycle.</li> </ol> <p>This yields a steady ($50\,\mathrm{kHz}$) sampling rate with minimal jitter and zero CPU overhead beyond reading <code class="language-plaintext highlighter-rouge">dma_sample_array</code>.</p> <h2 id="36-microphone-geometry--calibration"> <a href="#36-microphone-geometry--calibration" class="anchor-heading" aria-labelledby="36-microphone-geometry--calibration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.6 Microphone Geometry &amp; Calibration </h2> <p>In <code class="language-plaintext highlighter-rouge">microphones.c</code>, <code class="language-plaintext highlighter-rouge">microphones_init()</code> computes the array geometry:</p> <ol> <li>Uses <code class="language-plaintext highlighter-rouge">MIC_DIST_AB_M</code>, <code class="language-plaintext highlighter-rouge">MIC_DIST_BC_M</code>, and <code class="language-plaintext highlighter-rouge">MIC_DIST_CA_M</code> with the law of cosines to determine coordinates for an uncentered triangle (A′ at $(0,0)$, B′ at $(d_{AB},0)$, C′ accordingly).</li> <li>Finds the centroid of A′B′C′ and shifts all points so the center of mass is at the origin.</li> <li>If <code class="language-plaintext highlighter-rouge">ROTATE_MICROPHONES</code> is enabled, rotates all points so microphone A aligns with the +X axis via a standard 2D rotation.</li> </ol> <h2 id="37-vga-visualization"> <a href="#37-vga-visualization" class="anchor-heading" aria-labelledby="37-vga-visualization"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.7 VGA Visualization </h2> <p><img src="./assets/images/early_interface.jpeg" alt="VGA Visualization" class="bordered" /></p> <p>The display routines in <code class="language-plaintext highlighter-rouge">vga.c</code> layer multiple graphical elements:</p> <ul> <li><strong><code class="language-plaintext highlighter-rouge">vga_init()</code>:</strong> Calls <code class="language-plaintext highlighter-rouge">vga_init_heatmap()</code>, which draws axes and precomputes a heatmap lookup.</li> <li><strong><code class="language-plaintext highlighter-rouge">vga_draw()</code>:</strong> Renders correlation curves, overlays the heatmap of possible locations, and plots raw waveforms.</li> <li><strong><code class="language-plaintext highlighter-rouge">vga_draw_lite()</code>:</strong> Omits the heatmap and updates only markers and waveforms for low-latency frames.</li> </ul> <p>Helper modules (<code class="language-plaintext highlighter-rouge">vga_correlations</code>, <code class="language-plaintext highlighter-rouge">vga_heatmap</code>, <code class="language-plaintext highlighter-rouge">vga_text</code>, <code class="language-plaintext highlighter-rouge">vga_waveforms</code>) use the <code class="language-plaintext highlighter-rouge">lib/vga/vga16_graphics</code> primitives to draw primitives based on correlation-derived color thresholds.</p> <h2 id="38-third-party--reused-code"> <a href="#38-third-party--reused-code" class="anchor-heading" aria-labelledby="38-third-party--reused-code"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3.8 Third-Party &amp; Reused Code </h2> <p>We build atop the official Raspberry Pi Pico SDK for multicore support, GPIO, ADC, DMA, and timing. The VGA stack uses the open-source <code class="language-plaintext highlighter-rouge">lib/vga/vga16_graphics</code> library. All custom modules-rolling buffers, correlation engine, DMA sampler, display routines-are authored in-house or derived from public-domain sources.</p> </main> <hr> <footer> <p><a href="#top" id="back-to-top">Back to top</a></p> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
